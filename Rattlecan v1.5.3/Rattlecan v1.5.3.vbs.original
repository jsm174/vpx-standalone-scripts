Option Explicit '"~~~~~~~~~~~~~~~~~~~~"

Dim DigitalSoundsLevel		: DigitalSoundsLevel= 0.75 ' Default 0.75
Dim MusicLevel				: MusicLevel=0.66 'Default 0.66
Dim EasyRollovers			: EasyRollovers=1 ' 1 = Top Rollovers can end modes. 0= Top Rollovers affect bonus x only
Dim EasyBallSave			: EasyBallSave=1 ' 1 = Bottom rollovers give ball save only and are easier to cycle. 0 = Bottom rollovers can end modes.
Dim TiltForgiveness			: TiltForgiveness=5 'Low value = Easy to tilt. High value = hard to tilt. Default 5
Dim ReallyEnableBallControl	: ReallyEnableBallControl = 0 'The Ball Control script is a liar. Use this instead.
Dim OnlyCheatOnce           : OnlyCheatOnce=1 'Set to 1 to disable the magnasave debugger.
Dim BallRollVolume			: BallRollVolume=0.2  ' Default 0.8
Dim CaptivePowerBall		: CaptivePowerBall=1 'Replace the captive ball with a powerball (81.25% mass)
Dim PaintColor				: PaintColor = 1 '1 = Red, 2 = Green, 3 = Blue, 4 = Black
Dim AftermarketPost			: AftermarketPost = 1 'Extra post post beside the captive ball rail, theoretically fewer SDTM feeds from the left orbit
'Dim LegacyPhysics           : Legacyphysics = 1

'======================================
'§ Things I Don't Actually Understand §
'======================================


On Error Resume Next
ExecuteGlobal GetTextFile("controller.vbs")
If Err Then MsgBox "You need the Controller.vbs file in order to run this table (installed with the VPX package in the scripts folder)"
On Error Goto 0

Const cGameName = "rattlecan"
Sub InitBackglass()
	LoadEM
End Sub




Dim EnableBallControl        
EnableBallControl = false    

Const BallSize = 50 
Const BallMass = 1

Dim tablewidth
tablewidth = Table1.width
Dim tableheight
tableheight = Table1.height

Sub LeftFlipper_Animate()
    FlipperLSh.RotZ = LeftFlipper.CurrentAngle
	LFlip.RotZ = LeftFlipper.CurrentAngle
End Sub

Sub RightFlipper_Animate()
    FlipperRSh.RotZ = RightFlipper.CurrentAngle
	RFlip.RotZ = RightFlipper.CurrentAngle
End Sub

'========================
'§ Button / Key Mapping §
'========================

Dim ColorCycle:ColorCycle=0

Sub Table1_KeyDown(ByVal keycode)

	If keycode = LeftMagnaSave Then
		If OnlyCheatOnce=0 Then
			CyanComplete=1
			BlueComplete=1
			MagentaComplete=1
			RedComplete=1
			YellowComplete=1
			GreenComplete=1
			Ignite L_SpectrumCyan
			Ignite L_SpectrumBlue
			Ignite L_SpectrumMagenta
			Ignite L_SpectrumRed
			Ignite L_SpectrumYellow
			Ignite L_SpectrumGreen
			Ignite L_SpectrumWhite
			SpectrumGoalComplete=1
			Ignite L_GoalCompleteSpectrum
			CymonRescued=1
			MaggieRescued=1
			YoloRescued=1
			KeenenRescued=1
			RescueGoalComplete=1
			Ignite L_GoalRescueYourFriends
			SuperJackpotComplete=1
			Ignite L_GoalCollectSuperJackpot
			UpdateCharacterLights
			FirstBossBattle=1
			OnlyCheatOnce=1
			SurpriseBossBattle
		End If
	End If

    If keycode = RightMagnaSave Then 
	End If

	If keycode = PlungerKey Then
		DoAbsolutelyNothing
	End If

	If keycode = LeftFlipperKey And CountingBonus<>1 And GameOver<>1 And TableTilted=0 And YouHaveFailed.enabled=0 Then
		FlipperActivate LeftFlipper, LFPress
		LF.Fire 'LeftFlipper.RotateToEnd
		PlaySound SoundFX("fx_flipperup",DOFFlippers), 0, .67, AudioPan(LeftFlipper), 0.05,0,0,1,AudioFade(LeftFlipper)
		CycleBottomRolloversLeft
		CycleTopRolloversLeft
	End If

	If keycode = RightFlipperKey And CountingBonus<>1 And GameOver<>1 And TableTilted=0 And YouHaveFailed.enabled=0 Then
		FlipperActivate RightFlipper, RFPress
		RF.Fire 'RightFlipper.RotateToEnd
		PlaySound SoundFX("fx_flipperup",DOFFlippers), 0, .67, AudioPan(RightFlipper), 0.05,0,0,1,AudioFade(RightFlipper)
		CycleBottomRolloversRight
		CycleTopRolloversRight
	End If

	If keycode = LeftTiltKey Then 
		If WizardMode+BossBattle+GameOver=0 Then
			Nudges=Nudges+100
			CountNudges
		End If
		Nudge 90, 4
	End If

	If keycode = RightTiltKey Then
		If WizardMode+BossBattle+GameOver=0 Then
			Nudges=Nudges+100
			CountNudges
		End If
		Nudge 270, 4
	End If

	If keycode = CenterTiltKey Then
		If WizardMode+BossBattle+GameOver=0 Then
			Nudges=Nudges+100
			CountNudges
		End If
		Nudge 0, 3.5
	End If

'Yes, you read this right. I made it impossible to tilt the table during either Boss Mode or Wizard Mode. The weak rationale for this 
'is that a real player would be very unlikely to nudge the table in those two specific circumstances. The real reason is that trying
'to get accurate tilting behavior *during* those two modes is an absolute BASTARD and I'm done attempting it. 


	If keycode = 46 And ReallyEnableBallControl=1 Then	 				' C Key           
		If EnableBallControl = 1 Then
			EnableBallControl = 0
		Else
			EnableBallControl = 1
		End If
	End If
    If EnableBallControl = 1 Then
		If keycode = 48 And ReallyEnableBallControl=1 Then 				' B Key
			If BCboost = 1 Then
				BCboost = BCboostmulti
			Else
				BCboost = 1
			End If
		End If
		If keycode = 203 And ReallyEnableBallControl=1 Then BCleft = 1	' Left Arrow
		If keycode = 200 And ReallyEnableBallControl=1 Then BCup = 1		' Up Arrow
		If keycode = 208 And ReallyEnableBallControl=1 Then BCdown = 1	' Down Arrow
		If keycode = 205 And ReallyEnableBallControl=1 Then BCright = 1	' Right Arrow
	End If
End Sub

Sub Table1_KeyUp(ByVal keycode)

	If EnableBallControl = 1 Then
		If keycode = 203 Then BCleft = 0	' Left Arrow
		If keycode = 200 Then BCup = 0		' Up Arrow
		If keycode = 208 Then BCdown = 0	' Down Arrow
		If keycode = 205 Then BCright = 0	' Right Arrow
	End If

	If keycode = PlungerKey Then
		If GameOver<>1 Then
			If BallsOnPlayfield=0 Then
				Autoplunger
				If BallInPlay=1 Then
					DisplayTop " "
				End If
			End If
		End If
	End If

	If keycode = LeftFlipperKey Then
		FlipperDeActivate LeftFlipper, LFPress
		LeftFlipper.RotateToStart
		If CountingBonus<>1 And GameOver<>1 And TableTilted=0 And YouHaveFailed.enabled=0 Then PlaySound SoundFX("fx_flipperdown",DOFFlippers), 0, 1, AudioPan(LeftFlipper), 0.05,0,0,1,AudioFade(LeftFlipper)
	End If

	If keycode = RightFlipperKey Then
		FlipperDeActivate RightFlipper, RFPress
		RightFlipper.RotateToStart
		If CountingBonus<>1 And GameOver<>1 And TableTilted=0 And YouHaveFailed.enabled=0 Then PlaySound SoundFX("fx_flipperdown",DOFFlippers), 0, 1, AudioPan(RightFlipper), 0.05,0,0,1,AudioFade(RightFlipper)
	End If

	If Keycode=StartGameKey And GameOver=1 Then
			StartGame
	End If
End Sub


'============================
'§ Tilting and Other Things §
'============================

Dim Nudges : Nudges=0
Dim Dangers : Dangers=0
Dim TableTilted : TableTilted=0

Sub NotATiltBob_Timer
	If Nudges>0 Then Nudges = Nudges - Int(Rnd*TiltForgiveness)+1
	If Nudges<0 Then Nudges=0
End Sub

Sub CountNudges
	If Nudges>300 Then
		Nudges=0
		Dangers=Dangers+1
		Select Case Dangers
			Case 1
				Playsound "sega_bossbattlemessage", 0 , DigitalSoundsLevel
				DisplayTop "111111 DANGER 111111"
				DisplayBottom "111111 DANGER 111111"
				DisplayingDanger.enabled=1
			Case 2
				Playsound "sega_bossbattlemessage", 0 , DigitalSoundsLevel
				DisplayTop    "222222 DANGER 222222"
				DisplayBottom "222222 DANGER 222222"
				DisplayingDanger.enabled=1
			Case 3
				ParkMessageTop = "TILT TILT TILT TILT "
				ParkMessageBottom = " TILT TILT TILT TILT"
				DisplayTop    "TILT TILT TILT TILT "
				DisplayBottom " TILT TILT TILT TILT"
				StopMusic
				KillSolenoids
				TableTilted=1
				KKill AllInserts
				GIColor Black
				BallSave=0
				DisplayingDanger.enabled=1
		End Select
	End If
End Sub

Sub DisplayingDanger_Timer
	DisplayingDanger.enabled=0
End Sub

Sub KillSolenoids
	Dim Sling 
	Dim Bumper
	For Each Sling in Slingshots
		Sling.SlingshotThreshold=100
	Next
	For Each Bumper in PopBumpers
		Bumper.Threshold=100
	Next
End Sub

Sub WakeupSolenoids
	Dim Sling 
	Dim Bumper
	For Each Sling in Slingshots
		Sling.SlingshotThreshold=2
	Next
	For Each Bumper in PopBumpers
		Bumper.Threshold=1.8
	Next
End Sub


'===================================
'§ Various Ball-Launching Routines §
'===================================

Dim BallsOnPlayfield

Sub Kicker001_Hit ' I somehow had a rollback. No idea how. But hopefully this fixes it.
	PlaySoundAt "fx_kicker",Kicker001
	PlaySound "sega_kicker", 0 , DigitalSoundsLevel
	Kicker001.Kick 0,40
End Sub

Sub LaunchBall 'Used only following a lock shot
	Kicker001.CreateBall
	PlaySoundAt "fx_kicker",Kicker001
	If TableTilted=0 Then PlaySound "sega_kicker", 0 , DigitalSoundsLevel
	Kicker001.Kick 0,40
End Sub

Sub Autoplunger
	FirstBoot=0
	If BallsOnPlayfield = 0 And CountingBonus = 0 Then
		LaunchBall
		BallsOnPlayfield = BallsOnPlayfield+1		
		UpdateCharacterLights
		BallSave=1
		TenSecondBallSave.enabled=1
	End If
End Sub

Sub StartMultiBall(number)
	If BossBattle=0 And WizardMode=0 Then
		BallSave=1
		TenSecondBallSave.enabled=1
	End If
	Select Case (number)
		Case 2
			Start2MultiBall.enabled=1
		Case 3
			Start3MultiBall.enabled=1
		Case 4
			Start4MultiBall.enabled=1
	End Select
End Sub

Sub Start2MultiBall_Timer
	Dim DisplayBalls : DisplayBalls=GetBalls
	If BallsOnPlayfield<2  And UBound(DisplayBalls)<2 Then
		Kicker001.CreateBall
		PlaySoundAt "fx_kicker",Kicker001
		If TableTilted=0 Then PlaySound "sega_kicker", 0 , DigitalSoundsLevel
		Kicker001.Kick 0,40
		BallsOnPlayfield = BallsOnPlayfield+1
	Else
		Start2MultiBall.enabled=0
	End If
End Sub

Sub Start4MultiBall_Timer
	Dim DisplayBalls : DisplayBalls=GetBalls
	If BallsOnPlayfield<4 And UBound(DisplayBalls)<4 Then
		Kicker001.CreateBall
		PlaySoundAt "fx_kicker",Kicker001
		If TableTilted=0 Then PlaySound "sega_kicker", 0 , DigitalSoundsLevel
		Kicker001.Kick 0,40
		BallsOnPlayfield = BallsOnPlayfield+1
	Else
		Start4MultiBall.enabled=0
	End If
End Sub

Sub Start3MultiBall_Timer
	Dim DisplayBalls : DisplayBalls=GetBalls
	If BallsOnPlayfield<3 And UBound(DisplayBalls)<3 Then
		Kicker001.CreateBall
		PlaySoundAt "fx_kicker",Kicker001
		If TableTilted=0 Then PlaySound "sega_kicker", 0 , DigitalSoundsLevel
		Kicker001.Kick 0,40
		BallsOnPlayfield = BallsOnPlayfield+1
	Else
		Start3MultiBall.enabled=0
	End If
End Sub

'========================
'§ Behavior of Drain(s) §
'========================

Sub StopMultiball
		GIColor Neutral
		PlayfieldColor = Neutral ' Was this really necessary? I dunno.
		If SpectrumMode=0 Then SegmentColor Neutral
		KKill JackpotInserts
		JackpotsAwarded=0
		If CurrentMusic<>"music_interrupted" and CurrentMusic<>"music_normal" And TableTilted=0 Then PlayMusic "music_interrupted"
		If L_GoalCollectSuperJackpot.UserValue=2 Then Kill L_GoalCollectSuperJackpot 'What? What am I even doing?
		If BossGoalComplete=1 And SpectrumGoalComplete=1 And RescueGoalComplete=1 And SuperJackpotComplete=0 And L_SpinnerLockBall.UserValue<>2 Then YouSuck
		UpdateInkLevels
		If L_GoalDefeatSlater.UserValue = 2 Then
			ScrollFromTopCenter "BOSS FIGHT UNLOCKED "
			Blink L_ScoopTriangle
			Blink L_SpinnerLockBall
			If SpectrumMode=0 then KKill ModeInserts
			RBarrelUp
		End If
		If StagedBalls=0 then AutoKicker.enabled=0
End Sub

Sub DrainBehavior
	If CountingBonus=1 Then Exit Sub
	BallsOnPlayfield = BallsOnPlayfield-1 : If BallsOnPlayfield<0 Then BallsOnPlayfield=0
	Dim BOT : BOT = GetBalls : If UBound(BOT) = 0 And BallsOnPlayfield>0 Then LaunchBall ' If this works I'll eat a shoe
	If BossBattle=0 And WizardMode=0 And YouHaveFailed.enabled=0 And BallsOnPlayfield = 1 Then StopMultiball
	If BallsOnPlayfield = 0 And YouHaveFailed.enabled=0 Then StartBonusCount
	If WizardMode=1 Then
		SavedBalls=SavedBalls+1
		Exit Sub
	End If
	If BossBattle=1 Then
		PlayerHealth = PlayerHealth -1
		If PlayerHealth<1 Then BossBattle=0
		UpdateHealth
		SavedBalls=SavedBalls+1
	End If
End Sub

Sub Drain001_Hit()
	PlaySound "drain",0,1,AudioPan(Drain002),0.25,0,0,1,AudioFade(Drain002)
	Drain001.DestroyBall
	DrainBehavior
End Sub

Sub Drain002_Hit()
	PlaySound "drain",0,1,AudioPan(Drain002),0.25,0,0,1,AudioFade(Drain002)
	Drain002.DestroyBall
	DrainBehavior
End Sub

Sub Drain003_Hit()
	PlaySound "drain",0,1,AudioPan(Drain002),0.25,0,0,1,AudioFade(Drain002)
	Drain003.DestroyBall
	DrainBehavior
End Sub

Sub TenSecondBallSave_Timer
	TenSecondBallSave.enabled=0
	BallSave=0
End Sub

Sub EndlessBallSaveTimer_Timer
	Dim DisplayBalls : DisplayBalls=GetBalls
	If SavedBalls>0 And BallsOnPlayfield<4 And UBound(DisplayBalls)<4 And Start2MultiBall.enabled=0 And Start4MultiBall.enabled=0 And Start3MultiBall.enabled=0 Then
		LaunchBall
		BallsOnPlayfield=BallsOnPlayfield+1
		SavedBalls=SavedBalls-1
	End If
End Sub

'==========================
'§ Behavior of Slingshots §
'==========================

Dim RStep, Lstep, R001Step, L001Step

Sub RightSlingShot_Slingshot
	If WizardMode = 0 And BossBattle=0 Then Scoring : Addscore Slingshot_Score
    PlaySound SoundFX("FX_slingshot",DOFContactors), 0,1, 0.05,0.05 '0,1, AudioPan(RightSlingShot), 0.05,0,0,1,AudioFade(RightSlingShot)
	If TableTilted=0 Then PlaySound "sega_saucer", 0 , DigitalSoundsLevel
    RSling.Visible = 0
    RSling1.Visible = 1
    sling1.rotx = 20
    RStep = 0
    RightSlingShot.TimerEnabled = 1
	If WizardMode = 0 Then UpdateCharacterLights
End Sub

Sub RightSlingShot_Timer
    Select Case RStep
        Case 3:RSLing1.Visible = 0:RSLing2.Visible = 1:sling1.rotx = 10
        Case 4:RSLing2.Visible = 0:RSLing.Visible = 1:sling1.rotx = 0:RightSlingShot.TimerEnabled = 0
    End Select
    RStep = RStep + 1
End Sub

Sub RightSlingShot001_Slingshot
	If WizardMode = 0 And BossBattle=0 Then Scoring : Addscore Slingshot_Score
    PlaySound SoundFX("FX_slingshot",DOFContactors), 0,1, 0.05,0.05 '0,1, AudioPan(RightSlingShot), 0.05,0,0,1,AudioFade(RightSlingShot)
	If TableTilted=0 Then PlaySound "sega_saucer", 0 , DigitalSoundsLevel
    RSling001.Visible = 0
    RSling0011.Visible = 1
    sling1001.rotx = 20
    R001Step = 0
    RightSlingShot001.TimerEnabled = 1
	If WizardMode = 0 Then UpdateCharacterLights
End Sub

Sub RightSlingShot001_Timer
    Select Case R001Step
        Case 3:RSLing0011.Visible = 0:RSLing0012.Visible = 1:sling1001.rotx = 10
        Case 4:RSLing0012.Visible = 0:RSLing001.Visible = 1:sling1001.rotx = 0:RightSlingShot001.TimerEnabled = 0
    End Select
    R001Step = R001Step + 1
End Sub

Sub LeftSlingShot_Slingshot
	If WizardMode = 0 And BossBattle=0 Then Scoring : Addscore Slingshot_Score
    PlaySound SoundFX("left_slingshot",DOFContactors), 0,1, -0.05,0.05 '0,1, AudioPan(LeftSlingShot), 0.05,0,0,1,AudioFade(LeftSlingShot)
	If TableTilted=0 Then PlaySound "sega_saucer", 0 , DigitalSoundsLevel
    LSling.Visible = 0
    LSling1.Visible = 1
    sling2.rotx = 20
    LStep = 0
    LeftSlingShot.TimerEnabled = 1
	If WizardMode = 0 Then UpdateCharacterLights
End Sub

Sub LeftSlingShot_Timer
    Select Case LStep
        Case 3:LSLing1.Visible = 0:LSLing2.Visible = 1:sling2.rotx = 10
        Case 4:LSLing2.Visible = 0:LSLing.Visible = 1:sling2.rotx = 0:LeftSlingShot.TimerEnabled = 0
    End Select
    LStep = LStep + 1
End Sub

Sub LLSlingShot_Slingshot
	If WizardMode = 0 And BossBattle=0 Then Scoring : Addscore Slingshot_Score
    PlaySound SoundFX("left_slingshot",DOFContactors), 0,1, 0.05,0.05 '0,1, AudioPan(RightSlingShot), 0.05,0,0,1,AudioFade(RightSlingShot)
	If TableTilted=0 Then PlaySound "sega_popbumper", 0 , DigitalSoundsLevel
    LLSling.Visible = 0
    LLSling1.Visible = 1
    LLSling001.rotx = 20
    L001Step = 0
    LLSlingShot.TimerEnabled = 1
	If WizardMode = 0 Then UpdateCharacterLights
End Sub

Sub LLSlingShot_Timer
    Select Case L001Step
        Case 3:LLSLing1.Visible = 0:LLSLing2.Visible = 1:LLsling001.rotx = 10
        Case 4:LLSLing2.Visible = 0:LLSLing.Visible = 1:LLsling001.rotx = 0:LLSlingShot.TimerEnabled = 0
    End Select
    L001Step = L001Step + 1
End Sub


'===============
'§ Bonus Count §
'===============

Dim CountingBonus
Dim BonusMultiplier
Dim WereLocksLit
Dim OldCyanLevel
Dim OldMagentaLevel
Dim OldYellowLevel
Dim OldKeyLevel
Dim OldBossLevel

Sub StartBonusCount
	Dangers=0
	If TableTilted=0 Then PlaySound "sega_centerdrain", 0 , DigitalSoundsLevel	
	StopMusic
	If TableTilted=0 Then PlaySound "music_drain", 0 , DigitalSoundsLevel	
	CurrentMusic="music_drain"
	OldBossLevel = L_GoalDefeatSlater.UserValue
	OldCyanLevel = CyanInkLevel
	OldMagentaLevel = MagentaInkLevel
	OldYellowLevel = YellowInkLevel
	OldKeyLevel = KeyInkLevel
	PlayfieldColor=Neutral
	SegmentColor Neutral
	GIColor Neutral
	DisplayTop ""
	DisplayBottom ""
	ParkMessageTop = ""
	ParkMessageBottom = ""
	CountingBonus=1
	RBarrelDown
	If L_SpinnerLockBall.UserValue=2 Then WereLocksLit=1
	KKill AllInsertsExceptSpectrum
	UpdateCharacterLights
	UpdateInkLevels
	If RescueGoalComplete = 1 Then Ignite L_GoalRescueYourFriends
	If SpectrumGoalComplete = 1 Then Ignite L_GoalCompleteSpectrum
	If BossGoalComplete = 1 Then Ignite L_GoalDefeatSlater
	If SuperJackpotComplete=1 Then Ignite L_GoalCollectSuperJackpot
	Dim Lightbulb
	For Each Lightbulb In SpectrumInserts
		If Lightbulb.UserValue=2 Then Lightbulb.UserValue=0
	Next
	For Each Lightbulb In FriendsInserts
		If Lightbulb.State=2 Then Lightbulb.state=0
	Next
	Select Case TableTilted
		Case 0
			DrainInkIncrement=3
			DrainInkForBonus.enabled=1
			SpinBonus.enabled=1
			ShakeBonus.enabled=1
			RescueBonus.enabled=1
			SpectrumBonus.enabled=1
			BonusX.enabled=1
			TotalBonus.enabled=1
			ShootAgain.enabled=1
		Case 1
			TableTilted=0
			BonusMultiplier=1
			SpraycanShakes=0
			PaintCanSpins=0
			ShootAgainAfterTilt.enabled=1
	End Select
End Sub

Sub ShakeBonus_Timer  
	ScrollFromTopRight "    SHAKES X " & SpraycanShakes
	BlinkANumber SpraycanShakes*SprayCanBonus_Score
	ShakeBonus.enabled=0
	'PlaySound "sega_bonuscount", 0 , DigitalSoundsLevel	
End Sub

Sub SpinBonus_Timer  
	ScrollFromTopLeft "     SPINS X " & PaintCanSpins
	BlinkANumber PaintCanSpins*PaintCanBonus_Score
	SpinBonus.enabled=0
	'PlaySound "sega_bonuscount", 0 , DigitalSoundsLevel	
End Sub

Sub RescueBonus_Timer  
	ScrollFromTopRight "    RESCUE BONUS    "
	BlinkANumber (CymonRescued+MaggieRescued+YoloRescued+KeenenRescued)*FriendsBonus_Score
	RescueBonus.enabled=0
	'PlaySound "sega_bonuscount", 0 , DigitalSoundsLevel	
End Sub

Sub SpectrumBonus_Timer	
	ScrollFromTopLeft "   SPECTRUM BONUS   "
	BlinkANumber (CyanComplete+BlueComplete+MagentaComplete+RedComplete+YellowComplete+GreenComplete)*SpectrumBonus_Score
	SpectrumBonus.enabled=0
	'PlaySound "sega_bonuscount", 0 , DigitalSoundsLevel	
End Sub

Sub BonusX_Timer
	ScrollFromTopRight "       BONUS X      "
	BlinkANumber BonusMultiplier
	BonusX.enabled=0
	'PlaySound "sega_bonuscount", 0 , DigitalSoundsLevel	
End Sub

Sub TotalBonus_Timer    
	ScrollFromTopLeft "    TOTAL BONUS     "
	PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel	
	Dim TotalBonusValue
	TotalBonusValue = SpraycanShakes*SprayCanBonus_Score
	TotalBonusValue = TotalBonusValue+(PaintCanSpins*PaintCanBonus_Score)
	TotalBonusValue = TotalBonusValue+((CymonRescued+MaggieRescued+YoloRescued+KeenenRescued)*FriendsBonus_Score)
	TotalBonusValue = TotalBonusValue+((CyanComplete+BlueComplete+MagentaComplete+RedComplete+YellowComplete+GreenComplete)*SpectrumBonus_Score)
	TotalBonusValue = TotalBonusValue * BonusMultiplier
	BlinkANumber TotalBonusValue
	AddScore TotalBonusValue
	TotalBonus.Enabled=0	
	BonusMultiplier=1
	SpraycanShakes=0
	PaintCanSpins=0
End Sub

Sub ResumePlay
	QuietSounds.enabled=1
	L_GoalDefeatSlater.UserValue=OldBossLevel
	If L_GoalDefeatSlater.UserValue=2 Then RBarrelUp 'lol
	If WereLocksLit=1 Then
		L_SpinnerLockBall.UserValue=2
		If L_GoalDefeatSlater.UserValue=2 Then L_ScoopTriangle.UserValue=2
	End If
	WereLocksLit=0
	UpdateRescueLights
	UpdateCharacterLights
	If SpectrumGoalComplete=0 Then CyanInkLevel = OldCyanLevel
	If SpectrumGoalComplete=0 Then MagentaInkLevel = OldMagentaLevel
	If SpectrumGoalComplete=0 Then YellowInkLevel = OldYellowLevel
	If SpectrumGoalComplete=0 Then KeyInkLevel = OldKeyLevel
	SpectrumMode=0
	UpdateInkLevels
	CheckIfInkFull
	CountingBonus=0
	If SuperJackpotComplete=1 Then Ignite L_GoalCollectSuperJackpot

'I have no idea why rescue progress resets after a drain.
'I could try and track down which of these subs is responsible but I don't care enough.
'Just adding these steps to reset the spiders since I kind of like the behavior already.
	Dim LocalDrop
	If RescueMode<>0 Then
		For Each LocalDrop In FourDropTargets
			LocalDrop.IsDropped=0
		Next
		PlaySoundAt "fx_resetdrop", centerdropsound
		BBlink DropTargetLights
	End If

	If BossGoalComplete=1 And SpectrumGoalComplete=1 And RescueGoalComplete=1 And SuperJackpotComplete=0 And L_SpinnerLockBall.UserValue<>2 Then YouSuck

End Sub

Sub ShootAgain_Timer
	Select Case ExtraBalls
		Case 0
			Select Case BallInPlay
				Case 1
					BallInPlay=BallInPlay+1 'comment this out for testing
					PlaySoundAt "fx_ballrel", BallRelease
					DisplayTop ""
					BlinkBallInPlay
					ResumePlay
					PlaySound "sega_extraball", 0 , DigitalSoundsLevel	
					PlayMusic "music_interrupted"
				Case 2
					BallInPlay=BallInPlay+1
					PlaySoundAt "fx_ballrel", BallRelease
					DisplayTop ""
					BlinkBallInPlay
					ResumePlay
					PlaySound "sega_extraball", 0 , DigitalSoundsLevel	
					PlayMusic "music_interrupted"
				Case 3
					GameOver=1
					SimpleBlinkTop 		"        GAME        "
					SimpleBlinkBottom	"        OVER        "
					PlaySound "sega_gameover", 0 , DigitalSoundsLevel	
					PlaySound "music_muppets", 0 , MusicLevel
					GIColor Black
					AttractIncrement = -1
					CheapAttractMode.enabled=1
			End Select
		Case Else
			ExtraBalls=ExtraBalls-1
			PlaySoundAt "fx_ballrel", BallRelease
			SimpleBlinkTop "     SHOOT AGAIN    "
			DisplayBallInPlay
			ResumePlay
			PlaySound "sega_extraball", 0 , DigitalSoundsLevel	
			PlayMusic "music_interrupted"
	End Select
	ShootAgain.enabled=0
End Sub

Sub ShootAgainAfterTilt_Timer
	TableTilted=0
	WakeupSolenoids
	ParkMessageBottom = ""
	ParkMessageTop = ""
	Select Case ExtraBalls
		Case 0
			Select Case BallInPlay
				Case 1
					BallInPlay=BallInPlay+1 'comment this out for testing
					PlaySoundAt "fx_ballrel", BallRelease
					DisplayTop ""
					BlinkBallInPlay
					ResumePlay
					PlaySound "sega_extraball", 0 , DigitalSoundsLevel	
					PlayMusic "music_interrupted"
				Case 2
					BallInPlay=BallInPlay+1
					PlaySoundAt "fx_ballrel", BallRelease
					DisplayTop ""
					BlinkBallInPlay
					ResumePlay
					PlaySound "sega_extraball", 0 , DigitalSoundsLevel	
					PlayMusic "music_interrupted"
				Case 3
					GameOver=1
					SimpleBlinkTop 		"        GAME        "
					SimpleBlinkBottom	"        OVER        "
					PlaySound "sega_gameover", 0 , DigitalSoundsLevel	
					If TableTilted=0 Then PlaySound "music_muppets", 0 , MusicLevel
					GIColor Black
					AttractIncrement = -1
					CheapAttractMode.enabled=1
			End Select
		Case Else
			ExtraBalls=ExtraBalls-1
			PlaySoundAt "fx_ballrel", BallRelease
			SimpleBlinkTop "     SHOOT AGAIN    "
			DisplayBallInPlay
			ResumePlay
			If TableTilted=0 Then PlaySound "sega_extraball", 0 , DigitalSoundsLevel	
			PlayMusic "music_interrupted"
	End Select
	ShootAgainAfterTilt.enabled=0
End Sub

'=========================
'§ Bootup and Start Game §
'=========================

Dim FirstBoot : FirstBoot=1 ' this is only here to keep all the sfx from firing at once... at least that's what they were doing nine months ago. Probably redundant now.
Dim CBall

Sub PowerBall()
	Set CBall = CreateCaptiveBall.CreatesizedballwithMass(25,0.8125)
	CBall.Image = "powerball"
	CBall.FrontDecal = "Scratches"
	CBall.BulbIntensityScale = 0
	CBall.ReflectionEnabled = 0
	CBall.PlayfieldReflectionScale = 0
	CreateCaptiveBall.kick 0,0
End Sub


Sub Table1_Init
	zCol_Rubber_Post019.Collidable=AftermarketPost
	RubberPin005.Visible=AftermarketPost
	Primitive032.Visible=AftermarketPost
	WakeupSolenoids
	InitBackglass
	TurnOffTimers
	SegmentColor Neutral
	GIColor Black
	L_CharacterCymon.state=0
	L_CharacterMaggie.state=0
	L_CharacterYolo.state=0
	L_CharacterKeenen.state=0
	RBarrelDown
	ResetAllModes
	GameOver = 1
	CurrentScore=0
	TTurnOff LEDs
	BallsOnPlayfield=0
	CheckForBadDiverter=0
	DisplayTop "   ---WARNING ---   "
	DisplayBottom "  FLASHING LIGHTS   "
	Dim CBall
	If CaptivePowerBall=1 Then
		PowerBall()
	Else
		CreateCaptiveBall.CreateBall
		CreateCaptiveBall.Kick 160, 0.1
	End If
	Select Case PaintColor
		Case 1
			Primitive027.image="paintcan_red"
		Case 2
			Primitive027.image="paintcan_green"
		Case 3
			Primitive027.image="paintcan_blue"
		Case 4
			Primitive027.image="paintcan_black"
		Case Else
			Select Case Int(Rnd*4)+1
				Case 1
					Primitive027.image="paintcan_red"
				Case 2
					Primitive027.image="paintcan_green"
				Case 3
					Primitive027.image="paintcan_blue"
				Case 4
					Primitive027.image="paintcan_black"
		End Select
	End Select
	CreateCaptiveBall.Enabled = 0
	DropWhiteL.isdropped=0
	DropWhiteR.isdropped=1
	RGI_NotDropped1.intensity=10
	RGI_NotDropped2.intensity=10
	RGI_Dropped1.intensity=0
	RGI_Dropped2.intensity=0
	LGI_Dropped1.intensity=5
	LGI_Dropped2.intensity=5
	LGI_NotDropped1.intensity=0
	LGI_NotDropped2.intensity=0
	RBarrelDown
End Sub

Sub TurnOffTimers
	ScrollFromTopLeftTimer.Enabled=0
	ScrollFromBottomLeftTimer.Enabled=0
	ScrollFromTopRightTimer.Enabled=0
	ScrollFromBottomRightTimer.Enabled=0
	ScrollFromTopCenterTimer.Enabled=0
	ScrollFromBottomCenterTimer.Enabled=0
	SimpleBlinkTopTimer.Enabled=0
	SimpleBlinkBottomTimer.Enabled=0
	CyanDiverterRealistic.enabled=0
	Start2MultiBall.enabled=0
	Start4MultiBall.enabled=0
	Start3MultiBall.enabled=0
	StartSpectrumMultiball.enabled=0
	T_BarrelR.enabled=0
	AwardSpectrumTimer.enabled=0
	DrainInkTimer.enabled=0
	CrazyWizardLights.enabled=0
	LocksLitTimer.enabled=0
	Afterlock.enabled=0
	SpinBonus.enabled=0
	ShakeBonus.enabled=0
	RescueBonus.enabled=0
	SpectrumBonus.enabled=0
	BonusX.enabled=0
	TotalBonus.enabled=0
	ShootAgain.enabled=0
	AutoKicker.enabled=0
	TenSecondBallSave.enabled=0
	BossBattle1.enabled=0
	BossBattle2.enabled=0
	BossBattle3.enabled=0
	MusicDelay.enabled=0
End Sub

Dim BallInPlay	
Dim GameOver
Dim LockedBalls
Dim WizardMode
Dim ExtraBalls
Dim SpectrumExtraBall
Dim FriendsExtraBall
Dim SpectrumThisBall
Dim FriendsThisBall
Dim BallSave
Dim BossBattle
Dim NewGamePlus
Dim RescueGoalComplete
Dim SpectrumGoalComplete
Dim SuperJackpotComplete
Dim JustRolledOver
Dim BossGoalComplete
Dim SavedBalls
Dim FirstBossBattle

Sub ResetAllModes
	PaintCanSpins           = 0
	SpraycanShakes          = 0
	LockedBalls				= 0
	DrainInkIncrement       = -1
	AwardSpectrumIncrement  = 1
	WizardMode				= 0
	CymonRescued			= 0
	MaggieRescued			= 0
	YoloRescued				= 0
	KeenenRescued			= 0
	CyanComplete			= 0
	MagentaComplete			= 0
	YellowComplete			= 0
	BlueComplete			= 0
	RedComplete				= 0
	GreenComplete			= 0
	SpectrumMode			= 0
	RescueMode				= 0
	JackpotsAwarded			= 0
	RescueLevel				= 0
	RescueProgress			= 0
	RescueGoal				= 0
	TempSpectrumScore		= 0
	BonusMultiplier			= 1
	WereLocksLit			= 0
	ExtraBalls				= 0
	SpectrumExtraBall		= 0
	FriendsExtraBall		= 0
	SpectrumThisBall		= 0
	FriendsThisBall			= 0
	BallSave				= 0
	BossBattle				= 0
	RescueGoalComplete		= 0
	SpectrumGoalComplete	= 0
	SuperJackpotComplete	= 0
	JustRolledOver			= 0
	BossGoalComplete		= 0
	SavedBalls				= 0
End Sub

Sub StartGame
'	Select Case LegacyPhysics
'		Case 0
'			DoAbsolutelyNothing
'		Case 1
'			CyanStandUp.Elasticity=0
'			MagentaStandUp.Elasticity=0
'			YellowStandUp.Elasticity=0
'			KeyStandUp.Elasticity=0
'	End Select
		WakeupSolenoids
		Dangers=0
		CrazyInkLights.enabled=0
		CheapAttractMode.enabled=0
		GIColor Neutral
		L_CharacterCymon.state=0
		L_CharacterMaggie.state=0
		L_CharacterYolo.state=0
		L_CharacterKeenen.state=0
		L_CharacterSlater.state=0
		PlaySoundAt "fx_ballrel", BallRelease
		PlaySound "sega_startgame", 0 , DigitalSoundsLevel	
		FirstBossBattle			= 0
		NewGamePlus				=1
		BallInPlay              =0
		GameOver				=0
		KKill AllInserts
		GIColor Neutral
		SegmentColor Neutral
		PlayfieldColor = Neutral
		CurrentScore = 0
		UpdateScore
		ParkMessageBottom =   "    LAUNCH BALL    "
		ScrollFromTopRight    "     RATTLECAN     "
		ScrollFromBottomLeft  "                   "
		ResetInkLevels
		UpdateInkLevels
		ResetAllModes
		Jackpot_Score			= 7500
		UpdateRescueLights
		CountingBonus = 0
		PlaySoundAt "ballrelease", BallRelease
		BallInPlay=1
		RBarrelDown
		If DropBlack.IsDropped + DropYellow.IsDropped + DropMagenta.IsDropped + DropCyan.IsDropped <>4 Then
			Dim LocalDrop
			For Each LocalDrop In FourDropTargets
				LocalDrop.IsDropped=1
			Next
			PlaySoundAt "fx_resetdrop", centerdropsound
		End If
		PlayMusic "music_normal"
End Sub

'==============
'§ Sound Subs §
'==============

Dim CurrentMusic

Sub MusicDelay_Timer
	MusicDelay.enabled=0
	PlaySound CurrentMusic, -1, MusicLevel
End Sub

Sub StopMusic
	Dim Song
	Dim Playlist
	Playlist=Array("music_normal", "music_interrupted", "music_2mb", "music_3mb", "music_4mb", "music_bossintro", "music_bosslooping", "music_muppets", "music_drain")
	For Each Song in Playlist
		StopSound Song
	Next
End Sub

Sub PlayMusic(Music)
	If TableTilted=1 then Exit Sub
	If CurrentMusic<>Music Then
		StopMusic
		CurrentMusic=Music
		MusicDelay.enabled=1
	End If
End Sub

Sub BossMusic_Timer
	If CurrentMusic = "music_bossintro" Then
		StopSound "music_bossintro" 
		PlaySound "music_bosslooping", -1, MusicLevel
	End If
	BossMusic.enabled=0
End Sub

Sub QuietSounds_Timer
	QuietSounds.enabled=0
End Sub

Sub SFXBumperHit
	Select Case Int(Rnd*2)+1
		Case 1 : PlaySoundAtBall "fx_bumper2"
		Case 2 : PlaySoundAtBall "fx_bumper3"
	End Select
End Sub

Sub SFXGateHit
	Dim VolumeWithMultiplier : VolumeWithMultiplier=Vol(ActiveBall)*0.05
	PlaySound "fx_gate", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
End Sub

Sub SFXTargetHit
	Dim VolumeWithMultiplier : VolumeWithMultiplier=Vol(ActiveBall)*1.5
	Select Case Int(rnd*9)+1
		Case 1
			PlaySound "Target_1", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 2
			PlaySound "Target_2", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 3
			PlaySound "Target_3", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 4
			PlaySound "Target_4", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 5
			PlaySound "Target_5", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 6
			PlaySound "Target_6", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 7
			PlaySound "Target_7", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 8
			PlaySound "Target_8", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 9
			PlaySound "Target_9", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
	End Select
End Sub


Sub SFXRubberHit
	Dim VolumeWithMultiplier : VolumeWithMultiplier=Vol(ActiveBall)*1.5
	Select Case Int(rnd*9)+1
		Case 1
			PlaySound "Rubber_1", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 2
			PlaySound "Rubber_2", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 3
			PlaySound "Rubber_3", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 4
			PlaySound "Rubber_4", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 5
			PlaySound "Rubber_5", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 6
			PlaySound "Rubber_6", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 7
			PlaySound "Rubber_7", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 8
			PlaySound "Rubber_8", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 9
			PlaySound "Rubber_9", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
	End Select
End Sub

Sub SFXMetalHit
	Dim VolumeWithMultiplier : VolumeWithMultiplier=Vol(ActiveBall)*1.5
	Select Case Int(rnd*3)+1
		Case 1
			PlaySound "Metal_Touch_2", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 2
			PlaySound "Metal_Touch_5", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 3
			PlaySound "Metal_Touch_7", 0, VolumeWithMultiplier, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
	End Select
End Sub

Sub SFXDropHit : PlaySoundAtBall "fx_droptarget" : End Sub

Sub OnBallBallCollision(ball1, ball2, velocity)
	PlaySoundAtBall "fx_collide"
	FlipperCradleCollision ball1, ball2, velocity
End Sub

Sub LeftFlipper_Collide(parm)
	CheckLiveCatch ActiveBall, LeftFlipper, LFCount, parm
	LF.ReProcessBalls ActiveBall
 	RandomSoundFlipper()
End Sub

Sub RightFlipper_Collide(parm)
	CheckLiveCatch ActiveBall, RightFlipper, RFCount, parm
	RF.ReProcessBalls ActiveBall
 	RandomSoundFlipper()
End Sub

Sub RandomSoundFlipper()
	Select Case Int(Rnd*3)+1
		Case 1 : PlaySound "flip_hit_1", 0, Vol(ActiveBall)/2, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 2 : PlaySound "flip_hit_2", 0, Vol(ActiveBall)/2, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		Case 3 : PlaySound "flip_hit_3", 0, Vol(ActiveBall)/2, AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
	End Select
End Sub

'I tried using collections for all of these. It didn't work.

Sub RubberPin001_Hit  : SFXRubberHit : End Sub
Sub LSling_Hit  : SFXRubberHit : End Sub
Sub RSling_Hit  : SFXRubberHit : End Sub
Sub RubberSkinny008_Hit  : SFXRubberHit : End Sub
Sub RubberSkinny009_Hit  : SFXRubberHit : End Sub
Sub RubberShort006_Hit  : SFXRubberHit : End Sub
Sub RubberShort005_Hit  : SFXRubberHit : End Sub
Sub RSling001_Hit  : SFXRubberHit : End Sub
Sub RubberShort012_Hit  : SFXRubberHit : End Sub
Sub RubberShort014_Hit  : SFXRubberHit : End Sub
Sub RubberShort016_Hit  : SFXRubberHit : End Sub
Sub RubberShort017_Hit  : SFXRubberHit : End Sub
Sub LLSling_Hit  : SFXRubberHit : End Sub
Sub RubberShort002_Hit  : SFXRubberHit : End Sub
Sub RubberSkinny003_Hit  : SFXRubberHit : End Sub
Sub RubberShort007_Hit  : SFXRubberHit : End Sub
Sub RubberShort008_Hit  : SFXRubberHit : End Sub
Sub RubberShort015_Hit  : SFXRubberHit : End Sub
Sub RubberSkinny001_Hit  : SFXRubberHit : End Sub
Sub RubberShort001_Hit  : SFXRubberHit : End Sub
Sub RubberShort011_Hit  : SFXRubberHit : End Sub
Sub RubberShort010_Hit  : SFXRubberHit : End Sub
Sub RubberShort004_Hit  : SFXRubberHit : End Sub
Sub RubberShort018_Hit  : SFXRubberHit : End Sub
Sub RubberShort019_Hit  : SFXRubberHit : End Sub
Sub RubberPin010_Hit  : SFXRubberHit : End Sub
Sub RubberPin006_Hit  : SFXRubberHit : End Sub
Sub RubberPin002_Hit  : SFXRubberHit : End Sub
Sub RubberPin014_Hit  : SFXRubberHit : End Sub
Sub RubberPin016_Hit  : SFXRubberHit : End Sub
Sub RubberPin018_Hit  : SFXRubberHit : End Sub
Sub RubberSkinny004_Hit  : SFXRubberHit : End Sub
Sub RubberPin003_Hit  : SFXRubberHit : End Sub
Sub Wall043_Hit  : SFXRubberHit : End Sub
Sub Wall042_Hit  : SFXRubberHit : End Sub
Sub Wall044_Hit  : SFXRubberHit : End Sub
Sub Wall045_Hit  : SFXRubberHit : End Sub
Sub Wall046_Hit  : SFXRubberHit : End Sub
Sub Wall049_Hit  : SFXRubberHit : End Sub
Sub SingleRail002_Hit : SFxMetalHit : End Sub
Sub SingleRail001_Hit : SFxMetalHit : End Sub
Sub SingleRail006_Hit : SFxMetalHit : End Sub
Sub SingleRail004_Hit : SFxMetalHit : End Sub
Sub SingleRail003_Hit : SFxMetalHit : End Sub
Sub SingleRail008_Hit : SFxMetalHit : End Sub
Sub SingleRail009_Hit : SFxMetalHit : End Sub


'===========
'§ Inserts §
'===========

' I created this weird workaround to make the lights imageflip when turned on.
'
' ...before I realized that using separate lights on/off images is a waste of time and makes
' All the lights look like absolute shit.
'
' All inserts (that is, all playfield lights except the character portraits) should use 
' UserValue in place of STATE. This causes the lights to imageswap when lit.

' TurnOn / TurnOff = What it sounds like but should almost never be called except from a timer.
' Ignite = Turn on but with an image swap
' Kill = Turn off but with an image swap
' Blink = Blink but with an image swap

' IIgnite, KKill, and BBlink have identical behavior but are used with collections.

' Again, Light.State is IRRELEVANT. If you want to use the status of a light for storing
' or retrieving information, use light.UserValue!

Sub Ignite(light) : light.UserValue=1 : End Sub
Sub TurnOn(light)  : light.state=1 : light.image="lightson" : End Sub
Sub TurnOff(light) : light.state=0 : light.image="lightsoff":  End Sub
Sub Kill(light) : light.UserValue=0 : End Sub
Sub Blink(light) : light.UserValue=2 : End Sub

Sub IIgnite(light) : Dim Insert : For each Insert in light : insert.UserValue=1 : Next : End Sub
Sub TTurnOn(light)  : Dim Insert : For each Insert in light : insert.State=1 : insert.image="lightson" : Next : End Sub
Sub TTurnOff(light) : Dim Insert : For each Insert in light : insert.State=0 : insert.image="lightsoff" : Next : End Sub
Sub KKill(light) : Dim Insert : For each Insert in light : insert.UserValue=0 : Next : End Sub
Sub BBlink(light)   : Dim Insert : For each Insert in light : insert.UserValue=2 : Next : End Sub

Dim AttractIncrement : AttractIncrement = -1

Sub CheapAttractMode_Timer
	Select Case GameOver
		Case 0
			CheapAttractMode.enabled=0
			Exit Sub
		Case 1
			'CrazyInkLights.enabled=1
	End Select
	AttractIncrement = AttractIncrement +1
	If AttractIncrement = 9 Then AttractIncrement = 1
	KKill AllInserts
	L_CharacterCymon.state=0
	L_CharacterMaggie.state=0
	L_CharacterYolo.state=0
	L_CharacterKeenen.state=0
	L_CharacterSlater.state=0
	Select Case AttractIncrement
		Case 1
			L_CharacterCymon.state=1
			L_CharacterKeenen.state=1
			BBlink CyanInserts
			BBlink KeyInserts
			Ignite L_SpectrumCyan
			Blink L_DropTargetNarrow1
			Blink L_DropTargetNarrow4
			CyanInkLevel=4
			MagentaInkLevel=0
			YellowInkLevel=0
			KeyInkLevel=4
			UpdateInkLevels
		Case 2
			L_CharacterCymon.state=1
			L_CharacterMaggie.state=1
			BBlink CyanInserts
			BBlink MagentaInserts
			Ignite L_SpectrumBlue
			Blink L_DropTargetNarrow2
			Blink L_DropTargetNarrow3
			CyanInkLevel=4
			MagentaInkLevel=4
			YellowInkLevel=0
			KeyInkLevel=0
			UpdateInkLevels
		Case 3
			L_CharacterKeenen.state=1
			L_CharacterMaggie.state=1
			BBlink KeyInserts
			BBlink MagentaInserts
			Ignite L_SpectrumMagenta
			Blink L_DropTargetNarrow2
			Blink L_DropTargetNarrow4
			CyanInkLevel=0
			MagentaInkLevel=4
			YellowInkLevel=0
			KeyInkLevel=4
			UpdateInkLevels
		Case 4
			L_CharacterYolo.state=1
			L_CharacterMaggie.state=1
			BBlink YellowInserts
			BBlink MagentaInserts
			Ignite L_SpectrumRed
			BBlink JackpotInserts
			Blink L_DropTargetNarrow2
			Blink L_DropTargetNarrow3
			CyanInkLevel=0
			MagentaInkLevel=4
			YellowInkLevel=4
			KeyInkLevel=0
			UpdateInkLevels
		Case 5
			L_CharacterYolo.state=1
			L_CharacterKeenen.state=1
			BBlink YellowInserts
			BBlink KeyInserts
			Ignite L_SpectrumYellow
			Blink L_DropTargetNarrow3
			Blink L_DropTargetNarrow4
			CyanInkLevel=0
			MagentaInkLevel=0
			YellowInkLevel=4
			KeyInkLevel=4
			UpdateInkLevels
		Case 6
			L_CharacterYolo.state=1
			L_CharacterCymon.state=1
			BBlink YellowInserts
			BBlink CyanInserts
			Ignite L_SpectrumGreen
			Blink L_ScoopTriangle
			Blink L_SpinnerLockBall
			Blink L_DropTargetNarrow1
			Blink L_DropTargetNarrow3
			CyanInkLevel=4
			MagentaInkLevel=0
			YellowInkLevel=4
			KeyInkLevel=0
			UpdateInkLevels
		Case 7
			L_CharacterSlater.state=1
			BBlink CaptiveBallLights
			BBlink BottomRollovers
			BBlink TopRollovers
			Blink L_DropTargetWideL
			Blink L_DropTargetWideR
			CyanInkLevel=0
			MagentaInkLevel=0
			YellowInkLevel=0
			KeyInkLevel=0
			UpdateInkLevels
		Case 8
			Blink L_GoalRescueYourFriends
			Blink L_GoalDefeatSlater
			Blink L_GoalCollectSuperJackpot
			Blink L_GoalCompleteSpectrum
			Blink L_GoalTotalSaturation
		End Select
End Sub

			

		
			




'====================
'§ Character Lights §
'====================

Dim CymonRescued
Dim MaggieRescued
Dim YoloRescued
Dim KeenenRescued

Sub UpdateCharacterLights
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then Exit Sub
	If BossBattle=1 Then Exit Sub
	If RescueMode <> 0 Then 
		L_CharacterCymon.state=CymonRescued
		L_CharacterMaggie.state=MaggieRescued
		L_CharacterYolo.state=YoloRescued
		L_CharacterKeenen.state=KeenenRescued
		Select Case RescueMode
			Case 1
				L_CharacterCymon.state=2
			Case 2
				L_CharacterMaggie.state=2
			Case 3
				L_CharacterYolo.state=2
			Case 4
				L_CharacterKeenen.state=2
		End Select
	Else
		Select Case (CymonRescued + (MaggieRescued*2) + (YoloRescued*4) + (KeenenRescued*8))
			Case 0
				Select Case Int(Rnd*4)+1
					Case 1 : L_CharacterCymon.state=2 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=0 
					Case 2 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=2 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=0 
					Case 3 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=2 : L_CharacterKeenen.state=0 
					Case 4 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=2
				End Select
			Case 1
				Select Case Int(Rnd*3)+1
					Case 1 : L_CharacterCymon.state=1 : L_CharacterMaggie.state=2 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=0 
					Case 2 : L_CharacterCymon.state=1 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=2 : L_CharacterKeenen.state=0 
					Case 3 : L_CharacterCymon.state=1 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=2 
				End Select
			Case 2
				Select Case Int(Rnd*3)+1
					Case 1 : L_CharacterCymon.state=2 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=0 
					Case 2 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=2 : L_CharacterKeenen.state=0 
					Case 3 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=2 
				End Select
			Case 4
				Select Case Int(Rnd*3)+1
					Case 1 : L_CharacterCymon.state=2 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=0 
					Case 2 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=2 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=0 
					Case 3 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=2 
				End Select
			Case 8
				Select Case Int(Rnd*3)+1
					Case 1 : L_CharacterCymon.state=2 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=1 
					Case 2 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=2 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=1 
					Case 3 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=2 : L_CharacterKeenen.state=1 
				End Select
			Case 9
				Select Case Int(Rnd*2)+1
					Case 1 : L_CharacterCymon.state=1 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=2 : L_CharacterKeenen.state=1
					Case 2 : L_CharacterCymon.state=1 : L_CharacterMaggie.state=2 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=1
				End Select
			Case 3
				Select Case Int(Rnd*2)+1
					Case 1 : L_CharacterCymon.state=1 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=2 : L_CharacterKeenen.state=0 
					Case 2 : L_CharacterCymon.state=1 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=2 
				End Select
			Case 6
				Select Case Int(Rnd*2)+1
					Case 1 : L_CharacterCymon.state=2 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=0 
					Case 2 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=2 
				End Select
			Case 12
				Select Case Int(Rnd*2)+1
					Case 1 : L_CharacterCymon.state=2 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=1 
					Case 2 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=2 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=1 
				End Select
			Case 5
				Select Case Int(Rnd*2)+1
					Case 1 : L_CharacterCymon.state=1 : L_CharacterMaggie.state=2 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=0
					Case 2 : L_CharacterCymon.state=1 : L_CharacterMaggie.state=0 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=2
				End Select
			Case 10
				Select Case Int(Rnd*2)+1
					Case 1 : L_CharacterCymon.state=2 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=0 : L_CharacterKeenen.state=1
					Case 2 : L_CharacterCymon.state=0 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=2 : L_CharacterKeenen.state=1
				End Select
			Case 7
				L_CharacterCymon.state=1 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=2
			Case 11
				L_CharacterCymon.state=1 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=2 : L_CharacterKeenen.state=1
			Case 13
				L_CharacterCymon.state=1 : L_CharacterMaggie.state=2 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=1
			Case 14
				L_CharacterCymon.state=2 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=1
			Case 15
				L_CharacterCymon.state=1 : L_CharacterMaggie.state=1 : L_CharacterYolo.state=1 : L_CharacterKeenen.state=1
				Ignite L_GoalRescueYourFriends
			Case Else
				CrashTheTable
		End Select
	End If
	If SuperJackpotComplete=1 Then Ignite L_GoalCollectSuperJackpot
End Sub

'============
'§ Ink Bars §
'============

Dim CyanInkLevel
Dim MagentaInkLevel
Dim YellowInkLevel
Dim KeyInkLevel
Dim SpectrumMode
Dim	CyanComplete
Dim	MagentaComplete
Dim	YellowComplete
Dim	BlueComplete
Dim	RedComplete
Dim	GreenComplete

Sub ResetInkLevels
	CyanInkLevel=0
	MagentaInkLevel=0
	YellowInkLevel=0
	KeyInkLevel=0
	UpdateInkLevels
End Sub

Sub UpdateInkLevels ' Sub to tie the ink display to the level
	Select Case CyanInkLevel
		Case 0
			L_CyanLevel1.state=1 : L_CyanLevel1.image="lightson"
			L_CyanLevel2.state=1 : L_CyanLevel2.image="lightson"
			L_CyanLevel3.state=1 : L_CyanLevel3.image="lightson"
			L_CyanLevel4.state=1 : L_CyanLevel4.image="lightson"
		Case 1
			L_CyanLevel1.state=1 : L_CyanLevel1.image="lightsspecial"
			L_CyanLevel2.state=1 : L_CyanLevel2.image="lightson"
			L_CyanLevel3.state=1 : L_CyanLevel3.image="lightson"
			L_CyanLevel4.state=1 : L_CyanLevel4.image="lightson"
		Case 2
			L_CyanLevel1.state=1 : L_CyanLevel1.image="lightsspecial"
			L_CyanLevel2.state=1 : L_CyanLevel2.image="lightsspecial"
			L_CyanLevel3.state=1 : L_CyanLevel3.image="lightson"
			L_CyanLevel4.state=1 : L_CyanLevel4.image="lightson"
		Case 3
			L_CyanLevel1.state=1 : L_CyanLevel1.image="lightsspecial"
			L_CyanLevel2.state=1 : L_CyanLevel2.image="lightsspecial"
			L_CyanLevel3.state=1 : L_CyanLevel3.image="lightsspecial"
			L_CyanLevel4.state=1 : L_CyanLevel4.image="lightson"
		Case 4
			L_CyanLevel1.state=1 : L_CyanLevel1.image="lightsspecial"
			L_CyanLevel2.state=1 : L_CyanLevel2.image="lightsspecial"
			L_CyanLevel3.state=1 : L_CyanLevel3.image="lightsspecial"
			L_CyanLevel4.state=1 : L_CyanLevel4.image="lightsspecial"
	End Select
	Select Case MagentaInkLevel
		Case 0
			L_MagentaLevel1.state=1 : L_MagentaLevel1.image="lightson"
			L_MagentaLevel2.state=1 : L_MagentaLevel2.image="lightson"
			L_MagentaLevel3.state=1 : L_MagentaLevel3.image="lightson"
			L_MagentaLevel4.state=1 : L_MagentaLevel4.image="lightson"
		Case 1
			L_MagentaLevel1.state=1 : L_MagentaLevel1.image="lightsspecial"
			L_MagentaLevel2.state=1 : L_MagentaLevel2.image="lightson"
			L_MagentaLevel3.state=1 : L_MagentaLevel3.image="lightson"
			L_MagentaLevel4.state=1 : L_MagentaLevel4.image="lightson"
		Case 2
			L_MagentaLevel1.state=1 : L_MagentaLevel1.image="lightsspecial"
			L_MagentaLevel2.state=1 : L_MagentaLevel2.image="lightsspecial"
			L_MagentaLevel3.state=1 : L_MagentaLevel3.image="lightson"
			L_MagentaLevel4.state=1 : L_MagentaLevel4.image="lightson"
		Case 3
			L_MagentaLevel1.state=1 : L_MagentaLevel1.image="lightsspecial"
			L_MagentaLevel2.state=1 : L_MagentaLevel2.image="lightsspecial"
			L_MagentaLevel3.state=1 : L_MagentaLevel3.image="lightsspecial"
			L_MagentaLevel4.state=1 : L_MagentaLevel4.image="lightson"
		Case 4
			L_MagentaLevel1.state=1 : L_MagentaLevel1.image="lightsspecial"
			L_MagentaLevel2.state=1 : L_MagentaLevel2.image="lightsspecial"
			L_MagentaLevel3.state=1 : L_MagentaLevel3.image="lightsspecial"
			L_MagentaLevel4.state=1 : L_MagentaLevel4.image="lightsspecial"
	End Select
	Select Case YellowInkLevel
		Case 0
			L_YellowLevel1.state=1 : L_YellowLevel1.image="lightson"
			L_YellowLevel2.state=1 : L_YellowLevel2.image="lightson"
			L_YellowLevel3.state=1 : L_YellowLevel3.image="lightson"
			L_YellowLevel4.state=1 : L_YellowLevel4.image="lightson"
		Case 1
			L_YellowLevel1.state=1 : L_YellowLevel1.image="lightsspecial"
			L_YellowLevel2.state=1 : L_YellowLevel2.image="lightson"
			L_YellowLevel3.state=1 : L_YellowLevel3.image="lightson"
			L_YellowLevel4.state=1 : L_YellowLevel4.image="lightson"
		Case 2
			L_YellowLevel1.state=1 : L_YellowLevel1.image="lightsspecial"
			L_YellowLevel2.state=1 : L_YellowLevel2.image="lightsspecial"
			L_YellowLevel3.state=1 : L_YellowLevel3.image="lightson"
			L_YellowLevel4.state=1 : L_YellowLevel4.image="lightson"
		Case 3
			L_YellowLevel1.state=1 : L_YellowLevel1.image="lightsspecial"
			L_YellowLevel2.state=1 : L_YellowLevel2.image="lightsspecial"
			L_YellowLevel3.state=1 : L_YellowLevel3.image="lightsspecial"
			L_YellowLevel4.state=1 : L_YellowLevel4.image="lightson"
		Case 4
			L_YellowLevel1.state=1 : L_YellowLevel1.image="lightsspecial"
			L_YellowLevel2.state=1 : L_YellowLevel2.image="lightsspecial"
			L_YellowLevel3.state=1 : L_YellowLevel3.image="lightsspecial"
			L_YellowLevel4.state=1 : L_YellowLevel4.image="lightsspecial"
	End Select
	Select Case KeyInkLevel
		Case 0
			L_KeyLevel1.state=1 : L_KeyLevel1.image="lightson"
			L_KeyLevel2.state=1 : L_KeyLevel2.image="lightson"
			L_KeyLevel3.state=1 : L_KeyLevel3.image="lightson"
			L_KeyLevel4.state=1 : L_KeyLevel4.image="lightson"
		Case 1
			L_KeyLevel1.state=0 : L_KeyLevel1.image="lightsoff"
			L_KeyLevel2.state=1 : L_KeyLevel2.image="lightson"
			L_KeyLevel3.state=1 : L_KeyLevel3.image="lightson"
			L_KeyLevel4.state=1 : L_KeyLevel4.image="lightson"
		Case 2
			L_KeyLevel1.state=0 : L_KeyLevel1.image="lightsoff"
			L_KeyLevel2.state=0 : L_KeyLevel2.image="lightsoff"
			L_KeyLevel3.state=1 : L_KeyLevel3.image="lightson"
			L_KeyLevel4.state=1 : L_KeyLevel4.image="lightson"
		Case 3
			L_KeyLevel1.state=0 : L_KeyLevel1.image="lightsoff"
			L_KeyLevel2.state=0 : L_KeyLevel2.image="lightsoff"
			L_KeyLevel3.state=0 : L_KeyLevel3.image="lightsoff"
			L_KeyLevel4.state=1 : L_KeyLevel4.image="lightson"
		Case 4
			L_KeyLevel1.state=0 : L_KeyLevel1.image="lightsoff"
			L_KeyLevel2.state=0 : L_KeyLevel2.image="lightsoff"
			L_KeyLevel3.state=0 : L_KeyLevel3.image="lightsoff"
			L_KeyLevel4.state=0 : L_KeyLevel4.image="lightsoff"
	End Select
	If SpectrumMode=0 And GameOver=0 Then CheckIfInkFull
End Sub

Sub CheckIfInkFull
	Select Case BossBattle
		Case 0
		If CyanInkLevel=4 And KeyInkLevel=4 And L_SpectrumCyan.state=0 And SpectrumMode=0 Then
			If QuietSounds.enabled=0 Then PlaySound "sega_beginspectrum", 0 , DigitalSoundsLevel	
			SpectrumMode=1
			KKill ModeInserts
			If RescueMode=0 Then KKill DropTargetLights
			BBlink CyanInserts
			Blink L_StandupTriangle
			Blink L_SpectrumCyan
			SegmentColor Cyan
			If CountingBonus = 0 Then ScrollFromTopLeft     "     MODE - CYAN    "
			ParkMessageBottom =  "   SHOOT FLASHING   "
			If CountingBonus = 0 Then ScrollFromBottomRight "   SHOOT FLASHING   "
			If SpectrumGoalComplete=0 Then Blink L_GoalCompleteSpectrum
		End If
		If CyanInkLevel=4 And MagentaInkLevel=4 And L_SpectrumBlue.state=0 And SpectrumMode=0 Then
			If QuietSounds.enabled=0 Then PlaySound "sega_beginspectrum", 0 , DigitalSoundsLevel	
			SpectrumMode=2
			KKill ModeInserts
			If RescueMode=0 Then KKill DropTargetLights
			BBlink CyanInserts
			BBlink MagentaInserts
			Blink L_SpectrumBlue
			SegmentColor Blue
			If CountingBonus = 0 Then ScrollFromTopRight     "     MODE - BLUE    "
			ParkMessageBottom =  "     SHOOT C + M    "
			If CountingBonus = 0 Then ScrollFromBottomLeft   "     SHOOT C + M    "
			If SpectrumGoalComplete=0 Then Blink L_GoalCompleteSpectrum
		End If
		If MagentaInkLevel=4 And KeyInkLevel=4 And L_SpectrumMagenta.state=0 And SpectrumMode=0 Then
			If QuietSounds.enabled=0 Then PlaySound "sega_beginspectrum", 0 , DigitalSoundsLevel	
			SpectrumMode=3
			KKill ModeInserts
			If RescueMode=0 Then KKill DropTargetLights
			BBlink MagentaInserts
			Blink L_StandupTriangle
			Blink L_SpectrumMagenta
			SegmentColor Magenta
			If CountingBonus = 0 Then ScrollFromTopLeft     "   MODE - MAGENTA   "
			ParkMessageBottom =  "   SHOOT FLASHING   "
			If CountingBonus = 0 Then ScrollFromBottomRight "   SHOOT FLASHING   "
			If SpectrumGoalComplete=0 Then Blink L_GoalCompleteSpectrum
		End If
		If MagentaInkLevel=4 And YellowInkLevel=4 And L_SpectrumRed.state=0 And SpectrumMode=0 Then
			If QuietSounds.enabled=0 Then PlaySound "sega_beginspectrum", 0 , DigitalSoundsLevel	
			SpectrumMode=4
			KKill ModeInserts
			If RescueMode=0 Then KKill DropTargetLights
			BBlink MagentaInserts
			BBlink YellowInserts
			Blink L_SpectrumRed
			SegmentColor Red
			If CountingBonus = 0 Then ScrollFromTopRight     "     MODE - RED     "
			ParkMessageBottom =  "     SHOOT M + Y    "
			If CountingBonus = 0 Then ScrollFromBottomLeft   "     SHOOT M + Y    "
			If SpectrumGoalComplete=0 Then Blink L_GoalCompleteSpectrum
		End If
		If YellowInkLevel=4 And KeyInkLevel=4 And L_SpectrumYellow.state=0 And SpectrumMode=0 Then
			If QuietSounds.enabled=0 Then PlaySound "sega_beginspectrum", 0 , DigitalSoundsLevel	
			SpectrumMode=5
			KKill ModeInserts
			If RescueMode=0 Then KKill DropTargetLights
			BBlink YellowInserts
			Blink L_StandupTriangle
			Blink L_SpectrumYellow
			SegmentColor Yellow
			If CountingBonus = 0 Then ScrollFromTopLeft     "    MODE - YELLOW   "
			ParkMessageBottom =  "   SHOOT FLASHING   "
			If CountingBonus = 0 Then ScrollFromBottomRight "   SHOOT FLASHING   "
			If SpectrumGoalComplete=0 Then Blink L_GoalCompleteSpectrum
		End If
		If YellowInkLevel=4 And CyanInkLevel=4 And L_SpectrumGreen.state=0 And SpectrumMode=0 Then
			If QuietSounds.enabled=0 Then PlaySound "sega_beginspectrum", 0 , DigitalSoundsLevel	
			SpectrumMode=6
			KKill ModeInserts
			If RescueMode=0 Then KKill DropTargetLights
			BBlink YellowInserts
			BBlink CyanInserts
			Blink L_SpectrumGreen
			SegmentColor Green
			If CountingBonus = 0 Then ScrollFromTopRight     "     MODE - GREEN    "
			ParkMessageBottom =  "     SHOOT Y + C    "
			If CountingBonus = 0 Then ScrollFromBottomLeft   "     SHOOT Y + C    "
			If SpectrumGoalComplete=0 Then Blink L_GoalCompleteSpectrum
		End If
		If CyanInkLevel=4 And MagentaInkLevel=4 And YellowInkLevel=4 And KeyInkLevel=4 And SpectrumGoalComplete=1 Then
			DrainInkIncrement=4
			SimpleBlinkTop "  SPECTRUM OVERFLOW  "
            DisplayANumber Overflow_Score
			DrainInkForBonus.enabled=1
		End If
	Case 1
		If CyanInkLevel=4 Then
			EnemyHealth=EnemyHealth-1
			CyanInkLevel=0
			UpdateHealth
			PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel	
			UpdateInkLevels
		End If
		If MagentaInkLevel=4 Then
			EnemyHealth=EnemyHealth-1
			MagentaInkLevel=0
			UpdateHealth
			PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel	
			UpdateInkLevels
		End If
		If YellowInkLevel=4 Then
			EnemyHealth=EnemyHealth-1
			YellowInkLevel=0
			UpdateHealth
			PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel	
			UpdateInkLevels
		End If
		If KeyInkLevel=4 Then
			EnemyHealth=EnemyHealth-1
			KeyInkLevel=0
			UpdateHealth
			PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel	
			UpdateInkLevels
		End If
	End Select
End Sub

'===============
'§ Boss Battle §
'===============

Sub SurpriseBossBattle
	RBarrelDown
	ParkMessageTop  = "                    "
	ParkMessageBottom  = "                    "
	If BallsOnPlayfield>1 Then SimpleBlinkTop    "      SURPRISE      "
	If BallsOnPlayfield>1 Then SimpleBlinkBottom "     BOSS FIGHT     "
	PlaySound "sega_bossbattlemessages", 0 , DigitalSoundsLevel
	PlayMusic "music_bosslooping"
	GIColor Black
	PlayfieldColor = Neutral
	SegmentColor Neutral
	KKill AllInserts
	TTurnOff FriendsInserts
	DrainInkIncrement=3
	DrainInkForBonus.enabled=1
	RescueMode=0
	If DropBlack.IsDropped + DropYellow.IsDropped + DropMagenta.IsDropped + DropCyan.IsDropped <>4 Then
		Dim LocalDrop
		For Each LocalDrop In FourDropTargets
			LocalDrop.IsDropped=1
		Next
		PlaySoundAt "fx_resetdrop", centerdropsound
	End If
	SpectrumMode=0
	BossBattle=1
	BBlink KeyInserts
	BBlink YellowInserts
	BBlink MagentaInserts
	BBlink CyanInserts
	BBlink DropTargetLights
	L_CharacterSlater.State=2
	DrainInkForBonus.enabled=1
	JackpotsAwarded=0
	Start4MultiBall.enabled=1
	EnemyHealth=11
	PlayerHealth=11
	DisplayMeterImmediately.enabled=1
End Sub

Sub DisplayMeterImmediately_Timer
	UpdateHealth
	DisplayMeterImmediately.enabled=0
End Sub

Sub InitiateBossBattle
	FirstBossBattle=1
	RBarrelDown
	ParkMessageTop  = "                    "
	ParkMessageBottom  = "                    "
	SimpleBlinkTop   "        BOSS        "
	SimpleBlinkBottom "       BATTLE       "
	StopMusic
	PlaySound "sega_bossbattlemessage", 0 , DigitalSoundsLevel
	GIColor Black
	PlayfieldColor = Neutral
	SegmentColor Neutral
	KKill AllInserts
	TTurnOff FriendsInserts
	DrainInkIncrement=3
	DrainInkForBonus.enabled=1
	BossBattle1.enabled=1
	BossBattle2.enabled=1
	BossBattle3.enabled=1
	RescueMode=0
	If DropBlack.IsDropped + DropYellow.IsDropped + DropMagenta.IsDropped + DropCyan.IsDropped <>4 Then
		Dim LocalDrop
		For Each LocalDrop In FourDropTargets
			LocalDrop.IsDropped=1
		Next
		PlaySoundAt "fx_resetdrop", centerdropsound
	End If
	SpectrumMode=0
	BossBattle=1

End Sub

Sub BossBattle1_Timer
	ScrollFromTopLeft     "    CHARGE COLORS   "
	ScrollFromBottomRight "      TO ATTACK     "
	PlaySound "sega_bossbattlemessage", 0 , DigitalSoundsLevel
	BBlink KeyInserts
	BBlink YellowInserts
	BBlink MagentaInserts
	BBlink CyanInserts
	BBlink DropTargetLights
	BossBattle1.enabled=0
End Sub

Sub BossBattle2_Timer
	ScrollFromTopRight   " ENDLESS BALL SAVE  "
	ScrollFromBottomLeft " UNTIL SOMEONE WINS "
	PlaySound "sega_bossbattlemessage", 0 , DigitalSoundsLevel
	L_CharacterSlater.State=1
	BossBattle2.enabled=0
End Sub

Sub BossBattle3_Timer
	SimpleBlinkTop   "        GOOD        "
	SimpleBlinkBottom   "        LUCK        "
	PlaySound "sega_bossbattlemessages", 0 , DigitalSoundsLevel
	PlayMusic "music_bossintro"
	BossMusic.enabled=1
	ParkMessageTop = "PLAYER |~~~~~~~~~~~|"
	ParkMessageBottom = "ENEMY  |~~~~~~~~~~~|"
	BossBattle3.enabled=0
	JackpotsAwarded=0
	LeftEject 'This sub will only be called when there's a single ball on the playfield and that ball will need to be ejected.
	Start4MultiBall.enabled=1
	EnemyHealth=11
	PlayerHealth=11
	BossBattle3.enabled=0
	L_CharacterSlater.State=2
End Sub

Dim EnemyHealth
Dim PlayerHealth

Sub UpdateHealth
	Select Case EnemyHealth
		Case 0 : DisplayBottom  "ENEMY  |-----------|" : ParkMessageBottom = "ENEMY  |-----------|" : 	BossGoalComplete=1 : BossBattleDefeat
		Case 1 : DisplayBottom  "ENEMY  |~----------|" : ParkMessageBottom = "ENEMY  |~----------|"
		Case 2 : DisplayBottom  "ENEMY  |~~---------|" : ParkMessageBottom = "ENEMY  |~~---------|"
		Case 3 : DisplayBottom  "ENEMY  |~~~--------|" : ParkMessageBottom = "ENEMY  |~~~--------|"
		Case 4 : DisplayBottom  "ENEMY  |~~~~-------|" : ParkMessageBottom = "ENEMY  |~~~~-------|"
		Case 5 : DisplayBottom  "ENEMY  |~~~~~------|" : ParkMessageBottom = "ENEMY  |~~~~~------|"
		Case 6 : DisplayBottom  "ENEMY  |~~~~~~-----|" : ParkMessageBottom = "ENEMY  |~~~~~~-----|"
		Case 7 : DisplayBottom  "ENEMY  |~~~~~~~----|" : ParkMessageBottom = "ENEMY  |~~~~~~~----|"
		Case 8 : DisplayBottom  "ENEMY  |~~~~~~~~---|" : ParkMessageBottom = "ENEMY  |~~~~~~~~---|"
		Case 9 : DisplayBottom  "ENEMY  |~~~~~~~~~--|" : ParkMessageBottom = "ENEMY  |~~~~~~~~~--|"
		Case 10: DisplayBottom  "ENEMY  |~~~~~~~~~~-|" : ParkMessageBottom = "ENEMY  |~~~~~~~~~~-|"
		Case 11: DisplayBottom  "ENEMY  |~~~~~~~~~~~|" : ParkMessageBottom = "ENEMY  |~~~~~~~~~~~|"
	End Select
	Select Case PlayerHealth
		Case 0 : DisplayTop "PLAYER |-----------|" : ParkMessageTop = "PLAYER |-----------|" : BossBattleDefeat
		Case 1 : DisplayTop "PLAYER |~----------|" : ParkMessageTop = "PLAYER |~----------|"
		Case 2 : DisplayTop "PLAYER |~~---------|" : ParkMessageTop = "PLAYER |~~---------|"
		Case 3 : DisplayTop "PLAYER |~~~--------|" : ParkMessageTop = "PLAYER |~~~--------|"
		Case 4 : DisplayTop "PLAYER |~~~~-------|" : ParkMessageTop = "PLAYER |~~~~-------|"
		Case 5 : DisplayTop "PLAYER |~~~~~------|" : ParkMessageTop = "PLAYER |~~~~~------|"
		Case 6 : DisplayTop "PLAYER |~~~~~~-----|" : ParkMessageTop = "PLAYER |~~~~~~-----|"
		Case 7 : DisplayTop "PLAYER |~~~~~~~----|" : ParkMessageTop = "PLAYER |~~~~~~~----|"
		Case 8 : DisplayTop "PLAYER |~~~~~~~~---|" : ParkMessageTop = "PLAYER |~~~~~~~~---|"
		Case 9 : DisplayTop "PLAYER |~~~~~~~~~--|" : ParkMessageTop = "PLAYER |~~~~~~~~~--|"
		Case 10: DisplayTop "PLAYER |~~~~~~~~~~-|" : ParkMessageTop = "PLAYER |~~~~~~~~~~-|"
		Case 11: DisplayTop "PLAYER |~~~~~~~~~~~|" : ParkMessageTop = "PLAYER |~~~~~~~~~~~|"
	End Select
End Sub


Sub YouSuck 'This sub should only call if the player is stuck in an unusual configuration (lost too many boss battles, missed every available super jackpot) where progress is impossible. It demotes their progress to a point at which they can still advance to wizard mode.
	If BossGoalComplete=1 And SpectrumGoalComplete=1 And RescueGoalComplete=1 And SuperJackpotComplete=0 Then                             							
		ScrollFromTopRight   " NEED SUPER JACKPOT "
		ScrollFromBottomLeft "FOR TOTAL SATURATION"
	End If
	Select Case Int(Rnd*3)+1
		Case 1
			CyanComplete=0
			SpectrumGoalComplete=0
			Kill L_GoalCompleteSpectrum
			Kill L_SpectrumCyan
			Kill L_SpectrumWhite
		Case 2
			MagentaComplete=0
			SpectrumGoalComplete=0
			Kill L_GoalCompleteSpectrum
			Kill L_SpectrumMagenta
			Kill L_SpectrumWhite
		Case 3
			YellowComplete=0
			SpectrumGoalComplete=0
			Kill L_GoalCompleteSpectrum
			Kill L_SpectrumYellow
			Kill L_SpectrumWhite
	End Select
	Select Case Int(Rnd*3)+1
		Case 1
			BlueComplete=0
			Kill L_SpectrumBlue
		Case 2
			RedComplete=0
			Kill L_SpectrumRed
		Case 3
			GreenComplete=0
			Kill L_SpectrumGreen
	End Select
	Select Case Int(Rnd*3)+1
		Case 1
			CymonRescued=0
			L_CharacterCymon.state=0
			KeenenRescued=0
			L_CharacterKeenen.state=0
			RescueGoalComplete=0
			Kill L_GoalRescueYourFriends
			UpdateCharacterLights
		Case 2
			MaggieRescued=0
			L_CharacterMaggie.state=0
			KeenenRescued=0
			L_CharacterKeenen.state=0	
			RescueGoalComplete=0
			Kill L_GoalRescueYourFriends
			UpdateCharacterLights
		Case 3
			YoloRescued=0
			L_CharacterYolo.state=0
			KeenenRescued=0
			L_CharacterKeenen.state=0		
			RescueGoalComplete=0
			Kill L_GoalRescueYourFriends
			UpdateCharacterLights
	End Select
End Sub

Sub BossBattleDefeat
	BossBattle=0
	RescueLevel=0
	RescueMode=0
	SpectrumMode=0
	Select Case BossGoalComplete
		Case 0
			SimpleBlinkTop      "        YOU         "
			SimpleBlinkBottom   "       FAILED       "
			PlaySound "sega_bossbattledefeat", 0 , DigitalSoundsLevel
		Case 1
			SimpleBlinkTop      "    YOU DEFEATED    " 
			SimpleBlinkBottom   "       SLATER       "
			PlaySound "sega_bossbattlevictory", 0 , DigitalSoundsLevel
			IGiveUp.enabled=1
	End Select
	ParkMessageTop =    ""
	ParkMessageBottom = ""
	StopMusic
	KillSolenoids
	KKill AllInserts
	L_CharacterSlater.State=0
	YouHaveFailed.enabled=1
End Sub

Sub IGiveUp_Timer 'I give up trying to figure out why the LED display bugs out when you lose the fight but not when you win. Even when I use the exact same Sub for both victories and defeats, it still bugs. What the heck.
	SimpleBlinkTop      "   VICTORY AWARD    "
	Scoring : AddScore BossVictory_Score
	DisplayANumber BossVictory_Score
	PlaySound "music_bossvictory", 0 , DigitalSoundsLevel
	IGiveUp.enabled=0
End Sub
	

Sub YouHaveFailed_Timer
	ParkMessageTop =    ""
	ParkMessageBottom = ""	
	If BallsOnPlayfield=0 Then
			WakeupSolenoids
			YouHaveFailed.enabled=0
		If SpectrumGoalComplete + RescueGoalComplete + BossGoalComplete + SuperJackpotComplete = 4 Then
			ProceedImmediatelyToWizardMode
		Else
			GIColor Neutral
			SavedBalls=1
			UpdateCharacterLights
			If CymonRescued=1 And MaggieRescued=1 And YoloRescued=1 And KeenenRescued=1 Then
				RescueGoalComplete = 1
				Ignite L_GoalRescueYourFriends
			End If
			If CyanComplete = 1 Then L_SpectrumCyan.UserValue=1
			If BlueComplete = 1 Then L_SpectrumBlue.UserValue=1
			If MagentaComplete = 1 Then L_SpectrumMagenta.UserValue=1
			If RedComplete = 1 Then L_SpectrumRed.UserValue=1
			If YellowComplete = 1 Then L_SpectrumYellow.UserValue=1
			If GreenComplete = 1 Then L_SpectrumGreen.UserValue=1
			If L_SpectrumCyan.UserValue=1 And L_SpectrumBlue.UserValue=1 And L_SpectrumMagenta.UserValue=1 And L_SpectrumRed.UserValue=1 And L_SpectrumYellow.UserValue=1 And L_SpectrumGreen.UserValue=1 Then
				Ignite L_SpectrumWhite
				Ignite L_GoalCompleteSpectrum
				SpectrumGoalComplete=1
			End If
			If BossGoalComplete then Ignite L_GoalDefeatSlater
			If RescueGoalComplete=1 And SpectrumGoalComplete=1 And (BossGoalComplete+SuperJackpotComplete)<2 Then YouSuck ' See above
			If SuperJackpotComplete=1 Then Ignite L_GoalCollectSuperJackpot
			JackpotsAwarded=0
			PlayMusic "music_interrupted"
			UpdateRescueLights
		End If
	End If
End Sub
	

'===============
'§ Wizard Mode §
'===============

Sub ProceedImmediatelyToWizardMode
	PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
	StopMusic
	StopSound "music_bossvictory"
	PlaySound "music_wizard", 0 , DigitalSoundsLevel
	ResetAllModes
	WizardMode=1
	RBarrelDown
	NewGamePlus=NewGamePlus+1
	KKill AllInserts
	PlayfieldColor=Crazy 'I still don't know what this is for. I'm sure it was important when I dimmed it.
	GIColor Crazy
	SegmentColor Neutral
	CrazyInkLights.enabled=1
	CrazyWizardLights.enabled=1
	BBlink ModeInserts
	BBlink JackpotInserts
	Ignite L_GoalRescueYourFriends
	Ignite L_GoalDefeatSlater
	Ignite L_GoalCollectSuperJackpot
	Ignite L_GoalCompleteSpectrum
	L_CharacterCymon.state=2
	L_CharacterMaggie.state=2
	L_CharacterYolo.state=2
	L_CharacterKeenen.state=2
	L_CharacterSlater.state=2
	Blink L_GoalTotalSaturation
	SimpleBlinkTop      "  TOTAL SATURATION  "
	DisplayBottom   " "
	ParkMessageTop    = "  TOTAL SATURATION  "
	ParkMessageBottom = " "
	Start4MultiBall.enabled=1
	SecondsUntilWizardEnd = 47
	AllGoodThingsMustEnd.enabled=1
	BlinkSpectrum.enabled=0
End Sub

Dim SecondsUntilWizardEnd

Sub AllGoodThingsMustEnd_Timer
	SecondsUntilWizardEnd=SecondsUntilWizardEnd-1
	Select Case SecondsUntilWizardEnd
		Case 11
			DisplayTop          "  TOTAL SATURATION  "
			SimpleBlinkBottom   "  TIME REMAINING 9  "
			ParkMessageBottom = "  TIME REMAINING 9  "
		Case 10
			DisplayTop          "  TOTAL SATURATION  "
			SimpleBlinkBottom   "  TIME REMAINING 8  "
			ParkMessageBottom = "  TIME REMAINING 8  "
		Case 9
			DisplayTop          "  TOTAL SATURATION  "
			SimpleBlinkBottom   "  TIME REMAINING 7  "
			ParkMessageBottom = "  TIME REMAINING 7  "
		Case 8
			DisplayTop          "  TOTAL SATURATION  "
			SimpleBlinkBottom   "  TIME REMAINING 6  "
			ParkMessageBottom = "  TIME REMAINING 6  "
		Case 7
			DisplayTop          "  TOTAL SATURATION  "
			SimpleBlinkBottom   "  TIME REMAINING 5  "
			ParkMessageBottom = "  TIME REMAINING 5  "
		Case 6
			DisplayTop          "  TOTAL SATURATION  "
			SimpleBlinkBottom   "  TIME REMAINING 4  "
			ParkMessageBottom = "  TIME REMAINING 4  "
		Case 5
			DisplayTop          "  TOTAL SATURATION  "
			SimpleBlinkBottom   "  TIME REMAINING 3  "
			ParkMessageBottom = "  TIME REMAINING 3  "
		Case 4
			DisplayTop          "  TOTAL SATURATION  "
			SimpleBlinkBottom   "  TIME REMAINING 2  "
			ParkMessageBottom = "  TIME REMAINING 2  "
		Case 3
			DisplayTop          "  TOTAL SATURATION  "
			SimpleBlinkBottom   "  TIME REMAINING 1  "
			ParkMessageBottom = "  TIME REMAINING 1  "
		Case 2
			DisplayTop          "  TOTAL SATURATION  "
			SimpleBlinkBottom   "  TIME REMAINING 0  "
			ParkMessageBottom = "  TIME REMAINING 0  "
		Case 1
			DisplayTop          ""
			SimpleBlinkBottom   "" 
			ParkMessageBottom = ""
			ParkMessageTop = ""
			CrazyInkLights.enabled=0
			CrazyWizardLights.enabled=0
			L_CharacterSlater.state=0
			PlayfieldColor = Black
			GIColor Black
			BlinkSpectrum.enabled=1
			TableTilted=1
			WizardMode=0
			SpectrumMode=0
			RescueMode=0
			BossBattle=0
			ExtraBalls=1
			KillSolenoids
			SpectrumGoalComplete=0
			RescueGoalComplete=0
			SuperJackpotComplete=0
			BossGoalComplete=0
			RescueLevel=0
			ResetInkLevels
			UpdateInkLevels
			KKill AllInserts
			TTurnOff FriendsInserts
		Case 0
			AllGoodThingsMustEnd.enabled=0
			SimpleBlinkTop "     RATTLECAN     "
			Jackpot_Score			= 7500
			PlaySound "sega_startgame", 0 , DigitalSoundsLevel	
			PlaysoundAt "knocker", knockersound
		Case Else
			DisplayTop          "  TOTAL SATURATION  "
	End Select
End Sub

Sub RandomJackpotMessage
	If ParkMessageBottom<>" " Then Exit Sub
	Select Case Int(Rnd*4)+1
		Case 1
			DisplayTop "  TOTAL SATURATION  "
			ScrollFromBottomCenter "      JACKPOT       "
		Case 2
			DisplayTop "  TOTAL SATURATION  "
			ScrollFromBottomLeft "      JACKPOT       "
		Case 3
			DisplayTop "  TOTAL SATURATION  "
			ScrollFromBottomRight "      JACKPOT       "
		Case 4
			DisplayTop "  TOTAL SATURATION  "
			SimpleBlinkBottom "      JACKPOT       "
	End Select
End Sub


'================
'§ Rescue Modes §
'================

Dim RescueMode

Sub UpdateRescueLights
	Select Case RescueLevel 
		Case 0
			KKill CaptiveBallLights
			If CymonRescued+MaggieRescued+YoloRescued+KeenenRescued<4 Then Blink L_CaptiveBall1
		Case 1
			Ignite L_CaptiveBall1
			Blink L_CaptiveBall2
			If QuietSounds.enabled=0 Then PlaySound "sega_hitlitshot", 0 , DigitalSoundsLevel	
		Case 2
			Ignite L_CaptiveBall1
			Ignite L_CaptiveBall2
			Blink L_CaptiveBall3
			If QuietSounds.enabled=0 Then PlaySound "sega_hitlitshot", 0 , DigitalSoundsLevel	
		Case 3
			Ignite L_CaptiveBall1
			Ignite L_CaptiveBall2
			Ignite L_CaptiveBall3
			If L_CharacterCymon.state=2 Then RescueMode=1
			If L_CharacterMaggie.state=2 Then RescueMode=2
			If L_CharacterYolo.state=2 Then RescueMode=3
			If L_CharacterKeenen.state=2 Then RescueMode=4
			KKill DropTargetLights
			If QuietSounds.enabled=0 Then PlaySound "sega_beginrescue", 0 , DigitalSoundsLevel	
			InitiateRescue
	End Select
End Sub	

Sub InitiateRescue
	If QuietSounds.enabled=0 Then PlaySound "sega_beginrescue", 0 , DigitalSoundsLevel	
	RescueProgress = 0
	Select Case RescueMode
		Case 1
			If CountingBonus = 0 Then ScrollFromBottomRight   "  TO RESCUE CYMON   "
			RescueGoal = (CymonRescued+MaggieRescued+YoloRescued+1)*4
		Case 2
			If CountingBonus = 0 Then ScrollFromBottomRight   "  TO RESCUE MAGGIE  "
			RescueGoal = (CymonRescued+MaggieRescued+YoloRescued+1)*4
		Case 3
			If CountingBonus = 0 Then ScrollFromBottomRight   "   TO RESCUE YOLO   "
			RescueGoal = (CymonRescued+MaggieRescued+YoloRescued+1)*4
		Case 4
			If CountingBonus = 0 Then ScrollFromBottomRight   "  TO RESCUE KEENEN  "
			RescueGoal = 4 ' Keenen is always goal level 4. Everyone else is progressive.
	End Select
	If ParkMessageTop="" Then ScrollFromTopLeft   "    SHOOT SPIDERS   "
	ParkMessageTop=   "    SHOOT SPIDERS   "
	BBlink DropTargetLights
	If SpectrumMode=0 Then KKill ModeInserts
	If RescueGoalComplete=0 Then Blink L_GoalRescueYourFriends
End Sub

Sub AwardRescue 
	KKill DropTargetLights
	If BallsOnPlayfield>1 Then
		StartMultiBall 4
	End If
	If ParkMessageTop = "    SHOOT SPIDERS   " Then ParkMessageTop=""
	FriendsThisBall=FriendsThisBall+1
	If FriendsThisBall=3 Then
		SimpleBlinkTop "     EXTRA BALL     "
		PlaySound "sega_extraball", 0 , DigitalSoundsLevel
		PlaysoundAt "knocker", knockersound
		FriendsThisBall=0
		ExtraBalls=ExtraBalls+1
	Else
		PlaySound "sega_rescuesuccess", 0 , DigitalSoundsLevel
		If JustRolledOver=1 Then
			ScrollFromTopRight "  ROLLOVER RESCUE   "
			JustRolledOver=0
		Else
			ScrollFromTopLeft "    RESCUE AWARD    "
		End If
	End If
	If (DropCyan.IsDropped + DropMagenta.IsDropped + DropYellow.IsDropped + DropBlack.IsDropped)<>4 Then
		DropCyan.IsDropped=1
		DropMagenta.IsDropped=1
		DropYellow.IsDropped=1
		DropBlack.IsDropped=1
		PlaySoundAt "fx_resetdrop", centerdropsound
	End If
	Dim TempRescueScore
	Select Case RescueMode
		Case 1
			L_CharacterCymon.state=1
			CymonRescued=1
			TempRescueScore = CymonRescue_Score
		Case 2
			L_CharacterMaggie.state=1
			MaggieRescued=1
			TempRescueScore = MaggieRescue_Score
		Case 3
			L_CharacterYolo.state=1
			YoloRescued=1
			TempRescueScore = YoloRescue_Score
		Case 4
			L_CharacterKeenen.state=1
			KeenenRescued=1
			TempRescueScore = KeenenRescue_Score
	End Select
	BlinkANumber TempRescueScore
	Scoring: AddScore TempRescueScore
	RescueLevel = 0
	UpdateRescueLights
	RescueProgress = 0
	RescueMode = 0
	UpdateCharacterLights
	If CymonRescued=1 And MaggieRescued=1 And YoloRescued=1 And KeenenRescued=1 Then
		RescueGoalComplete=1
		Ignite L_GoalRescueYourFriends
		If BossGoalComplete=0 Then Blink L_GoalDefeatSlater
		If BossGoalComplete+SpectrumGoalComplete+RescueGoalComplete+SuperJackpotComplete=4 Then
			ProceedImmediatelyToWizardMode
			Exit Sub
		End If
	Else
		Kill L_GoalRescueYourFriends
	End If
	If BallsOnPlayfield=1 Then
		LocksLitTimer.enabled=1
	Else
		ScrollFromTopLeft     "       RESCUE       "
		ScrollFromBottomRight "      MULTIBALL     "					
		PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
		PlayMusic "music_4mb"
		RBarrelDown
		StartMultiBall 4
		If RescueMode=0 Then KKill DropTargetLights
		If SpectrumMode=0 then KKill ModeInserts
		LockedBalls=0
		Kill L_SpinnerLockBall
		BBlink JackpotInserts
	End If
End Sub

Sub LocksLitTimer_Timer
	If BallsOnPlayfield=1 Then
		If L_GoalDefeatSlater.UserValue = 2 Then
			ScrollFromTopCenter "BOSS FIGHT UNLOCKED "
			Blink L_ScoopTriangle
			PlaySound "sega_alert", 0 , DigitalSoundsLevel
		Else
			ScrollFromTopCenter "      LOCKS LIT     "
			PlaySound "sega_alert", 0 , DigitalSoundsLevel
		End If
        Blink L_SpinnerLockBall
		If SpectrumMode=0 Then KKill ModeInserts
		RBarrelUp
			If ParkMessageBottom = "" And CountingBonus=0 Then
				DisplayBallInPlay
			End If
	End If
	LocksLitTimer.enabled=0
End Sub

'=================
'§ Spectrum Mode §
'=================

Sub AdvanceSpectrum(x)
	If x.UserValue=2 Then
		Ignite x
		CheckIfModeComplete
	End If
End Sub

Sub CheckIfModeComplete
	Select Case SpectrumMode
		Case 0
			Exit Sub
		Case 1 ' Cyan
			If L_OrbitTriangle.UserValue=1 And L_LeftBullseyeTriangle.UserValue=1 And L_StandupTriangle.UserValue=1 Then
				Kill L_OrbitTriangle
				Kill L_LeftBullseyeTriangle
				Kill L_StandupTriangle
				Ignite L_SpectrumCyan
				CyanComplete=1
				AwardSpectrum
			End If
		Case 2 ' Blue
			If L_OrbitTriangle.UserValue=1 And L_MagentaRampTriangle.UserValue=1 And L_LeftBullseyeTriangle.UserValue=1 And L_RightBullseyeTriangle.UserValue=1 Then
				Kill L_OrbitTriangle
				Kill L_MagentaRampTriangle
				Kill L_LeftBullseyeTriangle
				Kill L_RightBullseyeTriangle
				Ignite L_SpectrumBlue
				BlueComplete=1
				AwardSpectrum
			End If
		Case 3 ' Magenta
			If L_MagentaRampTriangle.UserValue=1 And L_RightBullseyeTriangle.UserValue=1 And L_StandupTriangle.UserValue=1 Then
				Kill L_MagentaRampTriangle
				Kill L_RightBullseyeTriangle
				Kill L_StandupTriangle
				Ignite L_SpectrumMagenta
				MagentaComplete=1
				AwardSpectrum
			End If
		Case 4 ' Red
			If L_MagentaRampTriangle.UserValue=1 And L_RightBullseyeTriangle.UserValue=1 And L_YellowRampTriangle.UserValue=1 And L_SpinnerTriangle.UserValue=1 Then
				Kill L_MagentaRampTriangle
				Kill L_RightBullseyeTriangle
				Kill L_YellowRampTriangle
				Kill L_SpinnerTriangle
				Ignite L_SpectrumRed
				RedComplete=1
				AwardSpectrum
			End If
		Case 5 ' Yellow
			If L_YellowRampTriangle.UserValue=1 And L_SpinnerTriangle.UserValue=1 And L_StandupTriangle.UserValue=1 Then
				Kill L_YellowRampTriangle
				Kill L_SpinnerTriangle
				Kill L_StandupTriangle
				Ignite L_SpectrumYellow
				YellowComplete=1
				AwardSpectrum
			End If
		Case 6 ' Green
			If L_YellowRampTriangle.UserValue=1 And L_SpinnerTriangle.UserValue=1 And L_OrbitTriangle.UserValue=1 And L_LeftBullseyeTriangle.UserValue=1 Then
				Kill L_YellowRampTriangle
				Kill L_SpinnerTriangle
				Kill L_OrbitTriangle
				Kill L_LeftBullseyeTriangle
				Ignite L_SpectrumGreen
				GreenComplete=1
				AwardSpectrum
			End If
	End Select
End Sub

Dim AwardSpectrumIncrement
Dim DrainInkIncrement
Dim NextSpectrumMultiball

Sub AwardSpectrum
		DrainInkIncrement=3
		AwardSpectrumIncrement=0
		AwardSpectrumTimer.enabled=1
		DrainInkTimer.enabled=1
		ParkMessageBottom=""
		SpectrumThisBall=SpectrumThisBall+1
		If SpectrumThisBall=3 Then
			PlaySound "sega_extraball", 0 , DigitalSoundsLevel
			SimpleBlinkTop "     EXTRA BALL     "
			PlaysoundAt "knocker", knockersound
			SpectrumThisBall=0
			ExtraBalls=ExtraBalls+1
		Else
			PlaySound "sega_spectrumsuccess", 0 , DigitalSoundsLevel
			If JustRolledOver=1 Then
				ScrollFromTopLeft "  SPEED-UP SPECTRUM "
				JustRolledOver=0
			Else
				ScrollFromTopRight "   SPECTRUM AWARD   "
			End If
		End If
		If L_SpectrumCyan.UserValue=1 And L_SpectrumBlue.UserValue=1 And L_SpectrumMagenta.UserValue=1 And L_SpectrumRed.UserValue=1 And L_SpectrumYellow.UserValue=1 And L_SpectrumGreen.UserValue=1 Then
			Ignite L_SpectrumWhite
			Ignite L_GoalCompleteSpectrum
			SpectrumGoalComplete=1
			If BossGoalComplete+SpectrumGoalComplete+RescueGoalComplete+SuperJackpotComplete=4 Then ProceedImmediatelyToWizardMode
		Else
			Kill L_GoalCompleteSpectrum
		End If
End Sub

Dim TempSpectrumScore

Sub DrainInkTimer_Timer
	If CountingBonus=1 Then
		DrainInkTimer.enabled=0
		Exit Sub
	End If

	If WizardMode=1 Then
		DrainInkTimer.enabled=0
		Exit Sub
	End If


	If CyanInkLevel>DrainInkIncrement Then
		Scoring: AddScore CyanBar_Score
		TempSpectrumScore=TempSpectrumScore+CyanBar_Score
	End If

	If CyanInkLevel > 0 Then CyanInkLevel = CyanInkLevel - 1

	If MagentaInkLevel>DrainInkIncrement Then
		Scoring: AddScore MagentaBar_Score
		TempSpectrumScore=TempSpectrumScore+MagentaBar_Score
	End If

	If MagentaInkLevel > 0 Then MagentaInkLevel = MagentaInkLevel - 1

	If YellowInkLevel>DrainInkIncrement Then
		Scoring: AddScore YellowBar_Score
		TempSpectrumScore=TempSpectrumScore+YellowBar_Score
	End If


	If YellowInkLevel > 0 Then YellowInkLevel = YellowInkLevel - 1

	If KeyInkLevel>DrainInkIncrement Then
		Scoring: AddScore KeyBar_Score
		TempSpectrumScore=TempSpectrumScore+KeyBar_Score
	End If

	If KeyInkLevel > 0 Then KeyInkLevel = KeyInkLevel - 1

	UpdateInkLevels
	DisplayBottom TempSpectrumScore
	DrainInkIncrement = DrainInkIncrement - 1

	Select Case Len(TempSpectrumScore) ' This should probably have been replaced with Sub DisplayANumber but it works OK here.
		Case 0 :  DoAbsolutelyNothing
		Case 6 : DisplayBottom "        " & TempSpectrumScore
		Case 7 : DisplayBottom "        " & TempSpectrumScore
		Case 8 : DisplayBottom "       " & TempSpectrumScore
		Case 9 : DisplayBottom "      " & TempSpectrumScore
		Case 10 : DisplayBottom "      "& TempSpectrumScore
		Case 11 : DisplayBottom "     "& TempSpectrumScore
		Case 12 : DisplayBottom "    "& TempSpectrumScore
		Case 13 : DisplayBottom "   "& TempSpectrumScore
		Case 14 : DisplayBottom "  "& TempSpectrumScore
		Case 15 : DisplayBottom " "& TempSpectrumScore
		Case Else  : DisplayBottom TempSpectrumScore
	End Select

	If DrainInkIncrement=-1 then
		DrainInkTimer.enabled=0
		TempSpectrumScore=0
	End If
End Sub

Sub DrainInkForBonus_Timer
	If CyanInkLevel>DrainInkIncrement Then
		Scoring: AddScore BonusInk_Score
	End If

	If CyanInkLevel > 0 Then CyanInkLevel = CyanInkLevel - 1

	If MagentaInkLevel>DrainInkIncrement Then
		Scoring: AddScore BonusInk_Score
	End If

	If MagentaInkLevel > 0 Then MagentaInkLevel = MagentaInkLevel - 1

	If YellowInkLevel>DrainInkIncrement Then
		Scoring: AddScore BonusInk_Score
	End If


	If YellowInkLevel > 0 Then YellowInkLevel = YellowInkLevel - 1

	If KeyInkLevel>DrainInkIncrement Then
		Scoring: AddScore BonusInk_Score
	End If

	If KeyInkLevel > 0 Then KeyInkLevel = KeyInkLevel - 1

	UpdateInkLevels
	DrainInkIncrement = DrainInkIncrement - 1
	If DrainInkIncrement=-1 then
		DrainInkForBonus.enabled=0
		TempSpectrumScore=0
	End If
End Sub

'============
'§ Jackpots §
'============

Dim JackpotsAwarded

Sub AwardJackpot (LightToKill)
	PlaySound "sega_jackpot", 0 , DigitalSoundsLevel
	If WizardMode=0 Then Ignite LightToKill
	JackpotsAwarded=JackpotsAwarded+1
	If JackpotsAwarded>8 Then JackpotsAwarded=8
	Scoring : AddScore Jackpot_Score*JackpotsAwarded
	Select Case JackpotsAwarded
		Case 0
			DoAbsolutelyNothing
		Case 1
			SimpleBlinkTop    "      JACKPOT       "
			SimpleBlinkBottom ""
		Case 2
			SimpleBlinkTop    "   DOUBLE JACKPOT   "
			SimpleBlinkBottom ""
		Case 3
			SimpleBlinkTop    "   TRIPLE JACKPOT   "
			SimpleBlinkBottom ""
		Case 4
			SimpleBlinkTop    "    SUPER JACKPOT   "
			SimpleBlinkBottom ""
			Ignite L_GoalCollectSuperJackpot
			SuperJackpotComplete=1
			Select Case BossGoalComplete+SpectrumGoalComplete+RescueGoalComplete+SuperJackpotComplete
				Case 4
					ProceedImmediatelyToWizardMode
				Case Else
					If RescueGoalComplete=1 And SpectrumGoalComplete=1 Then SurpriseBossBattle
			End Select
		Case 5
			Select Case Int(Rnd*31)+1
				Case 1  : SimpleBlinkTop    "    CRAZY JACKPOT   "
				Case 2  : SimpleBlinkTop    "    MEGA JACKPOT    "
				Case 3  : SimpleBlinkTop    " RIDICULOUS JACKPOT "
				Case 4  : SimpleBlinkTop    "  BODACIOUS JACKPOT "
				Case 5  : SimpleBlinkTop    "  RIGHTEOUS JACKPOT "
				Case 6  : SimpleBlinkTop    "   TUBULAR JACKPOT  "
				Case 7  : SimpleBlinkTop    " OUTRAGEOUS JACKPOT "
				Case 8  : SimpleBlinkTop    "   RADICAL JACKPOT  "
				Case 9  : SimpleBlinkTop    "    HYPER JACKPOT   "
				Case 10 : SimpleBlinkTop    "   GNARLY JACKPOT   "
				Case 11 : SimpleBlinkTop    "   WICKED JACKPOT   "
				Case 12 : SimpleBlinkTop    "   EXTREME JACKPOT  "
				Case 13 : SimpleBlinkTop    "   UNREAL JACKPOT   "
				Case 14 : SimpleBlinkTop    "   AMAZING JACKPOT  "
				Case 15 : SimpleBlinkTop    "   MONSTER JACKPOT  "
				Case 16 : SimpleBlinkTop    "    UBER JACKPOT    "
				Case 17 : SimpleBlinkTop    "  SUPREME JACKPOT   "
				Case 18 : SimpleBlinkTop    "  NUCLEAR JACKPOT   "
				Case 19 : SimpleBlinkTop    "   ATOMIC JACKPOT   "
				Case 20 : SimpleBlinkTop    "  BLAZIN% JACKPOT   "
				Case 21 : SimpleBlinkTop    " INCREDIBLE JACKPOT "
				Case 22 : SimpleBlinkTop    "UNBELIEVABLE JACKPOT"
				Case 23 : SimpleBlinkTop    "   ABSURD JACKPOT   "
				Case 24 : SimpleBlinkTop    " LUDICROUS JACKPOT  "
				Case 25 : SimpleBlinkTop    "    HUGE JACKPOT    "
				Case 26 : SimpleBlinkTop    "  GIGANTIC JACKPOT  "
				Case 27 : SimpleBlinkTop    "   IMMENSE JACKPOT  "
				Case 28 : SimpleBlinkTop    "  COLOSSAL JACKPOT  "
				Case 29 : SimpleBlinkTop    "  ENORMOUS JACKPOT  "
				Case 30 : SimpleBlinkTop    "MAGNIFICENT JACKPOT "
				Case 31 : SimpleBlinkTop    "   INSANE JACKPOT   "
			End Select
		Case Else
			Select Case Int(Rnd*64)+1
				Case 1  : SimpleBlinkTop    "    CRAZY JACKPOT   "
				Case 2  : SimpleBlinkTop    "    MEGA JACKPOT    "
				Case 3  : SimpleBlinkTop    " RIDICULOUS JACKPOT "
				Case 4  : SimpleBlinkTop    "  BODACIOUS JACKPOT "
				Case 5  : SimpleBlinkTop    "  RIGHTEOUS JACKPOT "
				Case 6  : SimpleBlinkTop    "   TUBULAR JACKPOT  "
				Case 7  : SimpleBlinkTop    " OUTRAGEOUS JACKPOT "
				Case 8  : SimpleBlinkTop    "   RADICAL JACKPOT  "
				Case 9  : SimpleBlinkTop    "    HYPER JACKPOT   "
				Case 10 : SimpleBlinkTop    "   GNARLY JACKPOT   "
				Case 11 : SimpleBlinkTop    "   WICKED JACKPOT   "
				Case 12 : SimpleBlinkTop    "   EXTREME JACKPOT  "
				Case 13 : SimpleBlinkTop    "   UNREAL JACKPOT   "
				Case 14 : SimpleBlinkTop    "   AMAZING JACKPOT  "
				Case 15 : SimpleBlinkTop    "   MONSTER JACKPOT  "
				Case 16 : SimpleBlinkTop    "    CRAZY JACKPOT   "
				Case 17 : SimpleBlinkTop    "    MEGA JACKPOT    "
				Case 18 : SimpleBlinkTop    " RIDICULOUS JACKPOT "
				Case 19 : SimpleBlinkTop    "  BODACIOUS JACKPOT "
				Case 20 : SimpleBlinkTop    "  RIGHTEOUS JACKPOT "
				Case 21 : SimpleBlinkTop    "   TUBULAR JACKPOT  "
				Case 22 : SimpleBlinkTop    " OUTRAGEOUS JACKPOT "
				Case 23 : SimpleBlinkTop    "   RADICAL JACKPOT  "
				Case 24 : SimpleBlinkTop    "    HYPER JACKPOT   "
				Case 25 : SimpleBlinkTop    "   GNARLY JACKPOT   "
				Case 26 : SimpleBlinkTop    "   WICKED JACKPOT   "
				Case 27 : SimpleBlinkTop    "   EXTREME JACKPOT  "
				Case 28 : SimpleBlinkTop    "   UNREAL JACKPOT   "
				Case 29 : SimpleBlinkTop    "   AMAZING JACKPOT  "
				Case 30 : SimpleBlinkTop    "   MONSTER JACKPOT  "
				Case 31 : SimpleBlinkTop    "    UBER JACKPOT    "
				Case 32 : SimpleBlinkTop    "    UBER JACKPOT    "
				Case 33 : SimpleBlinkTop    "  SUPREME JACKPOT   "
				Case 34 : SimpleBlinkTop    "  SUPREME JACKPOT   "
				Case 35 : SimpleBlinkTop    "  NUCLEAR JACKPOT   "
				Case 36 : SimpleBlinkTop    "  NUCLEAR JACKPOT   "
				Case 37 : SimpleBlinkTop    "   ATOMIC JACKPOT   "
				Case 38 : SimpleBlinkTop    "   ATOMIC JACKPOT   "
				Case 39 : SimpleBlinkTop    "  BLAZIN% JACKPOT   "
				Case 40 : SimpleBlinkTop    "  BLAZIN% JACKPOT   "
				Case 41 : SimpleBlinkTop    " INCREDIBLE JACKPOT "
				Case 42 : SimpleBlinkTop    " INCREDIBLE JACKPOT "
				Case 43 : SimpleBlinkTop    "UNBELIEVABLE JACKPOT"
				Case 44 : SimpleBlinkTop    "UNBELIEVABLE JACKPOT"
				Case 45 : SimpleBlinkTop    "   ABSURD JACKPOT   "
				Case 46 : SimpleBlinkTop    "   ABSURD JACKPOT   "
				Case 47 : SimpleBlinkTop    " LUDICROUS JACKPOT  "
				Case 48 : SimpleBlinkTop    " LUDICROUS JACKPOT  "
				Case 49 : SimpleBlinkTop    "    HUGE JACKPOT    "
				Case 50 : SimpleBlinkTop    "    HUGE JACKPOT    "
				Case 51 : SimpleBlinkTop    "  GIGANTIC JACKPOT  "
				Case 52 : SimpleBlinkTop    "  GIGANTIC JACKPOT  "
				Case 53 : SimpleBlinkTop    "   IMMENSE JACKPOT  "
				Case 54 : SimpleBlinkTop    "   IMMENSE JACKPOT  "
				Case 55 : SimpleBlinkTop    "  COLOSSAL JACKPOT  "
				Case 56 : SimpleBlinkTop    "  ENORMOUS JACKPOT  "
				Case 57 : SimpleBlinkTop    "  COLOSSAL JACKPOT  "
				Case 58 : SimpleBlinkTop    "  ENORMOUS JACKPOT  "
				Case 59 : SimpleBlinkTop    "REALLYBIGWORDJACKPOT"
				Case 60 : SimpleBlinkTop    "MAGNIFICENT JACKPOT "
				Case 61 : SimpleBlinkTop    "MAGNIFICENT JACKPOT "
				Case 62 : SimpleBlinkTop    "   INSANE JACKPOT   "
				Case 63 : SimpleBlinkTop    "   INSANE JACKPOT   "
				Case 64 : SimpleBlinkTop    "   B-I-T-C-H-I-N%   " : PlaySound "bitchin", 0 , DigitalSoundsLevel
			End Select
			DisplayBottom ""
		End Select
	If L_OrbitJackpot.UserValue<>2 And L_MagentaRampJackpot.UserValue<>2 And L_LeftBullseyeJackpot.UserValue<>2 And L_RightBullseyeJackpot.UserValue<>2 And L_YellowRampJackpot.UserValue<>2 And L_StandupJackpot.UserValue<>2 And L_PaintCanJackpot.UserValue<>2 And L_SpinnerJackpot.UserValue<>2 Then BBlink JackpotInserts ' This makes the jackpots renew indefinitely and also lights ALL jackpots if you collect the super during a MB with only four jackpots I will probably regret this.
End Sub

Sub AwardSpectrumTimer_Timer
	NextSpectrumMultiball=SpectrumMode
	SpectrumMode=0
	If BallsOnPlayfield>1 Then
		Select Case NextSpectrumMultiball
			Case 1
				If CyanComplete=1 And MagentaComplete=1 And YellowComplete=1 And BossGoalComplete=0 Then
					SurpriseBossBattle
				Else
					GIColor Cyan
					PlayfieldColor = Cyan
					CrazyInkLights.enabled=1
					StartMultiBall 4
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
					ScrollFromTopLeft    "        CYAN        "
					ScrollFromBottomRight "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					PlayMusic "music_4mb"
					Blink L_OrbitJackpot
					Blink L_LeftBullseyeJackpot
					Blink L_StandupJackpot
					Blink L_PaintCanJackpot
					If SuperJackpotComplete=0 Then Blink L_GoalCollectSuperJackpot
				End If
			Case 2
				If BlueComplete=1 And RedComplete=1 And GreenComplete=1 And BossGoalComplete=0 Then
					SurpriseBossBattle
				Else
					GIColor Blue
					PlayfieldColor = Blue
					CrazyInkLights.enabled=1
					StartMultiBall 4
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
					ScrollFromTopRight    "        BLUE        "
					ScrollFromBottomLeft "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					PlayMusic "music_4mb"
					Blink L_OrbitJackpot
					Blink L_LeftBullseyeJackpot
					Blink L_MagentaRampJackpot
					Blink L_RightBullseyeJackpot
					If SuperJackpotComplete=0 Then Blink L_GoalCollectSuperJackpot
				End If
			Case 3
				If CyanComplete=1 And MagentaComplete=1 And YellowComplete=1 And BossGoalComplete=0 Then
					SurpriseBossBattle
				Else
					GIColor Magenta
					PlayfieldColor = Magenta
					CrazyInkLights.enabled=1
					StartMultiBall 4
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
					ScrollFromTopLeft    "       MAGENTA      "
					ScrollFromBottomRight "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					PlayMusic "music_4mb"
					Blink L_MagentaRampJackpot
					Blink L_RightBullseyeJackpot
					Blink L_StandupJackpot
					Blink L_PaintCanJackpot
					If SuperJackpotComplete=0 Then Blink L_GoalCollectSuperJackpot
				End If
			Case 4
				If BlueComplete=1 And RedComplete=1 And GreenComplete=1 And BossGoalComplete=0 Then
					SurpriseBossBattle
				Else
					GIColor Red
					PlayfieldColor = Red
					CrazyInkLights.enabled=1
					StartMultiBall 4
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
					ScrollFromTopRight    "         RED        "
					ScrollFromBottomLeft "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					PlayMusic "music_4mb"
					Blink L_MagentaRampJackpot
					Blink L_RightBullseyeJackpot
					Blink L_YellowRampJackpot
					Blink L_SpinnerJackpot
					If SuperJackpotComplete=0 Then Blink L_GoalCollectSuperJackpot
				End If
			Case 5
				If CyanComplete=1 And MagentaComplete=1 And YellowComplete=1 And BossGoalComplete=0 Then
					SurpriseBossBattle
				Else
					GIColor Yellow
					PlayfieldColor = Yellow
					CrazyInkLights.enabled=1
					StartMultiBall 4
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
					ScrollFromTopLeft    "       YELLOW       "
					ScrollFromBottomRight "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					PlayMusic "music_4mb"
					Blink L_YellowRampJackpot
					Blink L_SpinnerJackpot
					Blink L_StandupJackpot
					Blink L_PaintCanJackpot
					If SuperJackpotComplete=0 Then Blink L_GoalCollectSuperJackpot
				End If
			Case 6
				If BlueComplete=1 And RedComplete=1 And GreenComplete=1 And BossGoalComplete=0 Then
					SurpriseBossBattle
				Else
					GIColor Green
					PlayfieldColor = Green
					CrazyInkLights.enabled=1
					StartMultiBall 4
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
					ScrollFromTopRight    "        GREEN       "
					ScrollFromBottomLeft "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					PlayMusic "music_4mb"
					Blink L_YellowRampJackpot
					Blink L_SpinnerJackpot
					Blink L_OrbitJackpot
					Blink L_LeftBullseyeJackpot
					If SuperJackpotComplete=0 Then Blink L_GoalCollectSuperJackpot
				End If
		End Select
	Else
		Dim Iamanidiot : Iamanidiot=0'Check if the last color completed the CMY or RBG triangle and unlock a boss fight if the boss hasn't been defeated yet
		If (NextSpectrumMultiball Mod 2)<>0 And CyanComplete=1 And MagentaComplete=1 And YellowComplete=1 And BossGoalComplete=0 Then Iamanidiot=1
		If (NextSpectrumMultiball Mod 2)=0 And BlueComplete=1 And RedComplete=1 And GreenComplete=1 And BossGoalComplete=0 Then Iamanidiot=2
		If Iamanidiot>0 Then 
			ScrollFromTopCenter "BOSS FIGHT UNLOCKED "
			PlaySound "sega_alert", 0 , DigitalSoundsLevel
			Blink L_GoalDefeatSlater
			Blink L_SpinnerLockBall
			KKill ModeInserts
			RBarrelUp
		Else
			ScrollFromTopCenter "   MULTIBALL READY  "
			PlaySound "sega_alert", 0 , DigitalSoundsLevel
		End If
		If ParkMessageBottom = ""  And CountingBonus=0 Then
		DisplayBallInPlay
		End If
		Blink L_ScoopTriangle
	End If
	AwardSpectrumTimer.enabled=0
End Sub

'==========================
'§ Behavior of Left Scoop §
'==========================

Dim StagedBalls : StagedBalls=0

Sub LeftScoop_Hit
	Scoring: AddScore Scoop_Score
	LeftScoop.DestroyBall
	PlaySoundAt "kicker_enter_center", LeftScoop
	Select Case L_ScoopTriangle.UserValue
		Case 0
			LeftEject
			If TableTilted=0 Then PlaySound "sega_slingshot", 0 , DigitalSoundsLevel
		Case 1
			LeftEject
			If TableTilted=0 Then PlaySound "sega_slingshot", 0 , DigitalSoundsLevel
		Case 2
			If L_GoalDefeatSlater.UserValue=2 Then
				If FirstBossBattle=0 Then
					InitiateBossBattle
				Else
					LeftEject
					SurpriseBossBattle
				End If
			Else
				If TableTilted=0 Then PlaySound "sega_slingshot", 0 , DigitalSoundsLevel
				ParkMessageTop=""
				ParkMessageBottom=""
				Kill L_ScoopTriangle
				StartSpectrumMultiball.Enabled=1
			End If
	End Select
End Sub

Sub StartSpectrumMultiball_Timer
			Select Case NextSpectrumMultiball
				Case 1
					GIColor Cyan
					PlayfieldColor = Cyan
					LeftEject
					If L_SpinnerLockBall.UserValue = 2 Then
						RBarrelDown
						Kill L_SpinnerLockBall
						StartMultiBall 4
						PlayMusic "music_4mb"
					Else
						StartMultiBall 2
						PlayMusic "music_2mb"
					End If
					JackpotsAwarded=0
					ScrollFromTopRight    "        CYAN        "
					ScrollFromBottomLeft "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
				Case 2
					GIColor Blue
					PlayfieldColor = Blue
					LeftEject
					If L_SpinnerLockBall.UserValue = 2 Then
						RBarrelDown
						Kill L_SpinnerLockBall
						StartMultiBall 4
						PlayMusic "music_4mb"
					Else
						StartMultiBall 3
						PlayMusic "music_3mb"
					End If
					JackpotsAwarded=0
					ScrollFromTopLeft    "        BLUE        "
					ScrollFromBottomRight "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
				Case 3
					GIColor Magenta
					PlayfieldColor = Magenta
					LeftEject
					If L_SpinnerLockBall.UserValue = 2 Then
						RBarrelDown
						Kill L_SpinnerLockBall
						StartMultiBall 4
						PlayMusic "music_4mb"
					Else
						StartMultiBall 2
						PlayMusic "music_2mb"
					End If
					JackpotsAwarded=0
					ScrollFromTopRight    "       MAGENTA      "
					ScrollFromBottomLeft "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
				Case 4
					GIColor Red
					PlayfieldColor = Red
					LeftEject
					If L_SpinnerLockBall.UserValue = 2 Then
						RBarrelDown
						Kill L_SpinnerLockBall
						StartMultiBall 4
						PlayMusic "music_4mb"
					Else
						StartMultiBall 3
						PlayMusic "music_3mb"
					End If
					JackpotsAwarded=0
					ScrollFromTopLeft    "         RED        "
					ScrollFromBottomRight "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
				Case 5
					GIColor Yellow
					PlayfieldColor = Yellow
					LeftEject
					If L_SpinnerLockBall.UserValue = 2 Then
						RBarrelDown
						Kill L_SpinnerLockBall
						StartMultiBall 4
						PlayMusic "music_4mb"
					Else
						StartMultiBall 2
						PlayMusic "music_2mb"
					End If
					JackpotsAwarded=0
					ScrollFromTopRight    "       YELLOW       "
					ScrollFromBottomLeft "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
				Case 6
					GIColor Green
					PlayfieldColor = Green
					LeftEject
					If L_SpinnerLockBall.UserValue = 2 Then
						RBarrelDown
						Kill L_SpinnerLockBall
						StartMultiBall 4
						PlayMusic "music_4mb"
					Else
						StartMultiBall 3
						PlayMusic "music_3mb"
					End If
					JackpotsAwarded=0
					ScrollFromTopLeft    "        GREEN       "
					ScrollFromBottomRight "      MULTIBALL     "
					PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
					If RescueMode=0 Then KKill DropTargetLights
					If SpectrumMode=0 then KKill ModeInserts
			End Select
		StartSpectrumMultiball.enabled=0
End Sub

Sub LeftEject
	StagedBalls=StagedBalls+1
End Sub

Sub Blinkmaybe (Iamstupid) 

'I HAVE NO IDEA WHAT ANY OF THIS DOES. I WROTE IT AT 3 IN THE MORNING (AONISHIKI YUSHO!!!!) 
'AND THEN FELL ASLEEP. THE TABLE WAS WORKING WHEN I WOKE UP SO I LEFT IT IN.

	If Iamstupid.UserValue<>1 Then Blink Iamstupid
End Sub

Sub AutoKicker_Timer
	If StagedBalls>0 Then
		LeftScoop.CreateBall
		LeftScoop.Kick 128, 22
		PlaySoundAt "fx_kicker",LeftScoop
		If TableTilted=0 Then PlaySound "sega_kicker", 0 , DigitalSoundsLevel
		StagedBalls=StagedBalls-1
	End If
	If PlayfieldColor<>Neutral And PlayfieldColor<>Crazy Then
		CrazyInkLights.enabled=1
		KKill ModeInserts
		Select Case PlayfieldColor
			Case Cyan
				Blinkmaybe L_OrbitJackpot
				Blinkmaybe L_LeftBullseyeJackpot
				Blinkmaybe L_StandupJackpot
				Blinkmaybe L_PaintCanJackpot
				If SuperJackpotComplete=0 Then Blinkmaybe L_GoalCollectSuperJackpot
			Case Blue
				Blinkmaybe L_OrbitJackpot
				Blinkmaybe L_LeftBullseyeJackpot
				Blinkmaybe L_MagentaRampJackpot
				Blinkmaybe L_RightBullseyeJackpot
				If SuperJackpotComplete=0 Then Blinkmaybe L_GoalCollectSuperJackpot
			Case Magenta
				Blinkmaybe L_MagentaRampJackpot
				Blinkmaybe L_RightBullseyeJackpot
				Blinkmaybe L_StandupJackpot
				Blinkmaybe L_PaintCanJackpot
				If SuperJackpotComplete=0 Then Blinkmaybe L_GoalCollectSuperJackpot
			Case Red
				Blinkmaybe L_MagentaRampJackpot
				Blinkmaybe L_RightBullseyeJackpot
				Blinkmaybe L_YellowRampJackpot
				Blinkmaybe L_SpinnerJackpot
				If SuperJackpotComplete=0 Then Blinkmaybe L_GoalCollectSuperJackpot
			Case Yellow
				Blinkmaybe L_YellowRampJackpot
				Blinkmaybe L_SpinnerJackpot
				Blinkmaybe L_StandupJackpot
				Blinkmaybe L_PaintCanJackpot
				If SuperJackpotComplete=0 Then Blinkmaybe L_GoalCollectSuperJackpot
			Case Green
				Blinkmaybe L_YellowRampJackpot
				Blinkmaybe L_SpinnerJackpot
				Blinkmaybe L_OrbitJackpot
				Blinkmaybe L_LeftBullseyeJackpot
				If SuperJackpotComplete=0 Then Blinkmaybe L_GoalCollectSuperJackpot
			Case Else
				DoAbsolutelyNothing
		End Select
	End If
End Sub

	'SEE NOTE TWO SUBS ABOVE!!!!!!!!!!!


'=================================
'§ Behavior of Right Gobble Hole §
'=================================

Sub RightHole_Hit
	Scoring: Addscore Scoop_Score
	RightHole.DestroyBall
	PlaySoundAt "kicker_enter_center", RightHole
	Select Case L_SpinnerLockBall.UserValue
		Case 0
			LeftEject
			If TableTilted=0 Then PlaySound "sega_slingshot", 0 , DigitalSoundsLevel
		Case 1
			DoAbsolutelyNothing
		Case 2
			Select Case L_ScoopTriangle.UserValue
				Case 0 
					LockedBalls=LockedBalls+1
					Select Case LockedBalls
						Case 1
							SimpleBlinkTop  "    BALL 1 LOCKED   "
							RBarrelDown
							Afterlock.enabled=1
							PlaySound "sega_bonuscount", 0 , DigitalSoundsLevel	
						Case 2
							SimpleBlinkTop  "    BALL 2 LOCKED   "
							RBarrelDown
							Afterlock.enabled=1
							PlaySound "sega_bonuscount", 0 , DigitalSoundsLevel	
						Case 3
							Kill L_ScoopTriangle
							ScrollFromTopLeft     "       RESCUE       "
							ScrollFromBottomRight "      MULTIBALL     "					
							PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
							PlayMusic "music_4mb"
							RBarrelDown
							JackpotsAwarded=0
							StartMultiBall 4
							If RescueMode=0 Then KKill DropTargetLights
							If SpectrumMode=0 then KKill ModeInserts
							LockedBalls=0
							Kill L_SpinnerLockBall
							BBlink JackpotInserts
							LeftEject
					End Select
				Case 1
					DoAbsolutelyNothing
				Case 2
					Kill L_SpinnerLockBall
					LockedBalls=0
					RBarrelDown
					Kill L_ScoopTriangle
					Select Case L_GoalDefeatSlater.UserValue
						Case 2
							LockedBalls=0
							If FirstBossBattle=0 Then
								InitiateBossBattle
							Else
								SurpriseBossBattle
								LeftEject
							End If
						Case Else
							Select Case NextSpectrumMultiball
								Case 1
									GIColor Cyan
									PlayfieldColor = Cyan
									JackpotsAwarded=0
									CrazyInkLights.enabled=1
									StartMultiBall 4
									If RescueMode=0 Then KKill DropTargetLights
									If SpectrumMode=0 then KKill ModeInserts
									ScrollFromTopLeft    "        CYAN        "
									ScrollFromBottomRight "      MULTIBALL     "
									PlayMusic "music_4mb"
									PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
									LeftEject
								Case 2
									GIColor Blue
									PlayfieldColor = Blue
									JackpotsAwarded=0
									CrazyInkLights.enabled=1
									StartMultiBall 4
									If RescueMode=0 Then KKill DropTargetLights
									If SpectrumMode=0 then KKill ModeInserts
									ScrollFromTopRight    "        BLUE        "
									ScrollFromBottomLeft "      MULTIBALL     "
									PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
									PlayMusic "music_4mb"
									LeftEject
								Case 3
									GIColor Magenta
									PlayfieldColor = Magenta
									JackpotsAwarded=0
									CrazyInkLights.enabled=1
									StartMultiBall 4
									If RescueMode=0 Then KKill DropTargetLights
									If SpectrumMode=0 then KKill ModeInserts
									ScrollFromTopLeft    "       MAGENTA      "
									ScrollFromBottomRight "      MULTIBALL     "
									PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
									Playmusic "music_4mb"
									LeftEject
								Case 4
									GIColor Red
									PlayfieldColor = Red
									JackpotsAwarded=0
									CrazyInkLights.enabled=1
									StartMultiBall 4
									If RescueMode=0 Then KKill DropTargetLights
									If SpectrumMode=0 then KKill ModeInserts
									ScrollFromTopRight    "         RED        "
									ScrollFromBottomLeft "      MULTIBALL     "
									PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
									Playmusic "music_4mb"
									LeftEject
								Case 5
									GIColor Yellow
									PlayfieldColor = Yellow
									JackpotsAwarded=0
									CrazyInkLights.enabled=1
									StartMultiBall 4
									If RescueMode=0 Then KKill DropTargetLights
									If SpectrumMode=0 then KKill ModeInserts
									ScrollFromTopLeft    "       YELLOW       "
									ScrollFromBottomRight "      MULTIBALL     "
									PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
									PlayMusic "music_4mb"
									LeftEject
								Case 6
									GIColor Green
									PlayfieldColor = Green
									JackpotsAwarded=0
									CrazyInkLights.enabled=1
									StartMultiBall 4
									If RescueMode=0 Then KKill DropTargetLights
									If SpectrumMode=0 then KKill ModeInserts
									ScrollFromTopRight    "        GREEN       "
									ScrollFromBottomLeft "      MULTIBALL     "
									PlaySound "sega_wizardmode", 0 , DigitalSoundsLevel
									PlayMusic "music_4mb"
									LeftEject
							End Select
					End Select
			End Select
	End Select
End Sub

Sub AfterLock_Timer
	LaunchBall
	Afterlock.enabled=0
End Sub

'================================
'§ Behavior of Lower Right Gate §
'================================

Sub RGateLower_Hit
	SFXGateHit
	If TableTilted=0 And BossBattle=0 Then Scoring: AddScore GateYellow_Score
End Sub

'================================
'§ Behavior of Upper Right Gate §
'================================

Sub RGateUpper_Hit
	SFXGateHit
	If TableTilted=1 Then Exit Sub
	PlaySound "sega_hitorbit", 0 , DigitalSoundsLevel
	If L_SpinnerLockBall.UserValue=2 Then RBarrelUp
	If BossBattle=0 Then Scoring : AddScore GateYellow_Score
End Sub

'============================================
'§ Behavior of Corner Standups and Spraycan §
'============================================

Sub Target001_Hit
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	Scoring
	If WizardMode=0 And BossBattle=0 Then Addscore TargetCyan_Score
	SpeedUpSprayCan
End Sub

Sub Target002_Hit
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	Scoring
	If WizardMode=0 And BossBattle=0 Then Addscore TargetCyan_Score
	SpeedUpSprayCan
End Sub

Sub Target003_Hit
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	Scoring
	If WizardMode=0 And BossBattle=0 Then Addscore TargetCyan_Score
	SpeedUpSprayCan
End Sub


Sub SpeedUpSprayCan
	SprayCanIncrement = SprayCanIncrement + 0.5 : If SprayCanIncrement>6.5 Then : SprayCanIncrement =6.5 : End If 
End Sub

Dim SprayCanDirection, SprayCanIncrement, SpraycanShakes : SprayCanDirection = 1

Sub SprayCanTimer_Timer ' This used to be in the same sub as the spray can but it was easier to debug this way
	Primitive028.TransY = Primitive028.TransY + (SprayCanIncrement * SprayCanDirection)
		If Primitive028.TransY >= 15 Then 
			If TableTilted=0 Then PlaySound "sega_shakespraycandown", 0 , DigitalSoundsLevel
			SprayCanDirection = -1
			SprayCanShakes = SprayCanShakes + 1
			If WizardMode=0 And TableTilted=0 Then Scoring : AddScore SprayCan_Score
			If WizardMode=0 And TableTilted=0 Then Jackpot_Score = Jackpot_Score + SprayCanJackpot_Score
			If ParkMessageBottom = "" And ParkMessageTop = "" And YouHaveFailed.enabled=0 And AwardSpectrumTimer.enabled=0 And LocksLitTimer.enabled=0 And CrazyInkLights.enabled=0 And PlayfieldColor=Neutral And BallsOnPlayfield=1 And WizardMode=0 Then
				If TableTilted=0 And DisplayingDanger.enabled=0 Then DisplayTop "    JACKPOT VALUE   "
				If TableTilted=0 And DisplayingDanger.enabled=0 Then DisplayANumber Jackpot_Score
			End If
		ElseIf Primitive028.TransY <= -15 Then 
			If TableTilted=0 Then PlaySound "sega_shakespraycanup", 0 , DigitalSoundsLevel
			SprayCanDirection = 1
		End If
	SprayCanIncrement = SprayCanIncrement -.02
	If SprayCanIncrement < 0 Then SprayCanIncrement = 0
End Sub

'===========================
'§ Behavior of Pop Bumpers §
'===========================

Sub CyanBumperL_Hit
	SFXBumperHit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then Exit Sub
	If BossBattle=1 Then Exit Sub
	SpeedUpSprayCan
	Scoring : AddScore CyanBumper_Score
End Sub

Sub CyanBumperR_Hit
	If TableTilted=0 Then PlaySound "sega_saucer", 0 , DigitalSoundsLevel
	SFXBumperHit
	If BossBattle=1 Then Exit Sub
	If WizardMode=1 Then Exit Sub
	If TableTilted=0 Then Scoring : AddScore CyanBumper_Score
End Sub

Sub MagentaBumperL_Hit
	If TableTilted=0 Then PlaySound "sega_saucer", 0 , DigitalSoundsLevel
	SFXBumperHit
	If WizardMode=1 Then Exit Sub
	If BossBattle=1 Then Exit Sub
	If TableTilted=0 Then Scoring : AddScore MagentaBumper_Score
End Sub

Sub MagentaBumperR_Hit
	If TableTilted=0 Then PlaySound "sega_saucer", 0 , DigitalSoundsLevel
	SFXBumperHit
	If WizardMode=1 Then Exit Sub
	If BossBattle=1 Then Exit Sub
	If TableTilted=0 Then Scoring : AddScore MagentaBumper_Score
End Sub

Sub YellowBumper_Hit
	If TableTilted=0 Then PlaySound "sega_saucer", 0 , DigitalSoundsLevel
	SFXBumperHit
	If WizardMode=1 Then Exit Sub
	If BossBattle=1 Then Exit Sub
	If TableTilted=0 Then Scoring : AddScore YellowBumper_Score
End Sub

'==========================================
'§ Behavior of Upper (Small) Drop Targets §
'==========================================

Sub DropCyan_Hit
	SFXDropHit
	If TableTilted=1 Then Exit Sub
	If BossBattle=1 Then Exit Sub
	PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel
	Scoring : Addscore Drop_Score
	Ignite L_DropTargetNarrow1
	If RescueMode <> 0 Then EvaluateDrops
End Sub

Sub DropMagenta_Hit
	SFXDropHit
	If TableTilted=1 Then Exit Sub
	If BossBattle=1 Then Exit Sub
	PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel
	Scoring : Addscore Drop_Score
	Ignite L_DropTargetNarrow2
	If RescueMode <> 0 Then EvaluateDrops
End Sub

Sub DropYellow_Hit
	SFXDropHit
	If TableTilted=1 Then Exit Sub
	If BossBattle=1 Then Exit Sub
	PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel
	Scoring : Addscore Drop_Score
	Ignite L_DropTargetNarrow3
	If RescueMode <> 0 Then EvaluateDrops
End Sub

Sub DropBlack_Hit
	SFXDropHit
	If BossBattle=1 Then Exit Sub
	If TableTilted=1 Then Exit Sub
	PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel
	Scoring : Addscore Drop_Score
	Ignite L_DropTargetNarrow4
	If RescueMode <> 0 Then EvaluateDrops
End Sub

Dim RescueProgress
Dim RescueGoal

Sub IHateDropTargets_Timer ' I have tried your suggestions. None of them worked. I wish you good luck, or at least better luck than me, if you want to attempt to fix this.
	Dim LocalDrop
	If RescueMode <> 0 Then	
		If DropCyan.Isdropped=1 And DropMagenta.Isdropped=1 And DropYellow.Isdropped=1 And DropBlack.Isdropped=1 And RescueProgress < RescueGoal Then
			For Each LocalDrop In FourDropTargets
				LocalDrop.IsDropped=0
			Next
				BBlink DropTargetLights
				PlaySoundAt "fx_resetdrop", centerdropsound
				Scoring : Addscore Drop_Score*4
		End If
	End If
End Sub

Sub EvaluateDrops
	RescueProgress = RescueProgress + 1
	If RescueProgress = RescueGoal Then AwardRescue
End Sub

'==========================================
'§ Behavior of Lower (Large) Drop Targets §
'==========================================

Sub DropWhiteL_Hit
	SFXDropHit
	If TableTilted=0 Then PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel
	If TableTilted=0 And BossBattle=0 Then Scoring : Addscore Drop_Score
	RGI_NotDropped1.intensity=0
	RGI_NotDropped2.intensity=0
	RGI_Dropped1.intensity=5
	RGI_Dropped2.intensity=5
	DropWhiteR.Isdropped=0
	LGI_Dropped1.intensity=0
	LGI_Dropped2.intensity=0
	LGI_NotDropped1.intensity=10
	LGI_NotDropped2.intensity=10
	PlaySoundAt "fx_resetdrop", rightdropsound
End Sub

Sub DropWhiteR_Hit
	SFXDropHit
	If TableTilted=0 Then PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel
	If TableTilted=0 And BossBattle=0 Then Scoring : Addscore Drop_Score
	LGI_NotDropped1.intensity=0
	LGI_NotDropped2.intensity=0
	LGI_Dropped1.intensity=5
	LGI_Dropped2.intensity=5
	DropWhiteL.IsDropped = 0
	RGI_Dropped1.intensity=0
	RGI_Dropped2.intensity=0
	RGI_NotDropped1.intensity=10
	RGI_NotDropped2.intensity=10
	PlaySoundAt "fx_resetdrop", leftdropsound
End Sub

'==========================
'§ Behavior of Left Orbit §
'==========================

Sub GateLeft_Hit
	SFXGateHit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score*5
		RandomJackpotMessage
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel
		Exit Sub
	End If
	If L_OrbitTriangle.UserValue = 2 Then
		If L_OrbitJackpot.UserValue<>2 Then PlaySound "sega_hitlitshot", 0 , DigitalSoundsLevel
	Else
		If L_OrbitJackpot.UserValue<>2 Then PlaySound "sega_hitorbit", 0 , DigitalSoundsLevel	
	End If
	If BossBattle=0 Then Scoring : Addscore GateCyan_Score
	If L_OrbitJackpot.UserValue=2 Then
		AwardJackpot L_OrbitJackpot
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel
	End If
	If SpectrumMode=0 And PlayfieldColor = Neutral And CyanInkLevel<4 Then CyanInkLevel=CyanInkLevel+1
	If BossBattle=0 And SpectrumMode<>0 Then AdvanceSpectrum L_OrbitTriangle
	UpdateInkLevels
End Sub

'=========================
'§ Behavior of Left Ramp §
'=========================

Sub LeftRampTrigger_Hit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score*5
		RandomJackpotMessage
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore MagentaRamp_Score
	If L_MagentaRampJackpot.UserValue=2 Then
		AwardJackpot L_MagentaRampJackpot
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
	Else
		Select Case L_MagentaRampTriangle.UserValue
			Case 2
				PlaySound "sega_hitlitshot", 0 , DigitalSoundsLevel
			Case Else
				PlaySound "sega_hitramp", 0 , DigitalSoundsLevel
		End Select
	End If
	If SpectrumMode=0 And PlayfieldColor = Neutral And MagentaInkLevel<4 Then MagentaInkLevel=MagentaInkLevel+1
	If BossBattle=0 And SpectrumMode<>0 Then AdvanceSpectrum L_MagentaRampTriangle
	UpdateInkLevels
End Sub

'============================
'§ Behavior of Captive Ball §
'============================

Dim RescueLevel

Sub CaptiveBallTarget_Hit
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score
		RandomJackpotMessage
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore Captiveball_Score
	If BossBattle=1 Then 'this is a cheap way to make the boss battle easier. It's probably not necessary? Some of these battles are really close, though.
			EnemyHealth=EnemyHealth-1
			PlaySound "sega_kicker", 0 , DigitalSoundsLevel
			PlaySound "sega_droptargetandbossdamage", 0 , DigitalSoundsLevel	
			UpdateHealth
	End If
	Select Case CymonRescued + MaggieRescued + YoloRescued + KeenenRescued
		Case 4
			PlaySound "sega_hitlitshot", 0 , DigitalSoundsLevel	
		Case Else
			If BossBattle=0 And RescueMode=0 And RescueLevel<4 Then
				RescueLevel = RescueLevel + 1
				UpdateRescueLights
			End If
	End Select
End Sub

'=============================
'§ Behavior of Left Bullseye §
'=============================

Sub LeftBullseye_Hit
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score*5
		RandomJackpotMessage
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore TargetCyan_Score
	If L_LeftBullseyeJackpot.UserValue=2 Then
		AwardJackpot L_LeftBullseyeJackpot
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
	Else
		Select Case L_LeftBullseyeTriangle.UserValue
			Case 2
				PlaySound "sega_hitlitshot", 0 , DigitalSoundsLevel	
			Case Else
				PlaySound "sega_targethit", 0 , DigitalSoundsLevel	
		End Select
	End If
	If SpectrumMode=0 And PlayfieldColor = Neutral And CyanInkLevel<4 Then CyanInkLevel=CyanInkLevel+1
	If BossBattle=0 And SpectrumMode<>0 Then AdvanceSpectrum L_LeftBullseyeTriangle
	UpdateInkLevels
End Sub

'==============================
'§ Behavior of Right Bullseye §
'==============================

Sub RightBullseye_Hit
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score*5
		RandomJackpotMessage
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore TargetMagenta_Score
	If L_RightBullseyeJackpot.UserValue=2 Then
		AwardJackpot L_RightBullseyeJackpot
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
	Else
		Select Case L_RightBullseyeTriangle.UserValue
			Case 2
				PlaySound "sega_hitlitshot", 0 , DigitalSoundsLevel	
			Case Else
				PlaySound "sega_targethit", 0 , DigitalSoundsLevel	
		End Select
	End If
	If SpectrumMode=0 And PlayfieldColor = Neutral And MagentaInkLevel<4 Then MagentaInkLevel=MagentaInkLevel+1
	If BossBattle=0 And SpectrumMode<>0 Then AdvanceSpectrum L_RightBullseyeTriangle
	UpdateInkLevels
End Sub

'==========================
'§ Behavior of Right Ramp §
'==========================

Sub RightRampTrigger_Hit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score*5
		RandomJackpotMessage
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore YellowRamp_Score
	If L_YellowRampJackpot.UserValue=2 Then
		AwardJackpot L_YellowRampJackpot
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
	Else
		Select Case L_YellowRampTriangle.UserValue
			Case 2
				PlaySound "sega_hitlitshot", 0 , DigitalSoundsLevel
			Case Else
				PlaySound "sega_hitramp", 0 , DigitalSoundsLevel
		End Select
	End If
	If SpectrumMode=0 And PlayfieldColor = Neutral And YellowInkLevel<4 Then YellowInkLevel=YellowInkLevel+1
	If BossBattle=0 And SpectrumMode<>0 Then AdvanceSpectrum L_YellowRampTriangle
	UpdateInkLevels
End Sub


'=================================
'§ Behavior of Lower Bullseye(s) §
'=================================

Sub BlackBullseye_Hit 'The two visible stand-up are cosmetic. In reality it's just one huge target.
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score
		RandomJackpotMessage
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore TargetBlack_Score
	If L_StandupJackpot.UserValue=2 Then
		AwardJackpot L_StandupJackpot
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel	
	Else
		Select Case L_StandupTriangle.UserValue
			Case 2
				PlaySound "sega_hitlitshot", 0 , DigitalSoundsLevel	
			Case Else
				PlaySound "sega_targethit", 0 , DigitalSoundsLevel	
		End Select
	End If
	If SpectrumMode=0 And PlayfieldColor = Neutral And KeyInkLevel<4 Then KeyInkLevel=KeyInkLevel+1
	If BossBattle=0 And SpectrumMode<>0 Then AdvanceSpectrum L_StandupTriangle
	UpdateInkLevels
End Sub

'=========================
'§ Behavior of Paint Can §
'=========================

Sub PaintTrigger000_Hit
	If TableTilted=1 Then Exit Sub
	If PaintCanIncrement+1.6>12 Then 
		PaintCanIncrement=12
	Else
		PaintCanIncrement=PaintCanIncrement+1.8
	End If
End Sub

Sub PaintTrigger001_Hit
	If TableTilted=1 Then Exit Sub
	If PaintCanIncrement+1.7>12 Then 
		PaintCanIncrement=12
	Else
		PaintCanIncrement=PaintCanIncrement+1.7
	End If
End Sub

Sub PaintTrigger002_Hit
	If TableTilted=1 Then Exit Sub
	If PaintCanIncrement+1.8>12 Then 
		PaintCanIncrement=12
	Else
		PaintCanIncrement=PaintCanIncrement+1.8
	End If
End Sub

Sub PaintTrigger003_Hit
	If TableTilted=1 Then Exit Sub
	If PaintCanIncrement+1.9>12 Then 
		PaintCanIncrement=12
	Else
		PaintCanIncrement=PaintCanIncrement+1.9
	End If
End Sub

Sub PaintTrigger004_Hit
	If TableTilted=1 Then Exit Sub
	PlaySound "sega_spincan", 0 , DigitalSoundsLevel
	If PaintCanIncrement+2.0>12 Then 
		PaintCanIncrement=12
	Else
		PaintCanIncrement=PaintCanIncrement+2.0
	End If
End Sub

Sub PaintTrigger005_Hit
	If TableTilted=1 Then Exit Sub
	If PaintCanIncrement+2.1>12 Then 
		PaintCanIncrement=12
	Else
		PaintCanIncrement=PaintCanIncrement+2.1
	End If
End Sub

Sub PaintTrigger006_Hit
	If TableTilted=1 Then Exit Sub
	If PaintCanIncrement+2.2>12 Then 
		PaintCanIncrement=12
	Else
		PaintCanIncrement=PaintCanIncrement+2.2
	End If
	If WizardMode=1 Then Exit Sub
	Scoring : Addscore TargetBlack_Score
	If SpectrumMode=0 And PlayfieldColor = Neutral And KeyInkLevel<4 Then KeyInkLevel=KeyInkLevel+1
	If BossBattle=0 And SpectrumMode<>0 Then AdvanceSpectrum L_StandupTriangle
	If L_PaintCanJackpot.UserValue=2 Then AwardJackpot L_PaintCanJackpot
	UpdateInkLevels
End Sub

Dim PaintCanSpins
Dim PaintCanIncrement

Sub PaintCanTimer_Timer
If Primitive027.Roty-PaintCanIncrement<0 Then
	PaintCanSpins = PaintCanSpins + 1
	If TableTilted=0 Then Scoring : Addscore PaintCan_Score
	If WizardMode=0 Then
		If TableTilted=0 Then Jackpot_Score = Jackpot_Score + PainCanJackpot_Score
	Else
		Scoring : AddScore Jackpot_Score
		RandomJackpotMessage
	End If
    If BossBattle=0 And DisplayingDanger.enabled=0 And TableTilted=0 And ParkMessageBottom = "" And ParkMessageTop = ""  And YouHaveFailed.enabled=0 And AwardSpectrumTimer.enabled=0 And LocksLitTimer.enabled=0 And CrazyInkLights.enabled=0 And PlayfieldColor=Neutral And BallsOnPlayfield=1 And WizardMode=0 Then
		DisplayTop "    JACKPOT VALUE   "
		DisplayANumber Jackpot_Score
	End If
	Primitive027.Roty=360-PaintCanIncrement
	Else
	Primitive027.Roty=Primitive027.Roty-PaintCanIncrement
	End If

PaintCanIncrement = PaintCanIncrement-0.020

If PaintCanIncrement<0 Then PaintCanIncrement=0
End Sub


'=======================
'§ Behavior of Spinner §
'=======================

Sub Spinner_Spin
	PlaySound "fx_spinner", 0, .25, AudioPan(Spinner), 0.25, 0, 0, 1, AudioFade(Spinner)
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score
		RandomJackpotMessage
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore YellowSpinner_Score
	PlaySound "sega_spinner2", 0 , DigitalSoundsLevel
End Sub

Sub InvisibleYellowButton_Hit ' I should probably get rid of this button and just tie the yellow ink hit to the gate behind the spinner like a real machine would do but honestly whatever.
	If TableTilted=1 Then Exit Sub
	If WizardMode = 1 then Exit Sub
	If L_SpinnerJackpot.UserValue=2 Then
		AwardJackpot L_SpinnerJackpot
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel
	Else
		Select Case L_SpinnerTriangle.UserValue
			Case 2
				PlaySound "sega_hitlitshot", 0 , DigitalSoundsLevel
			Case Else
				PlaySound "sega_hitorbit", 0 , DigitalSoundsLevel
		End Select
	End If
	If SpectrumMode=0  And PlayfieldColor = Neutral And YellowInkLevel<4 Then YellowInkLevel=YellowInkLevel+1
	If BossBattle=0 And SpectrumMode<>0 Then AdvanceSpectrum L_SpinnerTriangle
	UpdateInkLevels
End Sub

'===================================
'§ Behavior of Central 4 Stand-Ups §
'===================================

Sub CyanStandUp_Hit
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	PlaySound "sega_targethit", 0 , DigitalSoundsLevel	
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score
		RandomJackpotMessage
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore TargetCyan_Score
	If SpectrumMode=0 And PlayfieldColor = Neutral And CyanInkLevel<4 Then CyanInkLevel=CyanInkLevel+1
	UpdateInkLevels
End Sub

Sub MagentaStandUp_Hit
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	PlaySound "sega_targethit", 0 , DigitalSoundsLevel	
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score
		RandomJackpotMessage
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore TargetMagenta_Score
	If SpectrumMode=0 And PlayfieldColor = Neutral And MagentaInkLevel<4 Then MagentaInkLevel=MagentaInkLevel+1
	UpdateInkLevels
End Sub

Sub YellowStandUp_Hit
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	PlaySound "sega_targethit", 0 , DigitalSoundsLevel	
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score
		RandomJackpotMessage
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore YellowBumper_Score
	If SpectrumMode=0 And PlayfieldColor = Neutral And YellowInkLevel<4 Then YellowInkLevel=YellowInkLevel+1
	UpdateInkLevels
End Sub

Sub KeyStandUp_Hit
	SFXTargetHit
	If TableTilted=1 Then Exit Sub
	PlaySound "sega_targethit", 0 , DigitalSoundsLevel	
	If WizardMode=1 Then
		Scoring : AddScore Jackpot_Score
		RandomJackpotMessage
		Exit Sub
	End If
	If BossBattle=0 Then Scoring : Addscore TargetBlack_Score
	If SpectrumMode=0 And PlayfieldColor = Neutral And KeyInkLevel<4 Then KeyInkLevel=KeyInkLevel+1
	UpdateInkLevels
End Sub


'================================
'§ Behavior of Lower Rollovers §
'================================

Sub BottomRollover1_Hit
	If TableTilted=1 Then Exit Sub
	PlaySound "sega_outlane", 0 , DigitalSoundsLevel
	If WizardMode=1 then Exit Sub
	If BossBattle=1 Then Exit Sub
	Scoring : Addscore Rollover_Score
	If BallSave=1 Then
		Kicker001.CreateBall
		PlaySoundAt "fx_kicker",Kicker001
		Kicker001.Kick 0,40
		BallsOnPlayfield = BallsOnPlayfield+1
		SimpleBlinkTop "      BALL SAVE     "
		PlaySound "sega_extraball", 0 , DigitalSoundsLevel
		BallSave=0
		Exit Sub
	End If
	Select Case L_BottomRollover1.UserValue
		Case 2
			If BallsOnPlayfield<4 Then
				Kicker001.CreateBall
				PlaySoundAt "fx_kicker",Kicker001
				Kicker001.Kick 0,40
				BallsOnPlayfield = BallsOnPlayfield+1
				SimpleBlinkTop "      BALL SAVE     "
				PlaySound "sega_extraball", 0 , DigitalSoundsLevel
			Else ' This should never happen. Why did I do this?
				BonusMultiplier=BonusMultiplier+2 : DisplayTop "     BONUS X " & BonusMultiplier
				PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
				KKill BottomRollovers
			End If
			Kill L_BottomRollover1
		Case 1
			DoAbsolutelyNothing
		Case 0
			If L_BottomRollover2.UserValue=2 Then Exit Sub
			If L_BottomRollover3.UserValue=2 Then Exit Sub
			If L_BottomRollover4.UserValue=2 Then Exit Sub
			If L_BottomRollover5.UserValue=2 Then Exit Sub
			If L_BottomRollover6.UserValue=2 Then Exit Sub
			Ignite L_BottomRollover1
			If L_BottomRollover1.UserValue + L_BottomRollover2.UserValue + L_BottomRollover3.UserValue + L_BottomRollover4.UserValue + L_BottomRollover5.UserValue + L_BottomRollover6.UserValue >5 Then
				BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
				PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
				KKill BottomRollovers
				Blink L_BottomRollover1
			End If
	End Select
	UpdateCharacterLights
End Sub

Sub BottomRollover2_Hit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then 
		PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		Exit Sub
	End If
	If BossBattle=1 Then Exit Sub
	Scoring : Addscore Rollover_Score
	Select Case L_BottomRollover2.UserValue
		Case 2
			KKill BottomRollovers
			KKill TopRollovers
			RolloverAward
		Case 1
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		Case 0
			If L_BottomRollover1.UserValue=2 Then Exit Sub
			If L_BottomRollover3.UserValue=2 Then Exit Sub
			If L_BottomRollover4.UserValue=2 Then Exit Sub
			If L_BottomRollover5.UserValue=2 Then Exit Sub
			If L_BottomRollover6.UserValue=2 Then Exit Sub
			Ignite L_BottomRollover2
			If L_BottomRollover1.UserValue + L_BottomRollover2.UserValue + L_BottomRollover3.UserValue + L_BottomRollover4.UserValue + L_BottomRollover5.UserValue + L_BottomRollover6.UserValue >5 Then
				BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
				PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
				KKill BottomRollovers
				If EasyBallSave=1 Then
					Blink L_BottomRollover1
				Else
					Blink L_BottomRollover2
				End If
			Else
				PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			End If
	End Select
	UpdateCharacterLights
End Sub

Sub BottomRollover3_Hit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then 
		PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		Exit Sub
	End If
	If BossBattle=1 Then Exit Sub
	Scoring : Addscore Rollover_Score
	Select Case L_BottomRollover3.UserValue
		Case 2
			KKill BottomRollovers
			RolloverAward
		Case 1
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		Case 0
			If L_BottomRollover1.UserValue=2 Then Exit Sub
			If L_BottomRollover2.UserValue=2 Then Exit Sub
			If L_BottomRollover4.UserValue=2 Then Exit Sub
			If L_BottomRollover5.UserValue=2 Then Exit Sub
			If L_BottomRollover6.UserValue=2 Then Exit Sub
			Ignite L_BottomRollover3
			If L_BottomRollover1.UserValue + L_BottomRollover2.UserValue + L_BottomRollover3.UserValue + L_BottomRollover4.UserValue + L_BottomRollover5.UserValue + L_BottomRollover6.UserValue >5 Then
				BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
				PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
				KKill BottomRollovers
				KKill TopRollovers
				If EasyBallSave=1 Then
					Blink L_BottomRollover1
				Else
					Blink L_BottomRollover3
				End If
			Else
				PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			End If
	End Select
	UpdateCharacterLights
End Sub

Sub BottomRollover4_Hit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then 
		PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		Exit Sub
	End If
	If BossBattle=1 Then Exit Sub
	Scoring : Addscore Rollover_Score
	Select Case L_BottomRollover4.UserValue
		Case 2
			KKill BottomRollovers
			KKill TopRollovers
			RolloverAward
		Case 1
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		Case 0
			If L_BottomRollover1.UserValue=2 Then Exit Sub
			If L_BottomRollover2.UserValue=2 Then Exit Sub
			If L_BottomRollover3.UserValue=2 Then Exit Sub
			If L_BottomRollover5.UserValue=2 Then Exit Sub
			If L_BottomRollover6.UserValue=2 Then Exit Sub
			Ignite L_BottomRollover4
			If L_BottomRollover1.UserValue + L_BottomRollover2.UserValue + L_BottomRollover3.UserValue + L_BottomRollover4.UserValue + L_BottomRollover5.UserValue + L_BottomRollover6.UserValue >5 Then
				BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
				PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
				KKill BottomRollovers
				If EasyBallSave=1 Then
					Blink L_BottomRollover6
				Else
					Blink L_BottomRollover4
				End If
			Else
				PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			End If
	End Select
	UpdateCharacterLights
End Sub

Sub BottomRollover5_Hit
	If TableTilted=1 Then Exit Sub
	If WizardMode=1 Then 
		PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		Exit Sub
	End If
	If BossBattle=1 Then Exit Sub
	Scoring : Addscore Rollover_Score
	Select Case L_BottomRollover5.UserValue
		Case 2
			KKill BottomRollovers
			KKill TopRollovers
			RolloverAward
		Case 1
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		Case 0
			If L_BottomRollover1.UserValue=2 Then Exit Sub
			If L_BottomRollover2.UserValue=2 Then Exit Sub
			If L_BottomRollover3.UserValue=2 Then Exit Sub
			If L_BottomRollover4.UserValue=2 Then Exit Sub
			If L_BottomRollover6.UserValue=2 Then Exit Sub
			Ignite L_BottomRollover5
			If L_BottomRollover1.UserValue + L_BottomRollover2.UserValue + L_BottomRollover3.UserValue + L_BottomRollover4.UserValue + L_BottomRollover5.UserValue + L_BottomRollover6.UserValue >5 Then
				BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
				PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
				KKill BottomRollovers
				If EasyBallSave=1 Then
					Blink L_BottomRollover6
				Else
					Blink L_BottomRollover5
				End If
			Else
				PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			End If
	End Select
	UpdateCharacterLights
End Sub

Sub BottomRollover6_Hit
	If TableTilted=1 Then Exit Sub
	PlaySound "sega_outlane", 0 , DigitalSoundsLevel
	If WizardMode=1 then Exit Sub
	If BossBattle=1 Then Exit Sub
	Scoring : Addscore Rollover_Score
		If BallSave=1 Then
		Kicker001.CreateBall
		PlaySoundAt "fx_kicker",Kicker001
		Kicker001.Kick 0,40
		BallsOnPlayfield = BallsOnPlayfield+1
		SimpleBlinkTop "      BALL SAVE     "
		PlaySound "sega_extraball", 0 , DigitalSoundsLevel
		BallSave=0
		Exit Sub
	End If
	Select Case L_BottomRollover6.UserValue
		Case 2
			If BallsOnPlayfield<4 Then
				Kicker001.CreateBall
				PlaySoundAt "fx_kicker",Kicker001
				Kicker001.Kick 0,40
				BallsOnPlayfield = BallsOnPlayfield+1
				SimpleBlinkTop "      BALL SAVE     "
				PlaySound "sega_extraball", 0 , DigitalSoundsLevel
			Else
				BonusMultiplier=BonusMultiplier+2 : DisplayTop "     BONUS X " & BonusMultiplier
				PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
				KKill BottomRollovers
			End If
			Kill L_BottomRollover6
		Case 1
			DoAbsolutelyNothing
		Case 0
			If L_BottomRollover1.UserValue=2 Then Exit Sub
			If L_BottomRollover2.UserValue=2 Then Exit Sub
			If L_BottomRollover3.UserValue=2 Then Exit Sub
			If L_BottomRollover4.UserValue=2 Then Exit Sub
			If L_BottomRollover5.UserValue=2 Then Exit Sub
			Ignite L_BottomRollover6
			If L_BottomRollover1.UserValue + L_BottomRollover2.UserValue + L_BottomRollover3.UserValue + L_BottomRollover4.UserValue + L_BottomRollover5.UserValue + L_BottomRollover6.UserValue >5 Then
				BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
				PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
				KKill BottomRollovers
				Blink L_BottomRollover6
			End If
	End Select
	UpdateCharacterLights
End Sub

Sub CycleBottomRolloversLeft
	Dim TempBottomStateLeft
	Select Case EasyBallSave
		Case 0
			TempBottomStateLeft=L_BottomRollover1.UserValue
			L_BottomRollover1.UserValue = L_BottomRollover2.UserValue
			L_BottomRollover2.UserValue = L_BottomRollover3.UserValue
			L_BottomRollover3.UserValue = L_BottomRollover4.UserValue
			L_BottomRollover4.UserValue = L_BottomRollover5.UserValue
			L_BottomRollover5.UserValue = L_BottomRollover6.UserValue
			L_BottomRollover6.UserValue = TempBottomStateLeft
		Case 1
			If L_BottomRollover1.UserValue<>2 And L_BottomRollover6.UserValue<>2 Then
				TempBottomStateLeft=L_BottomRollover1.UserValue
				L_BottomRollover1.UserValue = L_BottomRollover2.UserValue
				L_BottomRollover2.UserValue = L_BottomRollover3.UserValue
				L_BottomRollover3.UserValue = L_BottomRollover4.UserValue
				L_BottomRollover4.UserValue = L_BottomRollover5.UserValue
				L_BottomRollover5.UserValue = L_BottomRollover6.UserValue
				L_BottomRollover6.UserValue = TempBottomStateLeft
			Else
				L_BottomRollover1.UserValue = 2
				L_BottomRollover6.UserValue = 0
			End If
	End Select			
End Sub
		
Sub CycleBottomRolloversRight
	Dim TempBottomStateRight
	Select Case EasyBallSave
		Case 0
			TempBottomStateRight=L_BottomRollover6.UserValue
			L_BottomRollover6.UserValue = L_BottomRollover5.UserValue
			L_BottomRollover5.UserValue = L_BottomRollover4.UserValue
			L_BottomRollover4.UserValue = L_BottomRollover3.UserValue
			L_BottomRollover3.UserValue = L_BottomRollover2.UserValue
			L_BottomRollover2.UserValue = L_BottomRollover1.UserValue
			L_BottomRollover1.UserValue = TempBottomStateRight
		Case 1
			If L_BottomRollover1.UserValue<>2 And L_BottomRollover6.UserValue<>2 Then
				TempBottomStateRight=L_BottomRollover6.UserValue
				L_BottomRollover6.UserValue = L_BottomRollover5.UserValue
				L_BottomRollover5.UserValue = L_BottomRollover4.UserValue
				L_BottomRollover4.UserValue = L_BottomRollover3.UserValue
				L_BottomRollover3.UserValue = L_BottomRollover2.UserValue
				L_BottomRollover2.UserValue = L_BottomRollover1.UserValue
				L_BottomRollover1.UserValue = TempBottomStateRight
			Else
				L_BottomRollover6.UserValue = 2
				L_BottomRollover1.UserValue = 0
			End If
		End Select
End Sub

Sub RolloverAward
	If TableTilted=1 Then Exit Sub
	If BallsOnPlayfield>1 Then ' If it's multiball, skip all the other possibilities and just award a Jackpot
		AwardJackpot L_CharacterSlater 'When you figure out why this is here, you will laugh. Okay maybe not.
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel
	Else
		Select Case SpectrumMode ' If it's a spectrum mode, fast forward the mode.
			Case 1 ' Cyan
				Kill L_OrbitTriangle
				Kill L_LeftBullseyeTriangle
				Kill L_StandupTriangle
				Ignite L_SpectrumCyan
				CyanComplete=1
				JustRolledOver=1
				AwardSpectrum
			Case 2 ' Blue
				Kill L_OrbitTriangle
				Kill L_MagentaRampTriangle
				Kill L_LeftBullseyeTriangle
				Kill L_RightBullseyeTriangle
				Ignite L_SpectrumBlue
				BlueComplete=1
				JustRolledOver=1
				AwardSpectrum
			Case 3 ' Magenta
				Kill L_MagentaRampTriangle
				Kill L_RightBullseyeTriangle
				Kill L_StandupTriangle
				Ignite L_SpectrumMagenta
				MagentaComplete=1
				AwardSpectrum
			Case 4 ' Red
				Kill L_MagentaRampTriangle
				Kill L_RightBullseyeTriangle
				Kill L_YellowRampTriangle
				Kill L_SpinnerTriangle
				Ignite L_SpectrumRed
				RedComplete=1
				JustRolledOver=1
				AwardSpectrum
			Case 5 ' Yellow
				Kill L_YellowRampTriangle
				Kill L_SpinnerTriangle
				Kill L_StandupTriangle
				Ignite L_SpectrumYellow
				YellowComplete=1
				JustRolledOver=1
				AwardSpectrum
			Case 6 ' Green
				Kill L_YellowRampTriangle
				Kill L_SpinnerTriangle
				Kill L_OrbitTriangle
				Kill L_LeftBullseyeTriangle
				Ignite L_SpectrumGreen
				GreenComplete=1
				JustRolledOver=1
				AwardSpectrum
			Case 0
				Select Case RescueMode
					Case 0 ' If absolutely nothing is happening, Just increase bonus X
						BonusMultiplier=BonusMultiplier+2 : DisplayTop "     BONUS X " & BonusMultiplier
						PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
						KKill BottomRollovers
					Case Else
						JustRolledOver=1
						AwardRescue
				End Select
		End Select
	End If
End Sub

'===============================
'§ Behavior of Upper Rollovers §
'===============================

Sub TopRollover1_Timer
	TopRollover1.TimerEnabled=0
End Sub

Sub TopRollover2_Timer
	TopRollover2.TimerEnabled=0
End Sub

Sub TopRollover3_Timer
	TopRollover3.TimerEnabled=0
End Sub

Sub TopRollover4_Timer
	TopRollover4.TimerEnabled=0
End Sub

Sub UpperRolloverAward
	If TableTilted=1 Then Exit Sub
	Select Case BallsOnPlayfield
	Case 0
		DoAbsolutelyNothing
	Case 1
		BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
		PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
		KKill TopRollovers
	Case Else
		AwardJackpot L_CharacterSlater
		PlaySound "sega_jackpot", 0 , DigitalSoundsLevel
	End Select
End Sub


Sub TopRollover1_Hit
	If TableTilted=1 Then Exit Sub
	If TopRollover1.TimerEnabled=1 Then Exit Sub
	TopRollover1.TimerEnabled=1
	Select Case EasyRollovers
	Case 0
		If WizardMode=1 Then
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Exit Sub
		End If
		If BossBattle=1 Then Exit Sub
		Scoring : Addscore Rollover_Score
		Ignite L_TopRollover1
		If L_TopRollover1.UserValue + L_TopRollover2.UserValue + L_TopRollover3.UserValue + L_TopRollover4.UserValue >3 Then
			UpperRolloverAward
		Else
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		End If
		UpdateCharacterLights
	Case 1
		If WizardMode=1 Then 
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Exit Sub
		End If
		If BossBattle=1 Then Exit Sub
		Scoring : Addscore Rollover_Score
		Select Case L_TopRollover1.UserValue
			Case 2
				KKill TopRollovers
				KKill BottomRollovers
				RolloverAward
			Case 1
				PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Case 0
				If L_TopRollover1.UserValue=2 Then Exit Sub
				If L_TopRollover2.UserValue=2 Then Exit Sub
				If L_TopRollover3.UserValue=2 Then Exit Sub
				If L_TopRollover4.UserValue=2 Then Exit Sub
				Ignite L_TopRollover1
				If L_TopRollover1.UserValue + L_TopRollover2.UserValue + L_TopRollover3.UserValue + L_TopRollover4.UserValue >3 Then
					BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
					PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
					KKill TopRollovers
					Blink L_TopRollover1
				Else
					PlaySound "sega_rollover", 0 , DigitalSoundsLevel
				End If
		End Select
		UpdateCharacterLights
	End Select
End Sub

Sub TopRollover2_Hit
	If TableTilted=1 Then Exit Sub
	If TopRollover2.TimerEnabled=1 Then Exit Sub
	TopRollover2.TimerEnabled=1
	Select Case EasyRollovers
	Case 0
		If WizardMode=1 Then
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Exit Sub
		End If
		If BossBattle=1 Then Exit Sub
		Scoring : Addscore Rollover_Score
		Ignite L_TopRollover2
		If L_TopRollover1.UserValue + L_TopRollover2.UserValue + L_TopRollover3.UserValue + L_TopRollover4.UserValue >3 Then
			UpperRolloverAward
		Else
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		End If
		UpdateCharacterLights
	Case 1
		If WizardMode=1 Then 
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Exit Sub
		End If
		If BossBattle=1 Then Exit Sub
		Scoring : Addscore Rollover_Score
		Select Case L_TopRollover2.UserValue
			Case 2
				KKill TopRollovers
				KKill BottomRollovers
				RolloverAward
			Case 1
				PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Case 0
				If L_TopRollover1.UserValue=2 Then Exit Sub
				If L_TopRollover2.UserValue=2 Then Exit Sub
				If L_TopRollover3.UserValue=2 Then Exit Sub
				If L_TopRollover4.UserValue=2 Then Exit Sub
				Ignite L_TopRollover2
				If L_TopRollover1.UserValue + L_TopRollover2.UserValue + L_TopRollover3.UserValue + L_TopRollover4.UserValue >3 Then
					BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
					PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
					KKill TopRollovers
					Blink L_TopRollover2
				Else
					PlaySound "sega_rollover", 0 , DigitalSoundsLevel
				End If
		End Select
		UpdateCharacterLights
	End Select
End Sub

Sub TopRollover3_Hit
	If TableTilted=1 Then Exit Sub
	If TopRollover3.TimerEnabled=1 Then Exit Sub
	TopRollover3.TimerEnabled=1
	Select Case EasyRollovers
	Case 0
		If WizardMode=1 Then
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Exit Sub
		End If
		If BossBattle=1 Then Exit Sub
		Scoring : Addscore Rollover_Score
		Ignite L_TopRollover3
		If L_TopRollover1.UserValue + L_TopRollover2.UserValue + L_TopRollover3.UserValue + L_TopRollover4.UserValue >3 Then
			UpperRolloverAward
		Else
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		End If
		UpdateCharacterLights
	Case 1
		If WizardMode=1 Then 
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Exit Sub
		End If
		If BossBattle=1 Then Exit Sub
		Scoring : Addscore Rollover_Score
		Select Case L_TopRollover3.UserValue
			Case 2
				KKill TopRollovers
				KKill BottomRollovers
				RolloverAward
			Case 1
				PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Case 0
				If L_TopRollover1.UserValue=2 Then Exit Sub
				If L_TopRollover2.UserValue=2 Then Exit Sub
				If L_TopRollover3.UserValue=2 Then Exit Sub
				If L_TopRollover4.UserValue=2 Then Exit Sub
				Ignite L_TopRollover3
				If L_TopRollover1.UserValue + L_TopRollover2.UserValue + L_TopRollover3.UserValue + L_TopRollover4.UserValue >3 Then
					BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
					PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
					KKill TopRollovers
					Blink L_TopRollover3
				Else
					PlaySound "sega_rollover", 0 , DigitalSoundsLevel
				End If
		End Select
		UpdateCharacterLights
	End Select
End Sub


Sub TopRollover4_Hit
	If TableTilted=1 Then Exit Sub
	If TopRollover4.TimerEnabled=1 Then Exit Sub
	TopRollover4.TimerEnabled=1
	Select Case EasyRollovers
	Case 0
		If WizardMode=1 Then
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Exit Sub
		End If
		If BossBattle=1 Then Exit Sub
		Scoring : Addscore Rollover_Score
		Ignite L_TopRollover4
		If L_TopRollover1.UserValue + L_TopRollover2.UserValue + L_TopRollover3.UserValue + L_TopRollover4.UserValue >3 Then
			UpperRolloverAward
		Else
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
		End If
		UpdateCharacterLights
	Case 1
		If WizardMode=1 Then 
			PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Exit Sub
		End If
		If BossBattle=1 Then Exit Sub
		Scoring : Addscore Rollover_Score
		Select Case L_TopRollover4.UserValue
			Case 2
				KKill TopRollovers
				KKill BottomRollovers
				RolloverAward
			Case 1
				PlaySound "sega_rollover", 0 , DigitalSoundsLevel
			Case 0
				If L_TopRollover1.UserValue=2 Then Exit Sub
				If L_TopRollover2.UserValue=2 Then Exit Sub
				If L_TopRollover3.UserValue=2 Then Exit Sub
				If L_TopRollover4.UserValue=2 Then Exit Sub
				Ignite L_TopRollover4
				If L_TopRollover1.UserValue + L_TopRollover2.UserValue + L_TopRollover3.UserValue + L_TopRollover4.UserValue >3 Then
					BonusMultiplier=BonusMultiplier+1 : DisplayTop "     BONUS X " & BonusMultiplier
					PlaySound "sega_increasebonusx", 0 , DigitalSoundsLevel
					KKill TopRollovers
					Blink L_TopRollover4
				Else
					PlaySound "sega_rollover", 0 , DigitalSoundsLevel
				End If
		End Select
		UpdateCharacterLights
	End Select
End Sub

Sub CycleTopRolloversLeft
	Dim TempTopStateLeft
	TempTopStateLeft=L_TopRollover1.UserValue
	L_TopRollover1.UserValue = L_TopRollover2.UserValue
	L_TopRollover2.UserValue = L_TopRollover3.UserValue
	L_TopRollover3.UserValue = L_TopRollover4.UserValue
	L_TopRollover4.UserValue = TempTopStateLeft
End Sub

Sub CycleTopRolloversRight
	Dim TempTopStateRight
	TempTopStateRight=L_TopRollover4.UserValue
	L_TopRollover4.UserValue = L_TopRollover3.UserValue
	L_TopRollover3.UserValue = L_TopRollover2.UserValue
	L_TopRollover2.UserValue = L_TopRollover1.UserValue
	L_TopRollover1.UserValue = TempTopStateRight
End Sub


'======================================
'§ Color Changing and Light Behaviors §
'======================================

Sub SegmentColor(hexvalue)
	Dim LEDSegment
		For each LEDSegment in LEDs
			LEDSegment.Color=hexvalue 
		Next
End Sub

Dim PlayfieldColor : PlayfieldColor = Neutral ' Used in other subs to determine whether it's a spectrum MB

Sub GIColor(hexvalue)
	Dim Lightbulb
		For each Lightbulb in GILights
			Lightbulb.Color=hexvalue 
			Lightbulb.ColorFull=hexvalue 
'			If hexvalue=Neutral Then 
'				Lightbulb.state=1
'			Else
'				Lightbulb.state=2
'			End If
		Next
	PlayfieldColor = hexvalue
End Sub

Dim WizardLightIncrement : WizardLightIncrement =0

Sub CrazyWizardLights_Timer
	Dim GILightbulb
	Dim InsertLightBulb
	WizardLightIncrement=WizardLightIncrement+1
	If WizardLightIncrement>2 Then WizardLightIncrement=0
	Select Case PlayfieldColor
		Case Crazy
		If WizardLightIncrement=0 Then
			For each GILightbulb in GILights
				Select Case Int(Rnd*6)+1
					Case 1
						GILightbulb.Color=Cyan
						GILightbulb.ColorFull=Cyan
					Case 2
						GILightbulb.Color=Blue
						GILightbulb.ColorFull=Blue
					Case 3
						GILightbulb.Color=Magenta
						GILightbulb.ColorFull=Magenta
					Case 4
						GILightbulb.Color=Red
						GILightbulb.ColorFull=Red
					Case 5
						GILightbulb.Color=Yellow
						GILightbulb.ColorFull=Yellow
					Case 6
						GILightbulb.Color=Green
						GILightbulb.ColorFull=Green
				End Select
			Next
		End If
		For Each InsertLightBulb In SpectrumInserts
			Select Case Int(Rnd*2)+1
				Case 1
					TurnOn InsertLightBulb 'This is one of the rare places where TurnOn / TurnOff actually makes sense instead of Ignite / Kill
				Case 2
					TurnOff InsertLightBulb 'You'll laugh when you figure out why. Or facepalm. Or neither.
			End Select
		Next
		Case Else
			GIColor Neutral
			PlayfieldColor = Neutral
			CrazyWizardLights.enabled=0
	End Select
End Sub

Sub CrazyInkLights_Timer
	Dim InkLightbulbCMY
	Dim InkLightbulbK
	Select Case PlayfieldColor
		Case Neutral
			CrazyInkLights.enabled=0
		Case Else
			For each InkLightbulbCMY in CMYInkLights
				Select Case Int(Rnd*2)
					Case 0
						InkLightbulbCMY.state=1 : InkLightbulbCMY.image="lightsspecial"
					Case 1
						InkLightbulbCMY.state=1 : InkLightbulbCMY.image="lightson"
				End Select
			Next
			For each InkLightbulbK in KInkLights
				Select Case Int(Rnd*2)
					Case 0
						InkLightbulbK.state=0 : InkLightbulbK.image="lightsoff"
					Case 1
						InkLightbulbK.state=1 : InkLightbulbK.image="lightson"
				End Select
			Next
	End Select
End Sub

Dim BlinkLowerRolloverStep : BlinkLowerRolloverStep=0
Dim BlinkUpperRolloverStep : BlinkUpperRolloverStep=0
Dim BlinkGreenStep : BlinkGreenStep=0
Dim BlinkYellowStep : BlinkYellowStep=0
Dim BlinkSpectrumStep : BlinkSpectrumStep=0
Dim BlinkMagentaStep : BlinkMagentaStep=0
Dim BlinkCyanStep : BlinkCyanStep=0
Dim BlinkBallSaveStep : BlinkBallSaveStep=0
Dim BlinkWhiteStep : BlinkWhiteStep=0
Dim BlinkRedStep : BlinkRedStep=0
Dim BlinkWizardStep : BlinkWizardStep=0
Dim NormalDisplayStep : NormalDisplayStep=0
Dim AttractStep : AttractStep=0

Sub AttractMode_Timer
'	Dim Lightbulb
	'AttractStep=AttractStep+1
	'If AttractStep>2 Then AttractStep=1
	'Select Case AttractStep
		'Case 1
			'KKill YellowInserts
			'KKill KeyInserts
			'IIgnite MagentaInserts
			'IIgnite CyanInserts
		'Case 2
			'IIgnite YellowInserts
			'IIgnite KeyInserts
			'KKill MagentaInserts
			'KKill CyanInserts
	'End Select
End Sub

Sub BlinkRed_Timer
	BlinkRedStep = BlinkRedStep +1
	If BlinkRedStep > 4 Then BlinkRedStep =1
	Dim Insert
	For Each Insert In RedInserts
	Select Case Insert.UserValue
		Case 0 : TurnOff Insert
		Case 1 : TurnOn Insert
		Case 2 : Select Case BlinkRedStep 
					Case 1 : TurnOn Insert
					Case 2 : TurnOn Insert
					Case 3 : TurnOff Insert
					Case 4 : TurnOff Insert
				End Select
		End Select
	Next
End Sub

Sub BlinkWhite_Timer
	BlinkWhiteStep = BlinkWhiteStep +1
	If BlinkWhiteStep > 4 Then BlinkWhiteStep =1
	Dim Insert
	For Each Insert In WhiteInserts
	Select Case Insert.UserValue
		Case 0 : TurnOff Insert
		Case 1 : TurnOn Insert
		Case 2 : Select Case BlinkWhiteStep 
					Case 1 : TurnOn Insert
					Case 2 : TurnOn Insert
					Case 3 : TurnOff Insert
					Case 4 : TurnOff Insert
				End Select
		End Select
	Next
End Sub

Sub BlinkWizard_Timer
	BlinkWizardStep = BlinkWizardStep +1
	If BlinkWizardStep > 4 Then BlinkWizardStep =1
	Dim Insert
	For Each Insert In WizardInserts
	Select Case Insert.UserValue
		Case 0 : TurnOff Insert
		Case 1 : TurnOn Insert
		Case 2 : Select Case BlinkWizardStep 
					Case 1 : TurnOn Insert
					Case 2 : TurnOn Insert
					Case 3 : TurnOff Insert
					Case 4 : TurnOff Insert
				End Select
		End Select
	Next
End Sub

Sub BlinkMagenta_Timer
	BlinkMagentaStep = BlinkMagentaStep +1
	If BlinkMagentaStep > 4 Then BlinkMagentaStep =1
	Dim Insert
	For Each Insert In MagentaInserts
	Select Case Insert.UserValue
		Case 0 : TurnOff Insert
		Case 1 : TurnOn Insert
		Case 2 : Select Case BlinkMagentaStep 
					Case 1 : TurnOn Insert
					Case 2 : TurnOn Insert
					Case 3 : TurnOff Insert
					Case 4 : TurnOff Insert
				End Select
		End Select
	Next
End Sub

Sub NormalDisplay_Timer
	If TableTilted=0 And BossBattle=0 And SpectrumMode=0 And RescueMode=0 And GameOver=0 And CountingBonus=0 And (YouHaveFailed.enabled+L_ScoopTriangle.UserValue + L_OrbitJackpot.UserValue + L_MagentaRampJackpot.UserValue + L_YellowRampJackpot.UserValue + L_PaintCanJackpot.UserValue + L_SpinnerLockBall.UserValue) = 0 And (Start2MultiBall.enabled + Start3MultiBall.enabled + Start4MultiBall.enabled) = 0 Then
		NormalDisplayStep=NormalDisplayStep+1
		If NormalDisplayStep>14 Then NormalDisplayStep=1
		Select Case NormalDisplayStep
			Case 1
				KKill DropTargetLights
				Kill L_LeftBullseyeTriangle
				Kill L_RightBullseyeTriangle
				Ignite L_SpinnerTriangle
			Case 2
				Kill L_SpinnerTriangle
				Ignite L_OrbitTriangle
				Ignite L_PaintCanTriangle
			Case 3
				Ignite L_MagentaRampTriangle
				Ignite L_StandupTriangle
				Kill L_OrbitTriangle
				Kill	L_PaintCanTriangle
			Case 4
				Kill L_MagentaRampTriangle
				Kill L_StandupTriangle
				Ignite L_YellowRampTriangle
			Case 5
				Kill L_YellowRampTriangle
				Ignite L_LeftBullseyeTriangle
				Ignite L_RightBullseyeTriangle
			Case 6
				Kill L_LeftBullseyeTriangle
				Kill L_RightBullseyeTriangle
			Case 7
				IIgnite DropTargetLights
			Case 9
				KKill DropTargetLights
			Case 11
				IIgnite DropTargetLights
			Case 13
				KKill DropTargetLights
		End Select
	End If
End Sub

Sub BlinkBallSave_Timer
	BlinkBallSaveStep = BlinkBallSaveStep +1
	If BlinkBallSaveStep > 2 Then BlinkBallSaveStep =1
	If BallSave=1 Then
		Select Case BlinkBallSaveStep 
			Case 1 : TurnOn L_BallSave
			Case 2 : TurnOff L_BallSave
		End Select
	Else
		If ExtraBalls+WizardMode>0 And L_CharacterSlater.state=0 Then
			TurnOn L_BallSave
		Else
			TurnOff L_BallSave
		End If
	End If
End Sub

Sub BlinkCyan_Timer
	BlinkCyanStep = BlinkCyanStep +1
	If BlinkCyanStep > 4 Then BlinkCyanStep =1
	Dim Insert
	For Each Insert In CyanInserts
	Select Case Insert.UserValue
		Case 0 : TurnOff Insert
		Case 1 : TurnOn Insert
		Case 2 : Select Case BlinkCyanStep 
					Case 1 : TurnOn Insert
					Case 2 : TurnOn Insert
					Case 3 : TurnOff Insert
					Case 4 : TurnOff Insert
				End Select
		End Select
	Next
End Sub

Sub BlinkSpectrum_Timer
	BlinkSpectrumStep = BlinkSpectrumStep +1
	If BlinkSpectrumStep > 4 Then BlinkSpectrumStep =1
	Dim Insert
	For Each Insert In SpectrumInserts
	Select Case Insert.UserValue
		Case 0 : TurnOff Insert
		Case 1 : TurnOn Insert
		Case 2 : Select Case BlinkSpectrumStep 
					Case 1 : TurnOn Insert
					Case 2 : TurnOn Insert
					Case 3 : TurnOff Insert
					Case 4 : TurnOff Insert
				End Select
		End Select
	Next
End Sub

Sub BlinkYellow_Timer
	BlinkYellowStep = BlinkYellowStep +1
	If BlinkYellowStep > 4 Then BlinkYellowStep =1
	Dim Insert
	For Each Insert In YellowInserts
	Select Case Insert.UserValue
		Case 0 : TurnOff Insert
		Case 1 : TurnOn Insert
		Case 2 : Select Case BlinkYellowStep 
					Case 1 : TurnOn Insert
					Case 2 : TurnOn Insert
					Case 3 : TurnOff Insert
					Case 4 : TurnOff Insert
				End Select
		End Select
	Next
End Sub

Sub BlinkGreen_Timer
	BlinkGreenStep = BlinkGreenStep +1
	If BlinkGreenStep > 4 Then BlinkGreenStep =1
	Dim Insert
	For Each Insert In GreenInserts
	Select Case Insert.UserValue
		Case 0 : TurnOff Insert
		Case 1 : TurnOn Insert
		Case 2 : Select Case BlinkGreenStep 
					Case 1 : TurnOn Insert
					Case 2 : TurnOn Insert
					Case 3 : TurnOff Insert
					Case 4 : TurnOff Insert
				End Select
		End Select
	Next
End Sub

Sub BlinkLowerRollover_Timer
	BlinkLowerRolloverStep = BlinkLowerRolloverStep +1
	If BlinkLowerRolloverStep > 4 Then BlinkLowerRolloverStep =1
	Dim Insert
	For Each Insert In BottomRollovers
	Select Case Insert.UserValue
		Case 0 : TurnOff Insert
		Case 1 : TurnOn Insert
		Case 2 : Select Case BlinkLowerRolloverStep 
					Case 1 : TurnOn Insert
					Case 2 : TurnOn Insert
					Case 3 : TurnOff Insert
					Case 4 : TurnOff Insert
				End Select
		End Select
	Next
End Sub

Sub BlinkUpperRollover_Timer
	BlinkUpperRolloverStep = BlinkUpperRolloverStep +1
	If BlinkUpperRolloverStep > 4 Then BlinkUpperRolloverStep =1
	Dim Insert
	For Each Insert In TopRollovers
	Select Case Insert.UserValue
		Case 0 : TurnOff Insert
		Case 1 : TurnOn Insert
		Case 2 : Select Case BlinkUpperRolloverStep 
					Case 1 : TurnOn Insert
					Case 2 : TurnOn Insert
					Case 3 : TurnOff Insert
					Case 4 : TurnOff Insert
				End Select
		End Select
	Next
End Sub

'===========
'§ Scoring §
'===========

Dim	Scoop_Score
Dim	GateYellow_Score
Dim	TargetCyan_Score
Dim	TargetMagenta_Score
Dim	SprayCan_Score
Dim	PaintCan_Score
Dim	CyanBumper_Score
Dim	MagentaBumper_Score
Dim	YellowBumper_Score
Dim	Drop_Score
Dim	TargetBlack_Score
Dim	GateCyan_Score
Dim	MagentaRamp_Score
Dim	Captiveball_Score
Dim	YellowRamp_Score
Dim	YellowSpinner_Score
Dim	Rollover_Score
Dim	Slingshot_Score
Dim	CyanBar_Score
Dim	MagentaBar_Score
Dim	YellowBar_Score
Dim	KeyBar_Score
Dim	CymonRescue_Score
Dim	MaggieRescue_Score
Dim	YoloRescue_Score
Dim	KeenenRescue_Score
Dim	Jackpot_Score
Dim PainCanJackpot_Score
Dim SprayCanJackpot_Score
Dim BonusInk_Score
Dim FriendsBonus_Score
Dim SpectrumBonus_Score
Dim	PaintCanBonus_Score
Dim SprayCanBonus_Score
Dim BossVictory_Score
Dim Overflow_Score

Sub AddScore(value)
	If TableTilted=1 Then Exit Sub
	CurrentScore = CurrentScore + value : UpdateScore
End Sub

Sub Scoring ' "It will never be efficient to calculate the value of a hit many times with a timer." - Wizball
	CymonRescue_Score	= 2500000 * (1 + CyanComplete + BlueComplete + GreenComplete + MaggieRescued + YoloRescued + KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	MaggieRescue_Score	= 2500000 * (1 + MagentaComplete + BlueComplete + RedComplete + CymonRescued + YoloRescued + KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	YoloRescue_Score    = 2500000 * (1 + YellowComplete + RedComplete + GreenComplete + CymonRescued + MaggieRescued + KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	KeenenRescue_Score	= 5000000 * (1 + CymonRescued + MaggieRescued + KeenenRescued + YoloRescued) * (BallsOnPlayfield+NewGamePlus)
	CyanBar_Score		= 250000 * (1 + CyanComplete + BlueComplete + GreenComplete + (CymonRescued*4)) * (BallsOnPlayfield+NewGamePlus)
	MagentaBar_Score	= 250000 * (1 + MagentaComplete + BlueComplete + RedComplete + (MaggieRescued*4)) * (BallsOnPlayfield+NewGamePlus)
	YellowBar_Score     = 250000 * (1 + YellowComplete + RedComplete + GreenComplete + (YoloRescued*4)) * (BallsOnPlayfield+NewGamePlus)
	KeyBar_Score		= 750000 * (1+(KeenenRescued*4)) * (BallsOnPlayfield+NewGamePlus)
	Scoop_Score			= 5000 * (BallsOnPlayfield+NewGamePlus)
	GateYellow_Score	= 25000 * (1 + YellowComplete + RedComplete + GreenComplete + (YoloRescued*4)+ KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	TargetCyan_Score	= 10000 * (1 + CyanComplete + BlueComplete + GreenComplete + (CymonRescued*4)+ KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	TargetMagenta_Score	= 10000 * (1 + MagentaComplete + BlueComplete + RedComplete + (MaggieRescued*4)+ KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	SprayCan_Score		= 0 * BallsOnPlayfield ' It got too confusing watching the toys both score and increase bonus so these now award Nothing
	PaintCan_Score		= 0 * BallsOnPlayfield * (1+(KeenenRescued*4)) ' See above
	CyanBumper_Score	= 1000 * (1 + CyanComplete + BlueComplete + GreenComplete + (CymonRescued*4)+ KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	MagentaBumper_Score	= 2000 * (1 + MagentaComplete + BlueComplete + RedComplete + (MaggieRescued*4)+ KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	YellowBumper_Score	= 10000 * (1 + YellowComplete + RedComplete + GreenComplete + (YoloRescued*4)+ KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	Drop_Score			= 10000 * (BallsOnPlayfield+NewGamePlus)
	TargetBlack_Score	= 30000 * (1+(KeenenRescued*4)) * (BallsOnPlayfield+NewGamePlus)
	GateCyan_Score		= 50000 * (1 + CyanComplete + BlueComplete + GreenComplete + (CymonRescued*4)+ KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	MagentaRamp_Score	= 100000 * (1 + MagentaComplete + BlueComplete + RedComplete + (MaggieRescued*4)+ KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	Captiveball_Score	= 4000 * (BallsOnPlayfield+NewGamePlus)
	YellowRamp_Score	= 100000 * (1 + YellowComplete + RedComplete + GreenComplete + (YoloRescued*4)+ KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	YellowSpinner_Score	= 10000 * (1 + YellowComplete + RedComplete + GreenComplete + (YoloRescued*4)+ KeenenRescued) * (BallsOnPlayfield+NewGamePlus)
	Rollover_Score		= 1500 * (BallsOnPlayfield+NewGamePlus)
	Slingshot_Score		= 2000 * (BallsOnPlayfield+NewGamePlus)
	PainCanJackpot_Score  = 2500 * (BallsOnPlayfield+NewGamePlus)
	SprayCanJackpot_Score = 2500 * (BallsOnPlayfield+NewGamePlus)
	BonusInk_Score        = 2500 * NewGamePlus
	FriendsBonus_Score	  = 250000 * NewGamePlus
	Overflow_Score		  = 250000 * NewGamePlus
	SpectrumBonus_Score   = 125000 * NewGamePlus
	PaintCanBonus_Score	  = 2500 * NewGamePlus
	SprayCanBonus_Score   = 2500 * NewGamePlus
	BossVictory_Score     = 100000000 * NewGamePlus
End Sub


'==================================
'§ Behavior of Diverters and Barrel
'==================================


 Sub SLS_Hit()
	If ActiveBall.VelY<0 Then
		DivDir = -3
		closedSL.IsDropped=1
		OpenSL.IsDropped=0
	End If
	If ParkMessageBottom = "    LAUNCH BALL    " Then ParkMessageBottom=""
	If BallsOnPlayfield=1 Then BlinkBallInPlay
End Sub
 
 Sub SLS2_Hit()
		DivDir = 0.75
 		closedSL.IsDropped=0
		OpenSL.IsDropped=1
 End Sub

 Dim DivDir: DivDir=0
 Dim DivPos: DivPos = 43

Dim CheckForBadDiverter 

 Sub L_SLS_Hit()
	If ActiveBall.VelY<0 Then
		LeftDivDir = -3
		L_closedSL.IsDropped=1
		L_OpenSL.IsDropped=0
		CheckForBadDiverter=1
		CyanDiverterRealistic.enabled=1
	End If
End Sub
 
Sub CyanDiverterRealistic_Timer
	If CheckForBadDiverter=1 Then
		LeftDivDir = 0.5
 		L_closedSL.IsDropped=0
		L_OpenSL.IsDropped=1
	End If
	CyanDiverterRealistic.enabled=0
End Sub

 Sub L_SLS2_Hit()
		LeftDivDir = 0.5
 		L_closedSL.IsDropped=0
		L_OpenSL.IsDropped=1
		CheckForBadDiverter=0
 End Sub

 Dim LeftDivDir: LeftDivDir=0
 Dim LeftDivPos: LeftDivPos = -18
 Dim BarrelRDir: BarrelRDir=-1
 Dim BarrelRPos: BarrelRPos = -49

Sub UpdateDiverter_Timer
	DivPos = DivPos + DivDir
	If DivPos >= 43 then DivPos = 43:DivDir = 0
	If DivPos <= 26 then DivPos = 26:DivDir = 0
	OpenSLP.ObjRotZ = DivPos
	LeftDivPos = LeftDivPos + LeftDivDir
	If LeftDivPos >= -18 then LeftDivPos = -18:LeftDivDir = 0
	If LeftDivPos <= -40 then LeftDivPos = -40:LeftDivDir = 0
	L_OpenSLP.ObjRotZ = LeftDivPos
	BarrelRPos = BarrelRPos + BarrelRDir
	If BarrelRPos >1 then BarrelRPos = 1 : BarrelRDir = 0
	If BarrelRPos <-49 then BarrelRPos = -49 : BarrelRDir = 0
	P_BarrelR.TransY=BarrelRPos 

End Sub

Sub RBarrelUp
	BarrelRDir=4
	W_BarrelR.isdropped=0
End Sub

Sub RBarrelDown
	BarrelRDir=-4
	W_BarrelR.isdropped=1
End Sub


'===========================
'§ Behavior of LED Display §
'===========================

' Nearly all of the code for the embedded segment display was written with the help of ChatGPT
' I'll happily take credit for the trainwreck of code above, but I have only a passing idea of
' what this particular subsection actually accomplishes. If you understand any of this crap,
' you're a better man than I am.

Dim SecondTopLine
Dim SecondBottomLine

Dim Black		: Black		= RGB(000,000,000)
Dim Crazy		: Crazy		= RGB(001,001,001)

Dim Cyan		: Cyan		= RGB(001,255,255)
Dim Magenta		: Magenta	= RGB(255,032,255)
Dim Yellow 		: Yellow	= RGB(255,255,001)

Dim Blue 		: Blue		= RGB(064,064,255)
Dim Red 		: Red		= RGB(255,016,016)
Dim Green		: Green		= RGB(001,255,001)

Dim Sky			: Sky		= RGB(001,160,255)
Dim Purple		: Purple	= RGB(128,001,255)
Dim Rose		: Rose		= RGB(255,001,128)
Dim Orange 		: Orange	= RGB(255,080,001)
Dim Lime		: Lime		= RGB(096,255,001)
Dim Ocean		: Ocean		= RGB(001,255,096)
Dim Neutral		: Neutral   = RGB(255,193,132)

Sub CycleColors
	ColorCycle=ColorCycle+1
	If ColorCycle>12 then ColorCycle=0
	Select Case ColorCycle
		Case 0 : SegmentColor Neutral : DisplayTop "NEUTRAL"
		Case 1 : SegmentColor Cyan : DisplayTop "CYAN"
		Case 2 : SegmentColor Sky : DisplayTop "SKY"
		Case 3 : SegmentColor Blue : DisplayTop "BLUE"
		Case 4 : SegmentColor Purple : DisplayTop "PURPLE"
		Case 5 : SegmentColor Magenta : DisplayTop "MAGENTA"
		Case 6 : SegmentColor Rose : DisplayTop "ROSE"
		Case 7 : SegmentColor Red : DisplayTop "RED"
		Case 8 : SegmentColor Orange : DisplayTop "ORANGE"
		Case 9 : SegmentColor Yellow : DisplayTop "YELLOW"
		Case 10 : SegmentColor Lime : DisplayTop "LIME"
		Case 11 : SegmentColor Green : DisplayTop "GREEN"
		Case 12 : SegmentColor Ocean : DisplayTop "OCEAN"
	End Select
End Sub

Sub DeCycleColors
	ColorCycle=ColorCycle-1
	If ColorCycle<0 then ColorCycle=12
	Select Case ColorCycle
		Case 0 : SegmentColor Neutral : DisplayTop "NEUTRAL"
		Case 1 : SegmentColor Cyan : DisplayTop "CYAN"
		Case 2 : SegmentColor Sky : DisplayTop "SKY"
		Case 3 : SegmentColor Blue : DisplayTop "BLUE"
		Case 4 : SegmentColor Purple : DisplayTop "PURPLE"
		Case 5 : SegmentColor Magenta : DisplayTop "MAGENTA"
		Case 6 : SegmentColor Rose : DisplayTop "ROSE"
		Case 7 : SegmentColor Red : DisplayTop "RED"
		Case 8 : SegmentColor Orange : DisplayTop "ORANGE"
		Case 9 : SegmentColor Yellow : DisplayTop "YELLOW"
		Case 10 : SegmentColor Lime : DisplayTop "LIME"
		Case 11 : SegmentColor Green : DisplayTop "GREEN"
		Case 12 : SegmentColor Ocean : DisplayTop "OCEAN"
	End Select
End Sub

Sub ChangeColor(light,newcolor) : light.color=newcolor : light.colorfull=newcolor : End Sub
Sub CChangeColor(light, newcolor)  : Dim Insert : For each Insert in light : insert.color=newcolor : insert.colorfull=newcolor : Next : End Sub
Dim segmentArray(49)

segmentArray(0) = Array(gottlieba001, gottliebb001, gottliebc001, gottliebd001, gottliebe001, gottliebf001, gottliebg001, gottliebh001, gottliebi001, gottliebj001, gottliebk001, gottliebl001, gottliebm001, gottliebn001)
segmentArray(1) = Array(gottlieba002, gottliebb002, gottliebc002, gottliebd002, gottliebe002, gottliebf002, gottliebg002, gottliebh002, gottliebi002, gottliebj002, gottliebk002, gottliebl002, gottliebm002, gottliebn002)
segmentArray(2) = Array(gottlieba003, gottliebb003, gottliebc003, gottliebd003, gottliebe003, gottliebf003, gottliebg003, gottliebh003, gottliebi003, gottliebj003, gottliebk003, gottliebl003, gottliebm003, gottliebn003)
segmentArray(3) = Array(gottlieba004, gottliebb004, gottliebc004, gottliebd004, gottliebe004, gottliebf004, gottliebg004, gottliebh004, gottliebi004, gottliebj004, gottliebk004, gottliebl004, gottliebm004, gottliebn004)
segmentArray(4) = Array(gottlieba005, gottliebb005, gottliebc005, gottliebd005, gottliebe005, gottliebf005, gottliebg005, gottliebh005, gottliebi005, gottliebj005, gottliebk005, gottliebl005, gottliebm005, gottliebn005)
segmentArray(5) = Array(gottlieba006, gottliebb006, gottliebc006, gottliebd006, gottliebe006, gottliebf006, gottliebg006, gottliebh006, gottliebi006, gottliebj006, gottliebk006, gottliebl006, gottliebm006, gottliebn006)
segmentArray(6) = Array(gottlieba007, gottliebb007, gottliebc007, gottliebd007, gottliebe007, gottliebf007, gottliebg007, gottliebh007, gottliebi007, gottliebj007, gottliebk007, gottliebl007, gottliebm007, gottliebn007)
segmentArray(7) = Array(gottlieba008, gottliebb008, gottliebc008, gottliebd008, gottliebe008, gottliebf008, gottliebg008, gottliebh008, gottliebi008, gottliebj008, gottliebk008, gottliebl008, gottliebm008, gottliebn008)
segmentArray(8) = Array(gottlieba009, gottliebb009, gottliebc009, gottliebd009, gottliebe009, gottliebf009, gottliebg009, gottliebh009, gottliebi009, gottliebj009, gottliebk009, gottliebl009, gottliebm009, gottliebn009)
segmentArray(9) = Array(gottlieba010, gottliebb010, gottliebc010, gottliebd010, gottliebe010, gottliebf010, gottliebg010, gottliebh010, gottliebi010, gottliebj010, gottliebk010, gottliebl010, gottliebm010, gottliebn010)
segmentArray(10) = Array(gottlieba011, gottliebb011, gottliebc011, gottliebd011, gottliebe011, gottliebf011, gottliebg011, gottliebh011, gottliebi011, gottliebj011, gottliebk011, gottliebl011, gottliebm011, gottliebn011)
segmentArray(11) = Array(gottlieba012, gottliebb012, gottliebc012, gottliebd012, gottliebe012, gottliebf012, gottliebg012, gottliebh012, gottliebi012, gottliebj012, gottliebk012, gottliebl012, gottliebm012, gottliebn012)
segmentArray(12) = Array(gottlieba013, gottliebb013, gottliebc013, gottliebd013, gottliebe013, gottliebf013, gottliebg013, gottliebh013, gottliebi013, gottliebj013, gottliebk013, gottliebl013, gottliebm013, gottliebn013)
segmentArray(13) = Array(gottlieba014, gottliebb014, gottliebc014, gottliebd014, gottliebe014, gottliebf014, gottliebg014, gottliebh014, gottliebi014, gottliebj014, gottliebk014, gottliebl014, gottliebm014, gottliebn014)
segmentArray(14) = Array(gottlieba015, gottliebb015, gottliebc015, gottliebd015, gottliebe015, gottliebf015, gottliebg015, gottliebh015, gottliebi015, gottliebj015, gottliebk015, gottliebl015, gottliebm015, gottliebn015)
segmentArray(15) = Array(gottlieba016, gottliebb016, gottliebc016, gottliebd016, gottliebe016, gottliebf016, gottliebg016, gottliebh016, gottliebi016, gottliebj016, gottliebk016, gottliebl016, gottliebm016, gottliebn016)
segmentArray(16) = Array(gottlieba017, gottliebb017, gottliebc017, gottliebd017, gottliebe017, gottliebf017, gottliebg017, gottliebh017, gottliebi017, gottliebj017, gottliebk017, gottliebl017, gottliebm017, gottliebn017)
segmentArray(17) = Array(gottlieba018, gottliebb018, gottliebc018, gottliebd018, gottliebe018, gottliebf018, gottliebg018, gottliebh018, gottliebi018, gottliebj018, gottliebk018, gottliebl018, gottliebm018, gottliebn018)
segmentArray(18) = Array(gottlieba019, gottliebb019, gottliebc019, gottliebd019, gottliebe019, gottliebf019, gottliebg019, gottliebh019, gottliebi019, gottliebj019, gottliebk019, gottliebl019, gottliebm019, gottliebn019)
segmentArray(19) = Array(gottlieba020, gottliebb020, gottliebc020, gottliebd020, gottliebe020, gottliebf020, gottliebg020, gottliebh020, gottliebi020, gottliebj020, gottliebk020, gottliebl020, gottliebm020, gottliebn020)
segmentArray(20) = Array(gottlieba021, gottliebb021, gottliebc021, gottliebd021, gottliebe021, gottliebf021, gottliebg021, gottliebh021, gottliebi021, gottliebj021, gottliebk021, gottliebl021, gottliebm021, gottliebn021)
segmentArray(21) = Array(gottlieba022, gottliebb022, gottliebc022, gottliebd022, gottliebe022, gottliebf022, gottliebg022, gottliebh022, gottliebi022, gottliebj022, gottliebk022, gottliebl022, gottliebm022, gottliebn022)
segmentArray(22) = Array(gottlieba023, gottliebb023, gottliebc023, gottliebd023, gottliebe023, gottliebf023, gottliebg023, gottliebh023, gottliebi023, gottliebj023, gottliebk023, gottliebl023, gottliebm023, gottliebn023)
segmentArray(23) = Array(gottlieba024, gottliebb024, gottliebc024, gottliebd024, gottliebe024, gottliebf024, gottliebg024, gottliebh024, gottliebi024, gottliebj024, gottliebk024, gottliebl024, gottliebm024, gottliebn024)
segmentArray(24) = Array(gottlieba025, gottliebb025, gottliebc025, gottliebd025, gottliebe025, gottliebf025, gottliebg025, gottliebh025, gottliebi025, gottliebj025, gottliebk025, gottliebl025, gottliebm025, gottliebn025)
segmentArray(25) = Array(gottlieba026, gottliebb026, gottliebc026, gottliebd026, gottliebe026, gottliebf026, gottliebg026, gottliebh026, gottliebi026, gottliebj026, gottliebk026, gottliebl026, gottliebm026, gottliebn026)
segmentArray(26) = Array(gottlieba027, gottliebb027, gottliebc027, gottliebd027, gottliebe027, gottliebf027, gottliebg027, gottliebh027, gottliebi027, gottliebj027, gottliebk027, gottliebl027, gottliebm027, gottliebn027)
segmentArray(27) = Array(gottlieba028, gottliebb028, gottliebc028, gottliebd028, gottliebe028, gottliebf028, gottliebg028, gottliebh028, gottliebi028, gottliebj028, gottliebk028, gottliebl028, gottliebm028, gottliebn028)
segmentArray(28) = Array(gottlieba029, gottliebb029, gottliebc029, gottliebd029, gottliebe029, gottliebf029, gottliebg029, gottliebh029, gottliebi029, gottliebj029, gottliebk029, gottliebl029, gottliebm029, gottliebn029)
segmentArray(29) = Array(gottlieba030, gottliebb030, gottliebc030, gottliebd030, gottliebe030, gottliebf030, gottliebg030, gottliebh030, gottliebi030, gottliebj030, gottliebk030, gottliebl030, gottliebm030, gottliebn030)
segmentArray(30) = Array(gottlieba031, gottliebb031, gottliebc031, gottliebd031, gottliebe031, gottliebf031, gottliebg031, gottliebh031, gottliebi031, gottliebj031, gottliebk031, gottliebl031, gottliebm031, gottliebn031)
segmentArray(31) = Array(gottlieba032, gottliebb032, gottliebc032, gottliebd032, gottliebe032, gottliebf032, gottliebg032, gottliebh032, gottliebi032, gottliebj032, gottliebk032, gottliebl032, gottliebm032, gottliebn032)
segmentArray(32) = Array(gottlieba033, gottliebb033, gottliebc033, gottliebd033, gottliebe033, gottliebf033, gottliebg033, gottliebh033, gottliebi033, gottliebj033, gottliebk033, gottliebl033, gottliebm033, gottliebn033)
segmentArray(33) = Array(gottlieba034, gottliebb034, gottliebc034, gottliebd034, gottliebe034, gottliebf034, gottliebg034, gottliebh034, gottliebi034, gottliebj034, gottliebk034, gottliebl034, gottliebm034, gottliebn034)
segmentArray(34) = Array(gottlieba035, gottliebb035, gottliebc035, gottliebd035, gottliebe035, gottliebf035, gottliebg035, gottliebh035, gottliebi035, gottliebj035, gottliebk035, gottliebl035, gottliebm035, gottliebn035)
segmentArray(35) = Array(gottlieba036, gottliebb036, gottliebc036, gottliebd036, gottliebe036, gottliebf036, gottliebg036, gottliebh036, gottliebi036, gottliebj036, gottliebk036, gottliebl036, gottliebm036, gottliebn036)
segmentArray(36) = Array(gottlieba037, gottliebb037, gottliebc037, gottliebd037, gottliebe037, gottliebf037, gottliebg037, gottliebh037, gottliebi037, gottliebj037, gottliebk037, gottliebl037, gottliebm037, gottliebn037)
segmentArray(37) = Array(gottlieba038, gottliebb038, gottliebc038, gottliebd038, gottliebe038, gottliebf038, gottliebg038, gottliebh038, gottliebi038, gottliebj038, gottliebk038, gottliebl038, gottliebm038, gottliebn038)
segmentArray(38) = Array(gottlieba039, gottliebb039, gottliebc039, gottliebd039, gottliebe039, gottliebf039, gottliebg039, gottliebh039, gottliebi039, gottliebj039, gottliebk039, gottliebl039, gottliebm039, gottliebn039)
segmentArray(39) = Array(gottlieba040, gottliebb040, gottliebc040, gottliebd040, gottliebe040, gottliebf040, gottliebg040, gottliebh040, gottliebi040, gottliebj040, gottliebk040, gottliebl040, gottliebm040, gottliebn040)

Dim segmentStates
Set segmentStates = CreateObject("Scripting.Dictionary") ' is this really necessary?

segmentStates.Add " ", Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
segmentStates.Add ".", Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
segmentStates.Add "A", Array(1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0)
segmentStates.Add "B", Array(1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1)
segmentStates.Add "C", Array(1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)
segmentStates.Add "D", Array(1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1)
segmentStates.Add "E", Array(1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1)
segmentStates.Add "F", Array(1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0)
segmentStates.Add "G", Array(1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1)
segmentStates.Add "H", Array(0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0)
segmentStates.Add "I", Array(1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1)
segmentStates.Add "J", Array(0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1)
segmentStates.Add "K", Array(0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0)
segmentStates.Add "L", Array(0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)
segmentStates.Add "M", Array(0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0)
segmentStates.Add "N", Array(0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0)
segmentStates.Add "O", Array(1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1)
segmentStates.Add "P", Array(1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0)
segmentStates.Add "Q", Array(1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1)
segmentStates.Add "R", Array(1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0)
segmentStates.Add "S", Array(1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1)
segmentStates.Add "T", Array(1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0)
segmentStates.Add "U", Array(0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1)
segmentStates.Add "V", Array(0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0)
segmentStates.Add "W", Array(0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0)
segmentStates.Add "X", Array(0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0)
segmentStates.Add "Y", Array(0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0)
segmentStates.Add "Z", Array(1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1)
segmentStates.Add "*", Array(0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0)
segmentStates.Add "~", Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
segmentStates.Add "<", Array(0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0)
segmentStates.Add ">", Array(0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0)
segmentStates.Add "\", Array(0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0)
segmentStates.Add "/", Array(0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0)
segmentStates.Add "-", Array(0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0)
segmentStates.Add "|", Array(0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0)
segmentStates.Add "+", Array(0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0)
segmentStates.Add "1", Array(0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0)
segmentStates.Add "2", Array(1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1)
segmentStates.Add "3", Array(1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1)
segmentStates.Add "4", Array(0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0)
segmentStates.Add "5", Array(1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1)
segmentStates.Add "6", Array(1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1)
segmentStates.Add "7", Array(1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0)
segmentStates.Add "8", Array(1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1)
segmentStates.Add "9", Array(1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0)
segmentStates.Add "0", Array(1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1)
segmentStates.Add "%", Array(0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0)

							
segmentArray(49) = Array(SegmentA001, SegmentA002, SegmentA003, SegmentA004, SegmentA005, SegmentA006, SegmentA007)
segmentArray(48) = Array(SegmentB001, SegmentB002, SegmentB003, SegmentB004, SegmentB005, SegmentB006, SegmentB007)
segmentArray(47) = Array(SegmentC001, SegmentC002, SegmentC003, SegmentC004, SegmentC005, SegmentC006, SegmentC007)
segmentArray(46) = Array(SegmentD001, SegmentD002, SegmentD003, SegmentD004, SegmentD005, SegmentD006, SegmentD007)
segmentArray(45) = Array(SegmentE001, SegmentE002, SegmentE003, SegmentE004, SegmentE005, SegmentE006, SegmentE007)
segmentArray(44) = Array(SegmentF001, SegmentF002, SegmentF003, SegmentF004, SegmentF005, SegmentF006, SegmentF007)
segmentArray(43) = Array(SegmentG001, SegmentG002, SegmentG003, SegmentG004, SegmentG005, SegmentG006, SegmentG007)
segmentArray(42) = Array(SegmentH001, SegmentH002, SegmentH003, SegmentH004, SegmentH005, SegmentH006, SegmentH007)
segmentArray(41) = Array(SegmentI001, SegmentI002, SegmentI003, SegmentI004, SegmentI005, SegmentI006, SegmentI007)
segmentArray(40) = Array(SegmentJ001, SegmentJ002, SegmentJ003, SegmentJ004, SegmentJ005, SegmentJ006, SegmentJ007)

Dim ScoreStates
Set ScoreStates = CreateObject("Scripting.Dictionary") 

ScoreStates.Add " ", Array(0, 0, 0, 0, 0, 0, 0)
ScoreStates.Add "1", Array(0, 0, 1, 0, 0, 1, 0)
ScoreStates.Add "2", Array(1, 0, 1, 1, 1, 0, 1)
ScoreStates.Add "3", Array(1, 0, 1, 1, 0, 1, 1)
ScoreStates.Add "4", Array(0, 1, 1, 1, 0, 1, 0)
ScoreStates.Add "5", Array(1, 1, 0, 1, 0, 1, 1)
ScoreStates.Add "6", Array(1, 1, 0, 1, 1, 1, 1)
ScoreStates.Add "7", Array(1, 0, 1, 0, 0, 1, 0)
ScoreStates.Add "8", Array(1, 1, 1, 1, 1, 1, 1)
ScoreStates.Add "9", Array(1, 1, 1, 1, 0, 1, 1)
ScoreStates.Add "0", Array(1, 1, 1, 0, 1, 1, 1)

Sub DisplayCharacter(digitIndex, char)
    Dim states, i, segmentSum
    If segmentStates.Exists(char) Then
        states = segmentStates(char)
    Else
        states = segmentStates(" ")
    End If
    For i = 0 To UBound(segmentArray(digitIndex))
        segmentArray(digitIndex)(i).state = states(i)
    Next
	If b2sOn Then
		segmentSum = 0
		If states(0) then segmentSum = segmentSum + 1
		If states(1) then segmentSum = segmentSum + 32
		If states(2) then segmentSum = segmentSum + 256
		If states(3) then segmentSum = segmentSum + 512
		If states(4) then segmentSum = segmentSum + 1024
		If states(5) then segmentSum = segmentSum + 2
		If states(6) then segmentSum = segmentSum + 64
		If states(7) then segmentSum = segmentSum + 2048
		If states(8) then segmentSum = segmentSum + 16
		If states(9) then segmentSum = segmentSum + 16384
		If states(10) then segmentSum = segmentSum + 8192
		If states(11) then segmentSum = segmentSum + 4096
		If states(12) then segmentSum = segmentSum + 4
		If states(13) then segmentSum = segmentSum + 8
		Controller.B2SSetLED digitIndex + 1, segmentSum
	End if
End Sub

Sub DisplayNumber(digitIndex, char)
    Dim states, i, segmentSum
    If ScoreStates.Exists(char) Then
        states = ScoreStates(char)
    Else
        states = ScoreStates(" ")
    End If
    For i = 0 To 6
        segmentArray(digitIndex)(i).state = states(i)
    Next
	If b2sOn Then
		segmentSum = 0
		If states(0) then segmentSum = segmentSum + 1
		If states(1) then segmentSum = segmentSum + 32
		If states(2) then segmentSum = segmentSum + 2
		If states(3) then segmentSum = segmentSum + 64 + 2048
		If states(4) then segmentSum = segmentSum + 16
		If states(5) then segmentSum = segmentSum + 4
		If states(6) then segmentSum = segmentSum + 8
		' Handle commas in score
		If (40 = digitIndex or 43 = digitIndex or 46 = digitIndex) _
		and segmentSum > 0 Then
			segmentSum = segmentSum + 128
		End If
		Controller.B2SSetLED digitIndex + 1, segmentSum
	End if
End Sub

Dim CurrentScore : UpdateScore


Sub DisplayScore(textString)
	Dim i
	for i = 0 to 9
		DisplayNumber 40 + i, Mid(textString, i + 1, 1)
	Next
End Sub

Sub UpdateScore
	Select Case Len(CurrentScore)
		Case 0 :  DoAbsolutelyNothing
		Case 1  : DisplayScore "        " & 0 & CurrentScore
		Case 2  : DisplayScore "        "& CurrentScore
		Case 3  : DisplayScore "       "& CurrentScore
		Case 4  : DisplayScore "      "& CurrentScore
		Case 5  : DisplayScore "     "& CurrentScore
		Case 6  : DisplayScore "    "& CurrentScore
		Case 7  : DisplayScore "   "& CurrentScore
		Case 8  : DisplayScore "  "& CurrentScore
		Case 9  : DisplayScore " "& CurrentScore
		Case 10 : DisplayScore CurrentScore
	End Select
	If Len(CurrentScore)>3 Then : Comma1.State=1 : Else : Comma1.State=0 : End If
	If Len(CurrentScore)>6 Then : Comma2.State=1 : Else : Comma2.State=0 : End If
	If Len(CurrentScore)>9 Then : Comma3.State=1 : DisplayScore Right(CurrentScore,10) Else : Comma3.State=0 : End If
End Sub


Sub DisplayTop(textString)
	Dim i
	TimeoutTopIncrement=0
	CurrentMessageTop=textString
	for i = 0 to 19
		DisplayCharacter i, Mid(textString, i + 1, 1)
	Next
End Sub

Sub DisplayBottom(textString)
	Dim i
	TimeoutBottomIncrement=0
	CurrentMessageBottom=textString
	for i = 0 to 19
		DisplayCharacter 20 + i, Mid(textString, i + 1, 1)
	Next
End Sub

Dim CurrentMessageTop
Dim CurrentMessageBottom
Dim LastMessageTop
Dim LastMessageBottom
Dim TimeoutTopIncrement
Dim TimeoutBottomIncrement
Dim ParkMessageTop
Dim ParkMessageBottom

Sub DisplayTimeout_Timer
	If YouHaveFailed.enabled=1 Then Exit Sub
	TimeoutTopIncrement=TimeoutTopIncrement+1
		LastMessageTop=CurrentMessageTop
	If TimeoutTopIncrement>4 Then
		If LastMessageTop=CurrentMessageTop Then DisplayTop ""
	End If
	TimeoutBottomIncrement=TimeoutBottomIncrement+1
		LastMessageBottom=CurrentMessageBottom
	If TimeoutBottomIncrement>4 Then
		If LastMessageBottom=CurrentMessageBottom Then DisplayParkMessage
	End If
End Sub

Sub DisplayParkMessage
	If YouHaveFailed.enabled=1 Then Exit Sub
	DisplayTop ParkMessageTop
	If ParkMessageBottom = "" And CountingBonus=0 Then
		If BallsOnPlayfield=1 Then 'Only park BIP if a multiball isn't active.
			DisplayBallInPlay
		Else
			DisplayBottom ParkMessageBottom
		End If
	Else
		DisplayBottom ParkMessageBottom
	End If
End Sub

Sub BlinkBallInPlay
	Select Case BallInPlay
		Case 1 : SimpleBlinkBottom "       BALL 1       " 
		Case 2 : SimpleBlinkBottom "       BALL 2       " 
		Case 3 : SimpleBlinkBottom "       BALL 3       " 
		Case Else : DisplayBottom "" 
	End Select
End Sub

Sub DisplayBallInPlay
	Select Case BallInPlay
		Case 1 : DisplayBottom "       BALL 1       " 
		Case 2 : DisplayBottom "       BALL 2       " 
		Case 3 : DisplayBottom "       BALL 3       " 
		Case Else : DisplayBottom "" 
	End Select
End Sub


Dim ScrollFromTopLeftText
Dim ScrollFromTopLeftIncrement

Sub ScrollFromTopLeft(textString)
	ScrollFromTopLeftText=textString
	ScrollFromTopRightIncrement=99999
	ScrollFromTopCenterIncrement=99999
	SimpleBlinkTopIncrement=99999
	ScrollFromTopLeftIncrement=0
	ScrollFromTopLeftTimer.Enabled=1
End Sub

Dim ScrollFromBottomLeftText
Dim ScrollFromBottomLeftIncrement

Sub ScrollFromBottomLeft(textString)
	ScrollFromBottomLeftText=textString
	ScrollFromBottomRightIncrement=99999
	ScrollFromBottomCenterIncrement=99999
	SimpleBlinkBottomIncrement=99999
	ScrollFromBottomLeftIncrement=0
	ScrollFromBottomLeftTimer.Enabled=1
End Sub

Dim ScrollFromTopRightText
Dim ScrollFromTopRightIncrement

Sub ScrollFromTopRight(textString)
	ScrollFromTopRightText=textString
	ScrollFromTopLeftIncrement=99999
	ScrollFromTopCenterIncrement=99999
	SimpleBlinkTopIncrement=99999
	ScrollFromTopRightIncrement=0
	ScrollFromTopRightTimer.Enabled=1
End Sub

Dim ScrollFromBottomRightText
Dim ScrollFromBottomRightIncrement

Sub ScrollFromBottomRight(textString)
	ScrollFromBottomRightText=textString
	ScrollFromBottomLeftIncrement=99999
	ScrollFromBottomCenterIncrement=99999
	SimpleBlinkBottomIncrement=99999
	ScrollFromBottomRightIncrement=0
	ScrollFromBottomRightTimer.Enabled=1
End Sub

Dim ScrollFromTopCenterText
Dim ScrollFromTopCenterIncrement

Sub ScrollFromTopCenter(textString)
	ScrollFromTopCenterText=textString
	ScrollFromTopLeftIncrement=99999
	ScrollFromTopRightIncrement=99999
	SimpleBlinkTopIncrement=99999
	ScrollFromTopCenterIncrement=0
	ScrollFromTopCenterTimer.Enabled=1
End Sub

Dim ScrollFromBottomCenterText
Dim ScrollFromBottomCenterIncrement

Sub ScrollFromBottomCenter(textString)
	ScrollFromBottomCenterText=textString
	ScrollFromBottomRightIncrement=99999
	ScrollFromBottomLeftIncrement=99999
	SimpleBlinkBottomIncrement=99999
	ScrollFromBottomCenterIncrement=0
	ScrollFromBottomCenterTimer.Enabled=1
End Sub

Dim SimpleBlinkTopText
Dim SimpleBlinkTopIncrement

Sub SimpleBlinkTop(textString)
	SimpleBlinkTopText=textString
	ScrollFromTopLeftIncrement=99999
	ScrollFromTopRightIncrement=99999
	ScrollFromTopCenterIncrement=99999
	SimpleBlinkTopIncrement=0
	SimpleBlinkTopTimer.Enabled=1
End Sub

Dim SimpleBlinkBottomText
Dim SimpleBlinkBottomIncrement

Sub SimpleBlinkBottom(textString)
	SimpleBlinkBottomText=textString
	ScrollFromBottomLeftIncrement=99999
	ScrollFromBottomRightIncrement=99999
	ScrollFromBottomCenterIncrement=99999
	SimpleBlinkBottomIncrement=0
	SimpleBlinkBottomTimer.Enabled=1
End Sub

Sub ScrollFromTopLeftTimer_Timer
Select Case ScrollFromTopLeftIncrement
	Case 0 : DisplayTop Mid(ScrollFromTopLeftText,20,1)   & "                   "
	Case 1 : DisplayTop Mid(ScrollFromTopLeftText,19,2)   & "                  "
	Case 2 : DisplayTop Mid(ScrollFromTopLeftText,18,3)   & "                 "
	Case 3 : DisplayTop Mid(ScrollFromTopLeftText,17,4)   & "                "
	Case 4 : DisplayTop Mid(ScrollFromTopLeftText,16,5)   & "               "
	Case 5 : DisplayTop Mid(ScrollFromTopLeftText,15,6)   & "              "
	Case 6 : DisplayTop Mid(ScrollFromTopLeftText,14,7)   & "             "
	Case 7 : DisplayTop Mid(ScrollFromTopLeftText,13,8)   & "            "
	Case 8 : DisplayTop Mid(ScrollFromTopLeftText,12,9)   & "           "
	Case 9 : DisplayTop Mid(ScrollFromTopLeftText,11,10)  & "          "
	Case 10 : DisplayTop Mid(ScrollFromTopLeftText,10,11) & "         "
	Case 11 : DisplayTop Mid(ScrollFromTopLeftText,9,12)  & "        "
	Case 12 : DisplayTop Mid(ScrollFromTopLeftText,8,13)  & "       "
	Case 13 : DisplayTop Mid(ScrollFromTopLeftText,7,14)  & "      "
	Case 14 : DisplayTop Mid(ScrollFromTopLeftText,6,15)  & "     "
	Case 15 : DisplayTop Mid(ScrollFromTopLeftText,5,16)  & "    "
	Case 16 : DisplayTop Mid(ScrollFromTopLeftText,4,17)  & "   "
	Case 17 : DisplayTop Mid(ScrollFromTopLeftText,3,18)  & "  "
	Case 18 : DisplayTop Mid(ScrollFromTopLeftText,2,19)  & " "
	Case 19 : DisplayTop ScrollFromTopLeftText
'	Case 269 : DisplayTop " " & Mid(ScrollFromTopLeftText,1,19)
'	Case 270 : DisplayTop "  " & Mid(ScrollFromTopLeftText,1,18)
'	Case 271 : DisplayTop "   " & Mid(ScrollFromTopLeftText,1,17)
'	Case 272 : DisplayTop "    " & Mid(ScrollFromTopLeftText,1,16)
'	Case 273 : DisplayTop "     " & Mid(ScrollFromTopLeftText,1,15)
'	Case 274 : DisplayTop "      " & Mid(ScrollFromTopLeftText,1,14)
'	Case 275 : DisplayTop "       " & Mid(ScrollFromTopLeftText,1,13)
'	Case 276 : DisplayTop "        " & Mid(ScrollFromTopLeftText,1,12)
'	Case 277 : DisplayTop "         " & Mid(ScrollFromTopLeftText,1,11)
'	Case 278 : DisplayTop  "          " & Mid(ScrollFromTopLeftText,1,10)
'	Case 279 : DisplayTop  "           " & Mid(ScrollFromTopLeftText,1,9)
'	Case 280 : DisplayTop  "            " & Mid(ScrollFromTopLeftText,1,8)
'	Case 281 : DisplayTop  "             " & Mid(ScrollFromTopLeftText,1,7)
'	Case 282 : DisplayTop  "              " & Mid(ScrollFromTopLeftText,1,6)
'	Case 283 : DisplayTop  "               " & Mid(ScrollFromTopLeftText,1,5)
'	Case 284 : DisplayTop  "                " & Mid(ScrollFromTopLeftText,1,4)
'	Case 285 : DisplayTop  "                 " & Mid(ScrollFromTopLeftText,1,3)
'	Case 286 : DisplayTop  "                  " & Mid(ScrollFromTopLeftText,1,2)
'	Case 287 : DisplayTop  "                   " & Mid(ScrollFromTopLeftText,1,1)
'	Case 288 : DisplayTop  ""
End Select
If ScrollFromTopLeftIncrement>288 Then ScrollFromTopLeftTimer.Enabled=0
ScrollFromTopLeftIncrement=ScrollFromTopLeftIncrement+1
End Sub

Sub ScrollFromBottomLeftTimer_Timer
Select Case ScrollFromBottomLeftIncrement
	Case 0 : DisplayBottom Mid(ScrollFromBottomLeftText,20,1)   & "                   "
	Case 1 : DisplayBottom Mid(ScrollFromBottomLeftText,19,2)   & "                  "
	Case 2 : DisplayBottom Mid(ScrollFromBottomLeftText,18,3)   & "                 "
	Case 3 : DisplayBottom Mid(ScrollFromBottomLeftText,17,4)   & "                "
	Case 4 : DisplayBottom Mid(ScrollFromBottomLeftText,16,5)   & "               "
	Case 5 : DisplayBottom Mid(ScrollFromBottomLeftText,15,6)   & "              "
	Case 6 : DisplayBottom Mid(ScrollFromBottomLeftText,14,7)   & "             "
	Case 7 : DisplayBottom Mid(ScrollFromBottomLeftText,13,8)   & "            "
	Case 8 : DisplayBottom Mid(ScrollFromBottomLeftText,12,9)   & "           "
	Case 9 : DisplayBottom Mid(ScrollFromBottomLeftText,11,10)  & "          "
	Case 10 : DisplayBottom Mid(ScrollFromBottomLeftText,10,11) & "         "
	Case 11 : DisplayBottom Mid(ScrollFromBottomLeftText,9,12)  & "        "
	Case 12 : DisplayBottom Mid(ScrollFromBottomLeftText,8,13)  & "       "
	Case 13 : DisplayBottom Mid(ScrollFromBottomLeftText,7,14)  & "      "
	Case 14 : DisplayBottom Mid(ScrollFromBottomLeftText,6,15)  & "     "
	Case 15 : DisplayBottom Mid(ScrollFromBottomLeftText,5,16)  & "    "
	Case 16 : DisplayBottom Mid(ScrollFromBottomLeftText,4,17)  & "   "
	Case 17 : DisplayBottom Mid(ScrollFromBottomLeftText,3,18)  & "  "
	Case 18 : DisplayBottom Mid(ScrollFromBottomLeftText,2,19)  & " "
	Case 19 : DisplayBottom ScrollFromBottomLeftText
'	Case 269 : DisplayBottom " " & Mid(ScrollFromBottomLeftText,1,19)
'	Case 270 : DisplayBottom "  " & Mid(ScrollFromBottomLeftText,1,18)
'	Case 271 : DisplayBottom "   " & Mid(ScrollFromBottomLeftText,1,17)
'	Case 272 : DisplayBottom "    " & Mid(ScrollFromBottomLeftText,1,16)
'	Case 273 : DisplayBottom "     " & Mid(ScrollFromBottomLeftText,1,15)
'	Case 274 : DisplayBottom "      " & Mid(ScrollFromBottomLeftText,1,14)
'	Case 275 : DisplayBottom "       " & Mid(ScrollFromBottomLeftText,1,13)
'	Case 276 : DisplayBottom "        " & Mid(ScrollFromBottomLeftText,1,12)
'	Case 277 : DisplayBottom "         " & Mid(ScrollFromBottomLeftText,1,11)
'	Case 278 : DisplayBottom  "          " & Mid(ScrollFromBottomLeftText,1,10)
'	Case 279 : DisplayBottom  "           " & Mid(ScrollFromBottomLeftText,1,9)
'	Case 280 : DisplayBottom  "            " & Mid(ScrollFromBottomLeftText,1,8)
'	Case 281 : DisplayBottom  "             " & Mid(ScrollFromBottomLeftText,1,7)
'	Case 282 : DisplayBottom  "              " & Mid(ScrollFromBottomLeftText,1,6)
'	Case 283 : DisplayBottom  "               " & Mid(ScrollFromBottomLeftText,1,5)
'	Case 284 : DisplayBottom  "                " & Mid(ScrollFromBottomLeftText,1,4)
'	Case 285 : DisplayBottom  "                 " & Mid(ScrollFromBottomLeftText,1,3)
'	Case 286 : DisplayBottom  "                  " & Mid(ScrollFromBottomLeftText,1,2)
'	Case 287 : DisplayBottom  "                   " & Mid(ScrollFromBottomLeftText,1,1)
'	Case 288 : DisplayBottom  ""
End Select
If ScrollFromBottomLeftIncrement>288 Then ScrollFromBottomLeftTimer.Enabled=0
ScrollFromBottomLeftIncrement=ScrollFromBottomLeftIncrement+1
End Sub

Sub ScrollFromTopRightTimer_Timer
Select Case ScrollFromTopRightIncrement
	Case 0 : DisplayTop  "                   " & Mid(ScrollFromTopRightText,1,1)
	Case 1 : DisplayTop  "                  " & Mid(ScrollFromTopRightText,1,2)
	Case 2 : DisplayTop  "                 " & Mid(ScrollFromTopRightText,1,3)
	Case 3 : DisplayTop  "                " & Mid(ScrollFromTopRightText,1,4)
	Case 4 : DisplayTop  "               " & Mid(ScrollFromTopRightText,1,5)
	Case 5 : DisplayTop  "              " & Mid(ScrollFromTopRightText,1,6)
	Case 6 : DisplayTop  "             " & Mid(ScrollFromTopRightText,1,7)
	Case 7 : DisplayTop  "            " & Mid(ScrollFromTopRightText,1,8)
	Case 8 : DisplayTop  "           " & Mid(ScrollFromTopRightText,1,9)
	Case 9 : DisplayTop  "          " & Mid(ScrollFromTopRightText,1,10)
	Case 10 : DisplayTop "         " & Mid(ScrollFromTopRightText,1,11)
	Case 11 : DisplayTop "        " & Mid(ScrollFromTopRightText,1,12)
	Case 12 : DisplayTop "       " & Mid(ScrollFromTopRightText,1,13)
	Case 13 : DisplayTop "      " & Mid(ScrollFromTopRightText,1,14)
	Case 14 : DisplayTop "     " & Mid(ScrollFromTopRightText,1,15)
	Case 15 : DisplayTop "    " & Mid(ScrollFromTopRightText,1,16)
	Case 16 : DisplayTop "   " & Mid(ScrollFromTopRightText,1,17)
	Case 17 : DisplayTop "  " & Mid(ScrollFromTopRightText,1,18)
	Case 18 : DisplayTop " " & Mid(ScrollFromTopRightText,1,19)
	Case 19 : DisplayTop ScrollFromTopRightText
'	Case 269 : DisplayTop Mid(ScrollFromTopRightText,2,19)  & " "
'	Case 270 : DisplayTop Mid(ScrollFromTopRightText,3,18)  & "  "
'	Case 271 : DisplayTop Mid(ScrollFromTopRightText,4,17)  & "   "
'	Case 272 : DisplayTop Mid(ScrollFromTopRightText,5,16)  & "    "
'	Case 273 : DisplayTop Mid(ScrollFromTopRightText,6,15)  & "     "
'	Case 274 : DisplayTop Mid(ScrollFromTopRightText,7,14)  & "      "
'	Case 275 : DisplayTop Mid(ScrollFromTopRightText,8,13)  & "       "
'	Case 276 : DisplayTop Mid(ScrollFromTopRightText,9,12)  & "        "
'	Case 277 : DisplayTop Mid(ScrollFromTopRightText,10,11) & "         "
'	Case 278 : DisplayTop Mid(ScrollFromTopRightText,11,10)  & "          "
'	Case 279 : DisplayTop Mid(ScrollFromTopRightText,12,9)   & "           "
'	Case 280 : DisplayTop Mid(ScrollFromTopRightText,13,8)   & "            "
'	Case 281 : DisplayTop Mid(ScrollFromTopRightText,14,7)   & "             "
'	Case 282 : DisplayTop Mid(ScrollFromTopRightText,15,6)   & "              "
'	Case 283 : DisplayTop Mid(ScrollFromTopRightText,16,5)   & "               "
'	Case 284 : DisplayTop Mid(ScrollFromTopRightText,17,4)   & "                "
'	Case 285 : DisplayTop Mid(ScrollFromTopRightText,18,3)   & "                 "
'	Case 286 : DisplayTop Mid(ScrollFromTopRightText,19,2)   & "                  "
'	Case 287 : DisplayTop Mid(ScrollFromTopRightText,20,1)   & "                   "
'	Case 288 : DisplayTop ""
End Select
If ScrollFromTopRightIncrement>288 Then ScrollFromTopRightTimer.Enabled=0
ScrollFromTopRightIncrement=ScrollFromTopRightIncrement+1
End Sub

Sub ScrollFromBottomRightTimer_Timer
Select Case ScrollFromBottomRightIncrement
	Case 0 : DisplayBottom  "                   " & Mid(ScrollFromBottomRightText,1,1)
	Case 1 : DisplayBottom  "                  " & Mid(ScrollFromBottomRightText,1,2)
	Case 2 : DisplayBottom  "                 " & Mid(ScrollFromBottomRightText,1,3)
	Case 3 : DisplayBottom  "                " & Mid(ScrollFromBottomRightText,1,4)
	Case 4 : DisplayBottom  "               " & Mid(ScrollFromBottomRightText,1,5)
	Case 5 : DisplayBottom  "              " & Mid(ScrollFromBottomRightText,1,6)
	Case 6 : DisplayBottom  "             " & Mid(ScrollFromBottomRightText,1,7)
	Case 7 : DisplayBottom  "            " & Mid(ScrollFromBottomRightText,1,8)
	Case 8 : DisplayBottom  "           " & Mid(ScrollFromBottomRightText,1,9)
	Case 9 : DisplayBottom  "          " & Mid(ScrollFromBottomRightText,1,10)
	Case 10 : DisplayBottom "         " & Mid(ScrollFromBottomRightText,1,11)
	Case 11 : DisplayBottom "        " & Mid(ScrollFromBottomRightText,1,12)
	Case 12 : DisplayBottom "       " & Mid(ScrollFromBottomRightText,1,13)
	Case 13 : DisplayBottom "      " & Mid(ScrollFromBottomRightText,1,14)
	Case 14 : DisplayBottom "     " & Mid(ScrollFromBottomRightText,1,15)
	Case 15 : DisplayBottom "    " & Mid(ScrollFromBottomRightText,1,16)
	Case 16 : DisplayBottom "   " & Mid(ScrollFromBottomRightText,1,17)
	Case 17 : DisplayBottom "  " & Mid(ScrollFromBottomRightText,1,18)
	Case 18 : DisplayBottom " " & Mid(ScrollFromBottomRightText,1,19)
	Case 19 : DisplayBottom ScrollFromBottomRightText
'	Case 269 : DisplayBottom Mid(ScrollFromBottomRightText,2,19)  & " "
'	Case 270 : DisplayBottom Mid(ScrollFromBottomRightText,3,18)  & "  "
'	Case 271 : DisplayBottom Mid(ScrollFromBottomRightText,4,17)  & "   "
'	Case 272 : DisplayBottom Mid(ScrollFromBottomRightText,5,16)  & "    "
'	Case 273 : DisplayBottom Mid(ScrollFromBottomRightText,6,15)  & "     "
'	Case 274 : DisplayBottom Mid(ScrollFromBottomRightText,7,14)  & "      "
'	Case 275 : DisplayBottom Mid(ScrollFromBottomRightText,8,13)  & "       "
'	Case 276 : DisplayBottom Mid(ScrollFromBottomRightText,9,12)  & "        "
'	Case 277 : DisplayBottom Mid(ScrollFromBottomRightText,10,11) & "         "
'	Case 278 : DisplayBottom Mid(ScrollFromBottomRightText,11,10)  & "          "
'	Case 279 : DisplayBottom Mid(ScrollFromBottomRightText,12,9)   & "           "
'	Case 280 : DisplayBottom Mid(ScrollFromBottomRightText,13,8)   & "            "
'	Case 281 : DisplayBottom Mid(ScrollFromBottomRightText,14,7)   & "             "
'	Case 282 : DisplayBottom Mid(ScrollFromBottomRightText,15,6)   & "              "
'	Case 283 : DisplayBottom Mid(ScrollFromBottomRightText,16,5)   & "               "
'	Case 284 : DisplayBottom Mid(ScrollFromBottomRightText,17,4)   & "                "
'	Case 285 : DisplayBottom Mid(ScrollFromBottomRightText,18,3)   & "                 "
'	Case 286 : DisplayBottom Mid(ScrollFromBottomRightText,19,2)   & "                  "
'	Case 287 : DisplayBottom Mid(ScrollFromBottomRightText,20,1)   & "                   "
'	Case 288 : DisplayBottom ""
End Select
If ScrollFromBottomRightIncrement>288 Then ScrollFromBottomRightTimer.Enabled=0
ScrollFromBottomRightIncrement=ScrollFromBottomRightIncrement+1
End Sub

Sub ScrollFromTopCenterTimer_Timer
Select Case ScrollFromTopCenterIncrement
	Case 0 : DisplayTop  "         " & Mid(ScrollFromTopCenterText,10,2) & "         "
	Case 1 : DisplayTop  "        " & Mid(ScrollFromTopCenterText,9,4) & "        "
	Case 2 : DisplayTop  "       " & Mid(ScrollFromTopCenterText,8,6) & "       "
	Case 3 : DisplayTop  "      " & Mid(ScrollFromTopCenterText,7,8) & "      "
	Case 4 : DisplayTop  "     " & Mid(ScrollFromTopCenterText,6,10) & "     "
	Case 5 : DisplayTop  "    " & Mid(ScrollFromTopCenterText,5,12) & "    "
	Case 6 : DisplayTop  "   " & Mid(ScrollFromTopCenterText,4,14) & "   "
	Case 7 : DisplayTop  "  " & Mid(ScrollFromTopCenterText,3,16) & "  "
	Case 8 : DisplayTop  " " & Mid(ScrollFromTopCenterText,2,18) & " "
End Select
If ScrollFromTopCenterIncrement=9 Then DisplayTop  ScrollFromTopCenterText
If ScrollFromTopCenterIncrement>29 Then ScrollFromTopCenterTimer.Enabled=0
ScrollFromTopCenterIncrement=ScrollFromTopCenterIncrement+1
End Sub

Sub ScrollFromBottomCenterTimer_Timer
Select Case ScrollFromBottomCenterIncrement
	Case 0 : DisplayBottom  "         " & Mid(ScrollFromBottomCenterText,10,2) & "         "
	Case 1 : DisplayBottom  "        " & Mid(ScrollFromBottomCenterText,9,4) & "        "
	Case 2 : DisplayBottom  "       " & Mid(ScrollFromBottomCenterText,8,6) & "       "
	Case 3 : DisplayBottom  "      " & Mid(ScrollFromBottomCenterText,7,8) & "      "
	Case 4 : DisplayBottom  "     " & Mid(ScrollFromBottomCenterText,6,10) & "     "
	Case 5 : DisplayBottom  "    " & Mid(ScrollFromBottomCenterText,5,12) & "    "
	Case 6 : DisplayBottom  "   " & Mid(ScrollFromBottomCenterText,4,14) & "   "
	Case 7 : DisplayBottom  "  " & Mid(ScrollFromBottomCenterText,3,16) & "  "
	Case 8 : DisplayBottom  " " & Mid(ScrollFromBottomCenterText,2,18) & " "
End Select
If ScrollFromBottomCenterIncrement=9 Then DisplayBottom  ScrollFromBottomCenterText
If ScrollFromBottomCenterIncrement>29 Then ScrollFromBottomCenterTimer.Enabled=0
ScrollFromBottomCenterIncrement=ScrollFromBottomCenterIncrement+1
End Sub

Sub SimpleBlinkTopTimer_Timer
Select Case SimpleBlinkTopIncrement
	Case 0 : DisplayTop SimpleBlinkTopText
	Case 1 : DisplayTop ""
	Case 2 : DisplayTop SimpleBlinkTopText
	Case 3 : DisplayTop ""
	Case 4 : DisplayTop SimpleBlinkTopText
	Case 5 : DisplayTop ""
	Case 6 : DisplayTop SimpleBlinkTopText
'	Case 47 : DisplayTop ""
'	Case 48 : DisplayTop SimpleBlinkTopText
'	Case 49 : DisplayTop ""
'	Case 50 : DisplayTop SimpleBlinkTopText
'	Case 51 : DisplayTop ""
'	Case 52 : DisplayTop SimpleBlinkTopText
'	Case 53 : DisplayTop ""
End Select
If SimpleBlinkTopIncrement>53 Then SimpleBlinkTopTimer.Enabled=0
SimpleBlinkTopIncrement=SimpleBlinkTopIncrement+1
End Sub

Sub SimpleBlinkBottomTimer_Timer
Select Case SimpleBlinkBottomIncrement
	Case 0 : DisplayBottom SimpleBlinkBottomText
	Case 1 : DisplayBottom ""
	Case 2 : DisplayBottom SimpleBlinkBottomText
	Case 3 : DisplayBottom ""
	Case 4 : DisplayBottom SimpleBlinkBottomText
	Case 5 : DisplayBottom ""
	Case 6 : DisplayBottom SimpleBlinkBottomText
'	Case 47 : DisplayBottom ""
'	Case 48 : DisplayBottom SimpleBlinkBottomText
'	Case 49 : DisplayBottom ""
'	Case 50 : DisplayBottom SimpleBlinkBottomText
'	Case 51 : DisplayBottom ""
'	Case 52 : DisplayBottom SimpleBlinkBottomText
'	Case 53 : DisplayBottom ""
End Select
If SimpleBlinkBottomIncrement>53 Then SimpleBlinkBottomTimer.Enabled=0
SimpleBlinkBottomIncrement=SimpleBlinkBottomIncrement+1
End Sub

Sub DisplayANumber (ValueToDisplay)
	Select Case Len(ValueToDisplay)
		Case 0 :  DoAbsolutelyNothing
		Case 1 : DisplayBottom "             " & ValueToDisplay
		Case 2 : DisplayBottom "            " & ValueToDisplay
		Case 3 : DisplayBottom "           " & ValueToDisplay
		Case 4 : DisplayBottom "          " & ValueToDisplay
		Case 5 : DisplayBottom "         " & ValueToDisplay
		Case 6 : DisplayBottom "        " & ValueToDisplay
		Case 7 : DisplayBottom "        " & ValueToDisplay
		Case 8 : DisplayBottom "       " & ValueToDisplay
		Case 9 : DisplayBottom "      " & ValueToDisplay
		Case 10 : DisplayBottom "      "& ValueToDisplay
		Case 11 : DisplayBottom "     "& ValueToDisplay
		Case 12 : DisplayBottom "    "& ValueToDisplay
		Case 13 : DisplayBottom "   "& ValueToDisplay
		Case 14 : DisplayBottom "  "& ValueToDisplay
		Case 15 : DisplayBottom " "& ValueToDisplay
		Case Else  : DisplayBottom ValueToDisplay
	End Select
End Sub

Sub BlinkANumber (ValueToDisplay)
	Select Case Len(ValueToDisplay)
		Case 0 :  DoAbsolutelyNothing
		Case 1 : SimpleBlinkBottom "             " & ValueToDisplay
		Case 2 : SimpleBlinkBottom "            " & ValueToDisplay
		Case 3 : SimpleBlinkBottom "           " & ValueToDisplay
		Case 4 : SimpleBlinkBottom "          " & ValueToDisplay
		Case 5 : SimpleBlinkBottom "         " & ValueToDisplay
		Case 6 : SimpleBlinkBottom "        " & ValueToDisplay
		Case 7 : SimpleBlinkBottom "        " & ValueToDisplay
		Case 8 : SimpleBlinkBottom "       " & ValueToDisplay
		Case 9 : SimpleBlinkBottom "      " & ValueToDisplay
		Case 10 : SimpleBlinkBottom "      "& ValueToDisplay
		Case 11 : SimpleBlinkBottom "     "& ValueToDisplay
		Case 12 : SimpleBlinkBottom "    "& ValueToDisplay
		Case 13 : SimpleBlinkBottom "   "& ValueToDisplay
		Case 14 : SimpleBlinkBottom "  "& ValueToDisplay
		Case 15 : SimpleBlinkBottom " "& ValueToDisplay
		Case Else  : SimpleBlinkBottom ValueToDisplay
	End Select
End Sub


'================================
'§ Ball Control / Rolling Sound §
'================================


Dim BCup, BCdown, BCleft, BCright
Dim ControlBallInPlay, ControlActiveBall
Dim BCvel, BCyveloffset, BCboostmulti, BCboost

BCboost = 1				'Do Not Change - default setting
BCvel = 4				'Controls the speed of the ball movement
BCyveloffset = -0.01 	'Offsets the force of gravity to keep the ball from drifting vertically on the table, should be negative
BCboostmulti = 3		'Boost multiplier to ball veloctiy (toggled with the B key) 

ControlBallInPlay = false

Sub StartBallControl_Hit()
	Set ControlActiveBall = ActiveBall
	ControlBallInPlay = true
End Sub

Sub StopBallControl_Hit()
	ControlBallInPlay = false
	If BallsOnPlayfield<5 And BossBattle=0 And WizardMode=0 And YouHaveFailed.enabled=0 And BallSave=1 Then
		BallSave=0
		Kicker001.CreateBall
		PlaySoundAt "fx_kicker",Kicker001
		Kicker001.Kick 0,40
		If BallsOnPlayfield = 1 Then SimpleBlinkTop "      BALL SAVE     "
		PlaySound "sega_extraball", 0 , DigitalSoundsLevel
		BallsOnPlayfield = BallsOnPlayfield+1
	End If
End Sub	


Dim BallShadow
BallShadow = Array (BallShadow1,BallShadow2,BallShadow3,BallShadow4,BallShadow5,BallShadow6)

Sub BallShadowUpdate_timer()
	If EnableBallControl and ControlBallInPlay then
		If BCright = 1 Then
			ControlActiveBall.velx =  BCvel*BCboost
		ElseIf BCleft = 1 Then
			ControlActiveBall.velx = -BCvel*BCboost
		Else
			ControlActiveBall.velx = 0
		End If

		If BCup = 1 Then
			ControlActiveBall.vely = -BCvel*BCboost
		ElseIf BCdown = 1 Then
			ControlActiveBall.vely =  BCvel*BCboost
		Else
			ControlActiveBall.vely = bcyveloffset
		End If
	End If

    Dim BOT, b
    BOT = GetBalls
    ' hide shadow of deleted balls
    If UBound(BOT)<(tnob-1) Then
        For b = (UBound(BOT) + 1) to (tnob-1)
            BallShadow(b).visible = 0
        Next
    End If
    ' exit the Sub if no balls on the table
    If UBound(BOT) = -1 Then Exit Sub
    ' render the shadow for each ball
    For b = 0 to (UBound(BOT))
        If BOT(b).X < Table1.Width/2 Then
            BallShadow(b).X = ((BOT(b).X) - (Ballsize/6) + ((BOT(b).X - (Table1.Width/2))/7)) + 6
        Else
            BallShadow(b).X = ((BOT(b).X) + (Ballsize/6) + ((BOT(b).X - (Table1.Width/2))/7)) - 6
        End If
        ballShadow(b).Y = BOT(b).Y + 12
        If BOT(b).Z > 20 Then
            BallShadow(b).visible = 1
        Else
            BallShadow(b).visible = 0
        End If
    Next
End Sub

Sub PlayXYSound(soundname, tableobj, loopcount, volume, randompitch, pitch, useexisting, restart)
	PlaySound soundname, loopcount, volume, AudioPan(tableobj), randompitch, pitch, useexisting, restart, AudioFade(tableobj)
End Sub


Sub PlaySoundAt(soundname, tableobj)
    PlaySound soundname, 1, 1, AudioPan(tableobj), 0,0,0, 1, AudioFade(tableobj)
End Sub

Sub PlaySoundAtBall(soundname)
    PlaySoundAt soundname, ActiveBall
End Sub

Sub PlaySoundAtLevelStatic(playsoundparams, aVol, tableobj)
	PlaySound playsoundparams, 0, min(aVol,1), AudioPan(tableobj), 0, 0, 0, 0, AudioFade(tableobj)
End Sub


Const BallBouncePlayfieldSoftFactor = 0.025
Const BallBouncePlayfieldHardFactor = 0.025

Sub RandomSoundBallBouncePlayfieldHard(aBall)
	PlaySoundAtLevelStatic ("Ball_Bounce_Playfield_Hard_" & Int(Rnd * 7) + 1), volz(aBall) * BallBouncePlayfieldHardFactor, aBall
End Sub

Sub RandomSoundBallBouncePlayfieldSoft(aBall)
	Select Case Int(Rnd * 9) + 1
		Case 1
			PlaySoundAtLevelStatic ("Ball_Bounce_Playfield_Soft_1"), volz(aBall) * BallBouncePlayfieldSoftFactor, aBall
		Case 2
			PlaySoundAtLevelStatic ("Ball_Bounce_Playfield_Soft_2"), volz(aBall) * BallBouncePlayfieldSoftFactor * 0.5, aBall
		Case 3
			PlaySoundAtLevelStatic ("Ball_Bounce_Playfield_Soft_3"), volz(aBall) * BallBouncePlayfieldSoftFactor * 0.8, aBall
		Case 4
			PlaySoundAtLevelStatic ("Ball_Bounce_Playfield_Soft_4"), volz(aBall) * BallBouncePlayfieldSoftFactor * 0.5, aBall
		Case 5
			PlaySoundAtLevelStatic ("Ball_Bounce_Playfield_Soft_5"), volz(aBall) * BallBouncePlayfieldSoftFactor, aBall
		Case 6
			PlaySoundAtLevelStatic ("Ball_Bounce_Playfield_Hard_1"), volz(aBall) * BallBouncePlayfieldSoftFactor * 0.2, aBall
		Case 7
			PlaySoundAtLevelStatic ("Ball_Bounce_Playfield_Hard_2"), volz(aBall) * BallBouncePlayfieldSoftFactor * 0.2, aBall
		Case 8
			PlaySoundAtLevelStatic ("Ball_Bounce_Playfield_Hard_5"), volz(aBall) * BallBouncePlayfieldSoftFactor * 0.2, aBall
		Case 9
			PlaySoundAtLevelStatic ("Ball_Bounce_Playfield_Hard_7"), volz(aBall) * BallBouncePlayfieldSoftFactor * 0.3, aBall
	End Select
End Sub

Function AudioFade(tableobj) ' Fades between front and back of the table (for surround systems or 2x2 speakers, etc), depending on the Y position on the table. "table1" is the name of the table
	Dim tmp
	tmp = tableobj.y * 2 / tableheight - 1
	
	If tmp > 7000 Then
		tmp = 7000
	ElseIf tmp <  - 7000 Then
		tmp =  - 7000
	End If
	
	If tmp > 0 Then
		AudioFade = CSng(tmp ^ 10)
	Else
		AudioFade = CSng( - (( - tmp) ^ 10) )
	End If
End Function

Function AudioPan(tableobj) ' Calculates the pan for a tableobj based on the X position on the table. "table1" is the name of the table
	Dim tmp
	tmp = tableobj.x * 2 / tablewidth - 1
	
	If tmp > 7000 Then
		tmp = 7000
	ElseIf tmp <  - 7000 Then
		tmp =  - 7000
	End If
	
	If tmp > 0 Then
		AudioPan = CSng(tmp ^ 10)
	Else
		AudioPan = CSng( - (( - tmp) ^ 10) )
	End If
End Function

Function Vol(ball) ' Calculates the volume of the sound based on the ball speed
	Vol = CSng(BallVel(ball) ^ 2)
End Function

Function Volz(ball) ' Calculates the volume of the sound based on the ball speed
	Volz = CSng((ball.velz) ^ 2)
End Function

Function Pitch(ball) ' Calculates the pitch of the sound based on the ball speed
	Pitch = BallVel(ball) * 20
End Function

Function BallVel(ball) 'Calculates the ball speed
	BallVel = Int(Sqr((ball.VelX ^ 2) + (ball.VelY ^ 2) ) )
End Function

Function VolPlayfieldRoll(ball) ' Calculates the roll volume of the sound based on the ball speed
	VolPlayfieldRoll = 0.2 * 0.0005 * CSng(BallVel(ball) ^ 3)
End Function

Function PitchPlayfieldRoll(ball) ' Calculates the roll pitch of the sound based on the ball speed
	PitchPlayfieldRoll = BallVel(ball) ^ 2 * 15
End Function

Function RndInt(min, max) ' Sets a random number integer between min and max
	RndInt = Int(Rnd() * (max - min + 1) + min)
End Function

Function RndNum(min, max) ' Sets a random number between min and max
	RndNum = Rnd() * (max - min) + min
End Function



Const tnob = 5 ' total number of balls

Dim DropCount
ReDim DropCount(tnob)

ReDim rolling(tnob)
InitRolling

Sub InitRolling
    Dim i
    For i = 0 to tnob
        rolling(i) = False
    Next
End Sub

Sub RollingTimer_Timer()

	'Trying to correct the behavior of the scoop by adding this here
		Select Case StagedBalls
		Case 0
			AutoKicker.Enabled=0
		Case Else
			AutoKicker.Enabled=1
		End Select

	'End :P

    Dim BOT, b, ballpitch, ballvol
    BOT = GetBalls

    ' stop the sound of deleted balls and hide the shadow
    For b = UBound(BOT) + 1 to tnob
        rolling(b) = False
        StopSound("BallRoll_" & b)
    Next

    ' exit the sub if no balls on the table

Dim UseThisSound
Dim DoNotUseThisSound

    ' play the rolling sound for each ball and draw the shadow
    For b = 0 to UBound(BOT)
        If BallVel(BOT(b)) > 1 Then
            If BOT(b).z < 30 Then
                ballpitch = Pitch(BOT(b))
                ballvol = Vol(BOT(b))
				UseThisSound = "BallRoll_"
				DoNotUseThisSound = "wireloop"
            Else
                ballpitch = Pitch(BOT(b)) + 50000 'increase the pitch on a ramp
                ballvol = Min(Vol(BOT(b))/10,0.0075)
				DoNotUseThisSound = "BallRoll_"
				UseThisSound = "wireloop"
            End If
            rolling(b) = True
			StopSound(DoNotUseThisSound & b)
            'PlaySound(UseThisSound & b), -1, ballvol, AudioPan(BOT(b)), 0, ballpitch, 1, 0, AudioFade(BOT(b))
			PlaySound (UseThisSound & b), - 1, VolPlayfieldRoll(BOT(b)) * BallRollVolume, AudioPan(BOT(b)), 0, PitchPlayfieldRoll(BOT(b)), 1, 0, AudioFade(BOT(b))
        Else
            If rolling(b) = True Then
                StopSound("BallRoll_" & b)
                StopSound("wireloop" & b)
                rolling(b) = False
            End If
        End If

        ' Ball Drop Sounds
		If BOT(b).VelZ <  - 1 And BOT(b).z < 55 And BOT(b).z > 27 Then 'height adjust for ball drop sounds
			If DropCount(b) >= 5 Then
				DropCount(b) = 0
				If BOT(b).velz >  - 7 Then
					RandomSoundBallBouncePlayfieldSoft BOT(b)
				Else
					RandomSoundBallBouncePlayfieldHard BOT(b)
				End If
			End If
		End If
		
		If DropCount(b) < 5 Then
			DropCount(b) = DropCount(b) + 1
		End If

    Next
End Sub




'*******************************************************************************************************************************

Sub DoAbsolutelyNothing
	'Philippians 3:2
End Sub







'**********************************
' 	ZMAT: General Math Functions
'**********************************
' These get used throughout the script. 

Dim PI
PI = 4 * Atn(1)

Function dSin(degrees)
	dsin = Sin(degrees * Pi / 180)
End Function

Function dCos(degrees)
	dcos = Cos(degrees * Pi / 180)
End Function

Function Atn2(dy, dx)
	If dx > 0 Then
		Atn2 = Atn(dy / dx)
	ElseIf dx < 0 Then
		If dy = 0 Then
			Atn2 = pi
		Else
			Atn2 = Sgn(dy) * (pi - Atn(Abs(dy / dx)))
		End If
	ElseIf dx = 0 Then
		If dy = 0 Then
			Atn2 = 0
		Else
			Atn2 = Sgn(dy) * pi / 2
		End If
	End If
End Function

Function ArcCos(x)
	If x = 1 Then
		ArcCos = 0/180*PI
	ElseIf x = -1 Then
		ArcCos = 180/180*PI
	Else
		ArcCos = Atn(-x/Sqr(-x * x + 1)) + 2 * Atn(1)
	End If
End Function

Function max(a,b)
	If a > b Then
		max = a
	Else
		max = b
	End If
End Function

Function min(a,b)
	If a > b Then
		min = b
	Else
		min = a
	End If
End Function

' Used for drop targets
Function InRect(px,py,ax,ay,bx,by,cx,cy,dx,dy) 'Determines if a Points (px,py) is inside a 4 point polygon A-D in Clockwise/CCW order
	Dim AB, BC, CD, DA
	AB = (bx * py) - (by * px) - (ax * py) + (ay * px) + (ax * by) - (ay * bx)
	BC = (cx * py) - (cy * px) - (bx * py) + (by * px) + (bx * cy) - (by * cx)
	CD = (dx * py) - (dy * px) - (cx * py) + (cy * px) + (cx * dy) - (cy * dx)
	DA = (ax * py) - (ay * px) - (dx * py) + (dy * px) + (dx * ay) - (dy * ax)
	
	If (AB <= 0 And BC <= 0 And CD <= 0 And DA <= 0) Or (AB >= 0 And BC >= 0 And CD >= 0 And DA >= 0) Then
		InRect = True
	Else
		InRect = False
	End If
End Function

Function InRotRect(ballx,bally,px,py,angle,ax,ay,bx,by,cx,cy,dx,dy)
	Dim rax,ray,rbx,rby,rcx,rcy,rdx,rdy
	Dim rotxy
	rotxy = RotPoint(ax,ay,angle)
	rax = rotxy(0) + px
	ray = rotxy(1) + py
	rotxy = RotPoint(bx,by,angle)
	rbx = rotxy(0) + px
	rby = rotxy(1) + py
	rotxy = RotPoint(cx,cy,angle)
	rcx = rotxy(0) + px
	rcy = rotxy(1) + py
	rotxy = RotPoint(dx,dy,angle)
	rdx = rotxy(0) + px
	rdy = rotxy(1) + py
	
	InRotRect = InRect(ballx,bally,rax,ray,rbx,rby,rcx,rcy,rdx,rdy)
End Function

Function RotPoint(x,y,angle)
	Dim rx, ry
	rx = x * dCos(angle) - y * dSin(angle)
	ry = x * dSin(angle) + y * dCos(angle)
	RotPoint = Array(rx,ry)
End Function





'******************************************************
'	ZNFF:  FLIPPER CORRECTIONS by nFozzy
'******************************************************
'
' There are several steps for taking advantage of nFozzy's flipper solution.  At a high level we'll need the following:
'	1. flippers with specific physics settings
'	2. custom triggers for each flipper (TriggerLF, TriggerRF)
'	3. and, special scripting
'
' TriggerLF and RF should now be 27 vp units from the flippers. In addition, 3 degrees should be added to the end angle
' when creating these triggers.
'
' RF.ReProcessBalls Activeball and LF.ReProcessBalls Activeball must be added the flipper_collide subs.
'
' A common mistake is incorrect flipper length.  A 3-inch flipper with rubbers will be about 3.125 inches long.
' This translates to about 147 vp units.  Therefore, the flipper start radius + the flipper length + the flipper end
' radius should  equal approximately 147 vp units. Another common mistake is is that sometimes the right flipper
' angle was set with a large postive value (like 238 or something). It should be using negative value (like -122).
'
' The following settings are a solid starting point for various eras of pinballs.
' |                    | EM's           | late 70's to mid 80's | mid 80's to early 90's | mid 90's and later |
' | ------------------ | -------------- | --------------------- | ---------------------- | ------------------ |
' | Mass               | 1              | 1                     | 1                      | 1                  |
' | Strength           | 500-1000 (750) | 1400-1600 (1500)      | 2000-2600              | 3200-3300 (3250)   |
' | Elasticity         | 0.88           | 0.88                  | 0.88                   | 0.88               |
' | Elasticity Falloff | 0.15           | 0.15                  | 0.15                   | 0.15               |
' | Fricition          | 0.8-0.9        | 0.9                   | 0.9                    | 0.9                |
' | Return Strength    | 0.11           | 0.09                  | 0.07                   | 0.055              |
' | Coil Ramp Up       | 2.5            | 2.5                   | 2.5                    | 2.5                |
' | Scatter Angle      | 0              | 0                     | 0                      | 0                  |
' | EOS Torque         | 0.4            | 0.4                   | 0.375                  | 0.375              |
' | EOS Torque Angle   | 4              | 4                     | 6                      | 6                  |
'

'******************************************************
' Flippers Polarity (Select appropriate sub based on era)
'******************************************************

Dim LF : Set LF = New FlipperPolarity
Dim RF : Set RF = New FlipperPolarity

InitPolarity

'*******************************************
' Mid 80's

Sub InitPolarity()
   dim x, a : a = Array(LF, RF)
	for each x in a
		x.AddPt "Ycoef", 0, RightFlipper.Y-65, 1 'disabled
		x.AddPt "Ycoef", 1, RightFlipper.Y-11, 1
		x.enabled = True
		x.TimeDelay = 80
		x.DebugOn=False ' prints some info in debugger

		x.AddPt "Polarity", 0, 0, 0
		x.AddPt "Polarity", 1, 0.05, - 3.7
		x.AddPt "Polarity", 2, 0.16, - 3.7
		x.AddPt "Polarity", 3, 0.22, - 0
		x.AddPt "Polarity", 4, 0.25, - 0
		x.AddPt "Polarity", 5, 0.3, - 2
		x.AddPt "Polarity", 6, 0.4, - 3
		x.AddPt "Polarity", 7, 0.5, - 3.7
		x.AddPt "Polarity", 8, 0.65, - 2.3
		x.AddPt "Polarity", 9, 0.75, - 1.5
		x.AddPt "Polarity", 10, 0.81, - 1
		x.AddPt "Polarity", 11, 0.88, 0
		x.AddPt "Polarity", 12, 1.3, 0

		x.AddPt "Velocity", 0, 0, 0.85
		x.AddPt "Velocity", 1, 0.15, 0.85
		x.AddPt "Velocity", 2, 0.2, 0.9
		x.AddPt "Velocity", 3, 0.23, 0.95
		x.AddPt "Velocity", 4, 0.41, 0.95
		x.AddPt "Velocity", 5, 0.53, 0.95 '0.982
		x.AddPt "Velocity", 6, 0.62, 1.0
		x.AddPt "Velocity", 7, 0.702, 0.968
		x.AddPt "Velocity", 8, 0.95,  0.968
		x.AddPt "Velocity", 9, 1.03,  0.945
		x.AddPt "Velocity", 10, 1.5,  0.945

	Next

	' SetObjects arguments: 1: name of object 2: flipper object: 3: Trigger object around flipper
    LF.SetObjects "LF", LeftFlipper, TriggerLF
    RF.SetObjects "RF", RightFlipper, TriggerRF
End Sub


'******************************************************
'  FLIPPER CORRECTION FUNCTIONS
'******************************************************

' modified 2023 by nFozzy
' Removed need for 'endpoint' objects
' Added 'createvents' type thing for TriggerLF / TriggerRF triggers.
' Removed AddPt function which complicated setup imo
' made DebugOn do something (prints some stuff in debugger)
'   Otherwise it should function exactly the same as before\
' modified 2024 by rothbauerw
' Added Reprocessballs for flipper collisions (LF.Reprocessballs Activeball and RF.Reprocessballs Activeball must be added to the flipper collide subs
' Improved handling to remove correction for backhand shots when the flipper is raised

Class FlipperPolarity
	Public DebugOn, Enabled
	Private FlipAt		'Timer variable (IE 'flip at 723,530ms...)
	Public TimeDelay		'delay before trigger turns off and polarity is disabled
	Private Flipper, FlipperStart, FlipperEnd, FlipperEndY, LR, PartialFlipCoef, FlipStartAngle
	Private Balls(20), balldata(20)
	Private Name
	
	Dim PolarityIn, PolarityOut
	Dim VelocityIn, VelocityOut
	Dim YcoefIn, YcoefOut
	Public Sub Class_Initialize
		ReDim PolarityIn(0)
		ReDim PolarityOut(0)
		ReDim VelocityIn(0)
		ReDim VelocityOut(0)
		ReDim YcoefIn(0)
		ReDim YcoefOut(0)
		Enabled = True
		TimeDelay = 50
		LR = 1
		Dim x
		For x = 0 To UBound(balls)
			balls(x) = Empty
			Set Balldata(x) = new SpoofBall
		Next
	End Sub
	
	Public Sub SetObjects(aName, aFlipper, aTrigger)
		
		If TypeName(aName) <> "String" Then MsgBox "FlipperPolarity: .SetObjects error: first argument must be a String (And name of Object). Found:" & TypeName(aName) End If
		If TypeName(aFlipper) <> "Flipper" Then MsgBox "FlipperPolarity: .SetObjects error: Second argument must be a flipper. Found:" & TypeName(aFlipper) End If
		If TypeName(aTrigger) <> "Trigger" Then MsgBox "FlipperPolarity: .SetObjects error: third argument must be a trigger. Found:" & TypeName(aTrigger) End If
		If aFlipper.EndAngle > aFlipper.StartAngle Then LR = -1 Else LR = 1 End If
		Name = aName
		Set Flipper = aFlipper
		FlipperStart = aFlipper.x
		FlipperEnd = Flipper.Length * Sin((Flipper.StartAngle / 57.295779513082320876798154814105)) + Flipper.X ' big floats for degree to rad conversion
		FlipperEndY = Flipper.Length * Cos(Flipper.StartAngle / 57.295779513082320876798154814105)*-1 + Flipper.Y
		
		Dim str
		str = "Sub " & aTrigger.name & "_Hit() : " & aName & ".AddBall ActiveBall : End Sub'"
		ExecuteGlobal(str)
		str = "Sub " & aTrigger.name & "_UnHit() : " & aName & ".PolarityCorrect ActiveBall : End Sub'"
		ExecuteGlobal(str)
		
	End Sub
	
	' Legacy: just no op
	Public Property Let EndPoint(aInput)
		
	End Property
	
	Public Sub AddPt(aChooseArray, aIDX, aX, aY) 'Index #, X position, (in) y Position (out)
		Select Case aChooseArray
			Case "Polarity"
				ShuffleArrays PolarityIn, PolarityOut, 1
				PolarityIn(aIDX) = aX
				PolarityOut(aIDX) = aY
				ShuffleArrays PolarityIn, PolarityOut, 0
			Case "Velocity"
				ShuffleArrays VelocityIn, VelocityOut, 1
				VelocityIn(aIDX) = aX
				VelocityOut(aIDX) = aY
				ShuffleArrays VelocityIn, VelocityOut, 0
			Case "Ycoef"
				ShuffleArrays YcoefIn, YcoefOut, 1
				YcoefIn(aIDX) = aX
				YcoefOut(aIDX) = aY
				ShuffleArrays YcoefIn, YcoefOut, 0
		End Select
	End Sub
	
	Public Sub AddBall(aBall)
		Dim x
		For x = 0 To UBound(balls)
			If IsEmpty(balls(x)) Then
				Set balls(x) = aBall
				Exit Sub
			End If
		Next
	End Sub
	
	Private Sub RemoveBall(aBall)
		Dim x
		For x = 0 To UBound(balls)
			If TypeName(balls(x) ) = "IBall" Then
				If aBall.ID = Balls(x).ID Then
					balls(x) = Empty
					Balldata(x).Reset
				End If
			End If
		Next
	End Sub
	
	Public Sub Fire()
		Flipper.RotateToEnd
		processballs
	End Sub
	
	Public Property Get Pos 'returns % position a ball. For debug stuff.
		Dim x
		For x = 0 To UBound(balls)
			If Not IsEmpty(balls(x)) Then
				pos = pSlope(Balls(x).x, FlipperStart, 0, FlipperEnd, 1)
			End If
		Next
	End Property
	
	Public Sub ProcessBalls() 'save data of balls in flipper range
		FlipAt = GameTime
		Dim x
		For x = 0 To UBound(balls)
			If Not IsEmpty(balls(x)) Then
				balldata(x).Data = balls(x)
			End If
		Next
		FlipStartAngle = Flipper.currentangle
		PartialFlipCoef = ((Flipper.StartAngle - Flipper.CurrentAngle) / (Flipper.StartAngle - Flipper.EndAngle))
		PartialFlipCoef = abs(PartialFlipCoef-1)
	End Sub

	Public Sub ReProcessBalls(aBall) 'save data of balls in flipper range
		If FlipperOn() Then
			Dim x
			For x = 0 To UBound(balls)
				If Not IsEmpty(balls(x)) Then
					if balls(x).ID = aBall.ID Then
						If isempty(balldata(x).ID) Then
							balldata(x).Data = balls(x)
						End If
					End If
				End If
			Next
		End If
	End Sub

	'Timer shutoff for polaritycorrect
	Private Function FlipperOn()
		If GameTime < FlipAt+TimeDelay Then
			FlipperOn = True
		End If
	End Function
	
	Public Sub PolarityCorrect(aBall)
		If FlipperOn() Then
			Dim tmp, BallPos, x, IDX, Ycoef, BalltoFlip, BalltoBase, NoCorrection, checkHit
			Ycoef = 1
			
			'y safety Exit
			If aBall.VelY > -8 Then 'ball going down
				RemoveBall aBall
				Exit Sub
			End If
			
			'Find balldata. BallPos = % on Flipper
			For x = 0 To UBound(Balls)
				If aBall.id = BallData(x).id And Not IsEmpty(BallData(x).id) Then
					idx = x
					BallPos = PSlope(BallData(x).x, FlipperStart, 0, FlipperEnd, 1)
					BalltoFlip = DistanceFromFlipperAngle(BallData(x).x, BallData(x).y, Flipper, FlipStartAngle)
					If ballpos > 0.65 Then  Ycoef = LinearEnvelope(BallData(x).Y, YcoefIn, YcoefOut)								'find safety coefficient 'ycoef' data
				End If
			Next
			
			If BallPos = 0 Then 'no ball data meaning the ball is entering and exiting pretty close to the same position, use current values.
				BallPos = PSlope(aBall.x, FlipperStart, 0, FlipperEnd, 1)
				If ballpos > 0.65 Then  Ycoef = LinearEnvelope(aBall.Y, YcoefIn, YcoefOut)												'find safety coefficient 'ycoef' data
				NoCorrection = 1
			Else
				checkHit = 50 + (20 * BallPos) 

				If BalltoFlip > checkHit or (PartialFlipCoef < 0.5 and BallPos > 0.22) Then
					NoCorrection = 1
				Else
					NoCorrection = 0
				End If
			End If
			
			'Velocity correction
			If Not IsEmpty(VelocityIn(0) ) Then
				Dim VelCoef
				VelCoef = LinearEnvelope(BallPos, VelocityIn, VelocityOut)
				
				'If partialflipcoef < 1 Then VelCoef = PSlope(partialflipcoef, 0, 1, 1, VelCoef)
				
				If Enabled Then aBall.Velx = aBall.Velx*VelCoef
				If Enabled Then aBall.Vely = aBall.Vely*VelCoef
			End If
			
			'Polarity Correction (optional now)
			If Not IsEmpty(PolarityIn(0) ) Then
				Dim AddX
				AddX = LinearEnvelope(BallPos, PolarityIn, PolarityOut) * LR
				
				If Enabled and NoCorrection = 0 Then aBall.VelX = aBall.VelX + 1 * (AddX*ycoef*PartialFlipcoef*VelCoef)
			End If
			If DebugOn Then debug.print "PolarityCorrect" & " " & Name & " @ " & GameTime & " " & Round(BallPos*100) & "%" & " AddX:" & Round(AddX,2) & " Vel%:" & Round(VelCoef*100)
		End If
		RemoveBall aBall
	End Sub
End Class

'******************************************************
'  FLIPPER POLARITY AND RUBBER DAMPENER SUPPORTING FUNCTIONS
'******************************************************

' Used for flipper correction and rubber dampeners
Sub ShuffleArray(ByRef aArray, byVal offset) 'shuffle 1d array
	Dim x, aCount
	aCount = 0
	ReDim a(UBound(aArray) )
	For x = 0 To UBound(aArray)		'Shuffle objects in a temp array
		If Not IsEmpty(aArray(x) ) Then
			If IsObject(aArray(x)) Then
				Set a(aCount) = aArray(x)
			Else
				a(aCount) = aArray(x)
			End If
			aCount = aCount + 1
		End If
	Next
	If offset < 0 Then offset = 0
	ReDim aArray(aCount-1+offset)		'Resize original array
	For x = 0 To aCount-1				'set objects back into original array
		If IsObject(a(x)) Then
			Set aArray(x) = a(x)
		Else
			aArray(x) = a(x)
		End If
	Next
End Sub

' Used for flipper correction and rubber dampeners
Sub ShuffleArrays(aArray1, aArray2, offset)
	ShuffleArray aArray1, offset
	ShuffleArray aArray2, offset
End Sub

' Used for flipper correction, rubber dampeners, and drop targets
Function BallSpeed(ball) 'Calculates the ball speed
	BallSpeed = Sqr(ball.VelX^2 + ball.VelY^2 + ball.VelZ^2)
End Function

' Used for flipper correction and rubber dampeners
Function PSlope(Input, X1, Y1, X2, Y2)		'Set up line via two points, no clamping. Input X, output Y
	Dim x, y, b, m
	x = input
	m = (Y2 - Y1) / (X2 - X1)
	b = Y2 - m*X2
	Y = M*x+b
	PSlope = Y
End Function

' Used for flipper correction
Class spoofball
	Public X, Y, Z, VelX, VelY, VelZ, ID, Mass, Radius
	Public Property Let Data(aBall)
		With aBall
			x = .x
			y = .y
			z = .z
			velx = .velx
			vely = .vely
			velz = .velz
			id = .ID
			mass = .mass
			radius = .radius
		End With
	End Property
	Public Sub Reset()
		x = Empty
		y = Empty
		z = Empty
		velx = Empty
		vely = Empty
		velz = Empty
		id = Empty
		mass = Empty
		radius = Empty
	End Sub
End Class

' Used for flipper correction and rubber dampeners
Function LinearEnvelope(xInput, xKeyFrame, yLvl)
	Dim y 'Y output
	Dim L 'Line
	'find active line
	Dim ii
	For ii = 1 To UBound(xKeyFrame)
		If xInput <= xKeyFrame(ii) Then
			L = ii
			Exit For
		End If
	Next
	If xInput > xKeyFrame(UBound(xKeyFrame) ) Then L = UBound(xKeyFrame)		'catch line overrun
	Y = pSlope(xInput, xKeyFrame(L-1), yLvl(L-1), xKeyFrame(L), yLvl(L) )
	
	If xInput <= xKeyFrame(LBound(xKeyFrame) ) Then Y = yLvl(LBound(xKeyFrame) )		 'Clamp lower
	If xInput >= xKeyFrame(UBound(xKeyFrame) ) Then Y = yLvl(UBound(xKeyFrame) )		'Clamp upper
	
	LinearEnvelope = Y
End Function

'******************************************************
'  FLIPPER TRICKS
'******************************************************
' To add the flipper tricks you must
'	 - Include a call to FlipperCradleCollision from within OnBallBallCollision subroutine
'	 - Include a call the CheckLiveCatch from the LeftFlipper_Collide and RightFlipper_Collide subroutines
'	 - Include FlipperActivate and FlipperDeactivate in the Flipper solenoid subs

RightFlipper.timerinterval = 1
Rightflipper.timerenabled = True

Sub RightFlipper_timer()
	FlipperTricks LeftFlipper, LFPress, LFCount, LFEndAngle, LFState
	FlipperTricks RightFlipper, RFPress, RFCount, RFEndAngle, RFState
	FlipperNudge RightFlipper, RFEndAngle, RFEOSNudge, LeftFlipper, LFEndAngle
	FlipperNudge LeftFlipper, LFEndAngle, LFEOSNudge,  RightFlipper, RFEndAngle
End Sub

Dim LFEOSNudge, RFEOSNudge

Sub FlipperNudge(Flipper1, Endangle1, EOSNudge1, Flipper2, EndAngle2)
	Dim b
	Dim gBOT: gBOT = GetBalls
	
	If Flipper1.currentangle = Endangle1 And EOSNudge1 <> 1 Then
		EOSNudge1 = 1
		'   debug.print Flipper1.currentangle &" = "& Endangle1 &"--"& Flipper2.currentangle &" = "& EndAngle2
		If Flipper2.currentangle = EndAngle2 Then
			For b = 0 To UBound(gBOT)
				If FlipperTrigger(gBOT(b).x, gBOT(b).y, Flipper1) Then
					'Debug.Print "ball in flip1. exit"
					Exit Sub
				End If
			Next
			For b = 0 To UBound(gBOT)
				If FlipperTrigger(gBOT(b).x, gBOT(b).y, Flipper2) Then
					gBOT(b).velx = gBOT(b).velx / 1.3
					gBOT(b).vely = gBOT(b).vely - 0.5
				End If
			Next
		End If
	Else
		If Abs(Flipper1.currentangle) > Abs(EndAngle1) + 30 Then EOSNudge1 = 0
	End If
End Sub


Dim FCCDamping: FCCDamping = 0.4

Sub FlipperCradleCollision(ball1, ball2, velocity)
	if velocity < 0.7 then exit sub		'filter out gentle collisions
    Dim DoDamping, coef
    DoDamping = false
    'Check left flipper
    If LeftFlipper.currentangle = LFEndAngle Then
		If FlipperTrigger(ball1.x, ball1.y, LeftFlipper) OR FlipperTrigger(ball2.x, ball2.y, LeftFlipper) Then DoDamping = true
    End If
    'Check right flipper
    If RightFlipper.currentangle = RFEndAngle Then
		If FlipperTrigger(ball1.x, ball1.y, RightFlipper) OR FlipperTrigger(ball2.x, ball2.y, RightFlipper) Then DoDamping = true
    End If
    If DoDamping Then
		coef = FCCDamping
        ball1.velx = ball1.velx * coef: ball1.vely = ball1.vely * coef: ball1.velz = ball1.velz * coef
        ball2.velx = ball2.velx * coef: ball2.vely = ball2.vely * coef: ball2.velz = ball2.velz * coef
    End If
End Sub
	




'*************************************************
'  Check ball distance from Flipper for Rem
'*************************************************

Function Distance(ax,ay,bx,by)
	Distance = Sqr((ax - bx) ^ 2 + (ay - by) ^ 2)
End Function

Function DistancePL(px,py,ax,ay,bx,by) 'Distance between a point and a line where point Is px,py
	DistancePL = Abs((by - ay) * px - (bx - ax) * py + bx * ay - by * ax) / Distance(ax,ay,bx,by)
End Function

Function Radians(Degrees)
	Radians = Degrees * PI / 180
End Function

Function AnglePP(ax,ay,bx,by)
	AnglePP = Atn2((by - ay),(bx - ax)) * 180 / PI
End Function

Function DistanceFromFlipper(ballx, bally, Flipper)
	DistanceFromFlipper = DistancePL(ballx, bally, Flipper.x, Flipper.y, Cos(Radians(Flipper.currentangle + 90)) + Flipper.x, Sin(Radians(Flipper.currentangle + 90)) + Flipper.y)
End Function

Function DistanceFromFlipperAngle(ballx, bally, Flipper, Angle)
	DistanceFromFlipperAngle = DistancePL(ballx, bally, Flipper.x, Flipper.y, Cos(Radians(Angle + 90)) + Flipper.x, Sin(Radians(angle + 90)) + Flipper.y)
End Function

Function FlipperTrigger(ballx, bally, Flipper)
	Dim DiffAngle
	DiffAngle = Abs(Flipper.currentangle - AnglePP(Flipper.x, Flipper.y, ballx, bally) - 90)
	If DiffAngle > 180 Then DiffAngle = DiffAngle - 360
	
	If DistanceFromFlipper(ballx,bally,Flipper) < 48 And DiffAngle <= 90 And Distance(ballx,bally,Flipper.x,Flipper.y) < Flipper.Length Then
		FlipperTrigger = True
	Else
		FlipperTrigger = False
	End If
End Function

'*************************************************
'  End - Check ball distance from Flipper for Rem
'*************************************************

Dim LFPress, RFPress, LFCount, RFCount
Dim LFState, RFState
Dim EOST, EOSA,Frampup, FElasticity,FReturn
Dim RFEndAngle, LFEndAngle

Const FlipperCoilRampupMode = 0 '0 = fast, 1 = medium, 2 = slow (tap passes should work)

LFState = 1
RFState = 1
EOST = leftflipper.eostorque
EOSA = leftflipper.eostorqueangle
Frampup = LeftFlipper.rampup
FElasticity = LeftFlipper.elasticity
FReturn = LeftFlipper.return
'Const EOSTnew = 1.5 'EM's to late 80's - new recommendation by rothbauerw (previously 1)
Const EOSTnew = 1.2 '90's and later - new recommendation by rothbauerw (previously 0.8)
Const EOSAnew = 1
Const EOSRampup = 0
Dim SOSRampup
Select Case FlipperCoilRampupMode
	Case 0
		SOSRampup = 2.5
	Case 1
		SOSRampup = 6
	Case 2
		SOSRampup = 8.5
End Select

Const LiveCatch = 16
Const LiveElasticity = 0.45
Const SOSEM = 0.815
'   Const EOSReturn = 0.055  'EM's
'   Const EOSReturn = 0.045  'late 70's to mid 80's
Const EOSReturn = 0.035  'mid 80's to early 90's
'   Const EOSReturn = 0.025  'mid 90's and later

LFEndAngle = Leftflipper.endangle
RFEndAngle = RightFlipper.endangle

Sub FlipperActivate(Flipper, FlipperPress)
	FlipperPress = 1
	Flipper.Elasticity = FElasticity
	
	Flipper.eostorque = EOST
	Flipper.eostorqueangle = EOSA
End Sub

Sub FlipperDeactivate(Flipper, FlipperPress)
	FlipperPress = 0
	Flipper.eostorqueangle = EOSA
	Flipper.eostorque = EOST * EOSReturn / FReturn
	
	If Abs(Flipper.currentangle) <= Abs(Flipper.endangle) + 0.1 Then
		Dim b
		Dim gBOT: gBOT = GetBalls
		
		For b = 0 To UBound(gBOT)
			If Distance(gBOT(b).x, gBOT(b).y, Flipper.x, Flipper.y) < 55 Then 'check for cradle
				If gBOT(b).vely >= - 0.4 Then gBOT(b).vely =  - 0.4
			End If
		Next
	End If
End Sub

Sub FlipperTricks (Flipper, FlipperPress, FCount, FEndAngle, FState)
	Dim Dir
	Dir = Flipper.startangle / Abs(Flipper.startangle) '-1 for Right Flipper
	
	If Abs(Flipper.currentangle) > Abs(Flipper.startangle) - 0.05 Then
		If FState <> 1 Then
			Flipper.rampup = SOSRampup
			Flipper.endangle = FEndAngle - 3 * Dir
			Flipper.Elasticity = FElasticity * SOSEM
			FCount = 0
			FState = 1
		End If
	ElseIf Abs(Flipper.currentangle) <= Abs(Flipper.endangle) And FlipperPress = 1 Then
		If FCount = 0 Then FCount = GameTime
		
		If FState <> 2 Then
			Flipper.eostorqueangle = EOSAnew
			Flipper.eostorque = EOSTnew
			Flipper.rampup = EOSRampup
			Flipper.endangle = FEndAngle
			FState = 2
		End If
	ElseIf Abs(Flipper.currentangle) > Abs(Flipper.endangle) + 0.01 And FlipperPress = 1 Then
		If FState <> 3 Then
			Flipper.eostorque = EOST
			Flipper.eostorqueangle = EOSA
			Flipper.rampup = Frampup
			Flipper.Elasticity = FElasticity
			FState = 3
		End If
	End If
End Sub

Const LiveDistanceMin = 5  'minimum distance In vp units from flipper base live catch dampening will occur
Const LiveDistanceMax = 114 'maximum distance in vp units from flipper base live catch dampening will occur (tip protection)
Const BaseDampen = 0.55

Sub CheckLiveCatch(ball, Flipper, FCount, parm) 'Experimental new live catch
    Dim Dir, LiveDist
    Dir = Flipper.startangle / Abs(Flipper.startangle)    '-1 for Right Flipper
    Dim LiveCatchBounce   'If live catch is not perfect, it won't freeze ball totally
    Dim CatchTime
    CatchTime = GameTime - FCount
    LiveDist = Abs(Flipper.x - ball.x)

    If CatchTime <= LiveCatch And parm > 3 And LiveDist > LiveDistanceMin And LiveDist < LiveDistanceMax Then
        If CatchTime <= LiveCatch * 0.5 Then   'Perfect catch only when catch time happens in the beginning of the window
            LiveCatchBounce = 0
        Else
            LiveCatchBounce = Abs((LiveCatch / 2) - CatchTime)  'Partial catch when catch happens a bit late
        End If
        
        If LiveCatchBounce = 0 And ball.velx * Dir > 0 And LiveDist > 30 Then ball.velx = 0

        If ball.velx * Dir > 0 And LiveDist < 30 Then
            ball.velx = BaseDampen * ball.velx
            ball.vely = BaseDampen * ball.vely
            ball.angmomx = BaseDampen * ball.angmomx
            ball.angmomy = BaseDampen * ball.angmomy
            ball.angmomz = BaseDampen * ball.angmomz
        Elseif LiveDist > 30 Then
            ball.vely = LiveCatchBounce * (32 / LiveCatch) ' Multiplier for inaccuracy bounce
            ball.angmomx = 0
            ball.angmomy = 0
            ball.angmomz = 0
        End If
    Else
        If Abs(Flipper.currentangle) <= Abs(Flipper.endangle) + 1 Then FlippersD.Dampenf ActiveBall, parm
    End If
End Sub

'******************************************************
'****  END FLIPPER CORRECTIONS
'******************************************************





'******************************************************
' 	ZDMP:  RUBBER  DAMPENERS
'******************************************************
' These are data mined bounce curves,
' dialed in with the in-game elasticity as much as possible to prevent angle / spin issues.
' Requires tracking ballspeed to calculate COR

Sub dPosts_Hit(idx)
	RubbersD.dampen ActiveBall
	TargetBouncer ActiveBall, 1
	SFXRubberHit
End Sub

Sub dSleeves_Hit(idx)
	SleevesD.Dampen ActiveBall
	TargetBouncer ActiveBall, 0.7
	SFXRubberHit
End Sub

Dim RubbersD				'frubber
Set RubbersD = New Dampener
RubbersD.name = "Rubbers"
RubbersD.debugOn = False	'shows info in textbox "TBPout"
RubbersD.Print = False	  'debug, reports In debugger (In vel, out cor); cor bounce curve (linear)

'for best results, try to match in-game velocity as closely as possible to the desired curve
'   RubbersD.addpoint 0, 0, 0.935   'point# (keep sequential), ballspeed, CoR (elasticity)
RubbersD.addpoint 0, 0, 1.1		 'point# (keep sequential), ballspeed, CoR (elasticity)
RubbersD.addpoint 1, 3.77, 0.97
RubbersD.addpoint 2, 5.76, 0.967	'dont take this as gospel. if you can data mine rubber elasticitiy, please help!
RubbersD.addpoint 3, 15.84, 0.874
RubbersD.addpoint 4, 56, 0.64	   'there's clamping so interpolate up to 56 at least

Dim SleevesD	'this is just rubber but cut down to 85%...
Set SleevesD = New Dampener
SleevesD.name = "Sleeves"
SleevesD.debugOn = False	'shows info in textbox "TBPout"
SleevesD.Print = False	  'debug, reports In debugger (In vel, out cor)
SleevesD.CopyCoef RubbersD, 0.85

'######################### Add new FlippersD Profile
'######################### Adjust these values to increase or lessen the elasticity

Dim FlippersD
Set FlippersD = New Dampener
FlippersD.name = "Flippers"
FlippersD.debugOn = False
FlippersD.Print = False
FlippersD.addpoint 0, 0, 1.1
FlippersD.addpoint 1, 3.77, 0.99
FlippersD.addpoint 2, 6, 0.99

Class Dampener
	Public Print, debugOn   'tbpOut.text
	Public name, Threshold  'Minimum threshold. Useful for Flippers, which don't have a hit threshold.
	Public ModIn, ModOut
	Private Sub Class_Initialize
		ReDim ModIn(0)
		ReDim Modout(0)
	End Sub
	
	Public Sub AddPoint(aIdx, aX, aY)
		ShuffleArrays ModIn, ModOut, 1
		ModIn(aIDX) = aX
		ModOut(aIDX) = aY
		ShuffleArrays ModIn, ModOut, 0
		If GameTime > 100 Then Report
	End Sub
	
	Public Sub Dampen(aBall)
		If threshold Then
			If BallSpeed(aBall) < threshold Then Exit Sub
		End If
		Dim RealCOR, DesiredCOR, str, coef
		DesiredCor = LinearEnvelope(cor.ballvel(aBall.id), ModIn, ModOut )
		RealCOR = BallSpeed(aBall) / (cor.ballvel(aBall.id) + 0.0001)
		coef = desiredcor / realcor
		If debugOn Then str = name & " In vel:" & Round(cor.ballvel(aBall.id),2 ) & vbNewLine & "desired cor: " & Round(desiredcor,4) & vbNewLine & _
		"actual cor: " & Round(realCOR,4) & vbNewLine & "ballspeed coef: " & Round(coef, 3) & vbNewLine
		If Print Then Debug.print Round(cor.ballvel(aBall.id),2) & ", " & Round(desiredcor,3)
		
		aBall.velx = aBall.velx * coef
		aBall.vely = aBall.vely * coef
		aBall.velz = aBall.velz * coef
		If debugOn Then TBPout.text = str
	End Sub
	
	Public Sub Dampenf(aBall, parm) 'Rubberizer is handle here
		Dim RealCOR, DesiredCOR, str, coef
		DesiredCor = LinearEnvelope(cor.ballvel(aBall.id), ModIn, ModOut )
		RealCOR = BallSpeed(aBall) / (cor.ballvel(aBall.id) + 0.0001)
		coef = desiredcor / realcor
		If Abs(aball.velx) < 2 And aball.vely < 0 And aball.vely >  - 3.75 Then
			aBall.velx = aBall.velx * coef
			aBall.vely = aBall.vely * coef
		End If
	End Sub
	
	Public Sub CopyCoef(aObj, aCoef) 'alternative addpoints, copy with coef
		Dim x
		For x = 0 To UBound(aObj.ModIn)
			addpoint x, aObj.ModIn(x), aObj.ModOut(x) * aCoef
		Next
	End Sub
	
	Public Sub Report() 'debug, reports all coords in tbPL.text
		If Not debugOn Then Exit Sub
		Dim a1, a2
		a1 = ModIn
		a2 = ModOut
		Dim str, x
		For x = 0 To UBound(a1)
			str = str & x & ": " & Round(a1(x),4) & ", " & Round(a2(x),4) & vbNewLine
		Next
		TBPout.text = str
	End Sub
End Class

'******************************************************
'  TRACK ALL BALL VELOCITIES
'  FOR RUBBER DAMPENER AND DROP TARGETS
'******************************************************

Dim cor
Set cor = New CoRTracker

Class CoRTracker
	Public ballvel, ballvelx, ballvely
	
	Private Sub Class_Initialize
		ReDim ballvel(0)
		ReDim ballvelx(0)
		ReDim ballvely(0)
	End Sub
	
	Public Sub Update()	'tracks in-ball-velocity
		Dim str, b, AllBalls, highestID
		allBalls = GetBalls
		
		For Each b In allballs
			If b.id >= HighestID Then highestID = b.id
		Next
		
		If UBound(ballvel) < highestID Then ReDim ballvel(highestID)	'set bounds
		If UBound(ballvelx) < highestID Then ReDim ballvelx(highestID)	'set bounds
		If UBound(ballvely) < highestID Then ReDim ballvely(highestID)	'set bounds
		
		For Each b In allballs
			ballvel(b.id) = BallSpeed(b)
			ballvelx(b.id) = b.velx
			ballvely(b.id) = b.vely
		Next
	End Sub
End Class

' Note, cor.update must be called in a 10 ms timer. The example table uses the GameTimer for this purpose, but sometimes a dedicated timer call RDampen is used.
'
Sub RDampen_Timer
	Cor.Update
End Sub

'******************************************************
'****  END PHYSICS DAMPENERS
'******************************************************



'******************************************************
' 	ZBOU: VPW TargetBouncer for targets and posts by Iaakki, Wrd1972, Apophis
'******************************************************

Const TargetBouncerEnabled = 1	  '0 = normal standup targets, 1 = bouncy targets
Const TargetBouncerFactor = 0.9	 'Level of bounces. Recommmended value of 0.7-1

Sub TargetBouncer(aBall,defvalue)
	Dim zMultiplier, vel, vratio
	If TargetBouncerEnabled = 1 And aball.z < 30 Then
		'   debug.print "velx: " & aball.velx & " vely: " & aball.vely & " velz: " & aball.velz
		vel = BallSpeed(aBall)
		If aBall.velx = 0 Then vratio = 1 Else vratio = aBall.vely / aBall.velx
		Select Case Int(Rnd * 6) + 1
			Case 1
				zMultiplier = 0.2 * defvalue
			Case 2
				zMultiplier = 0.25 * defvalue
			Case 3
				zMultiplier = 0.3 * defvalue
			Case 4
				zMultiplier = 0.4 * defvalue
			Case 5
				zMultiplier = 0.45 * defvalue
			Case 6
				zMultiplier = 0.5 * defvalue
		End Select
		aBall.velz = Abs(vel * zMultiplier * TargetBouncerFactor)
		aBall.velx = Sgn(aBall.velx) * Sqr(Abs((vel ^ 2 - aBall.velz ^ 2) / (1 + vratio ^ 2)))
		aBall.vely = aBall.velx * vratio
		'   debug.print "---> velx: " & aball.velx & " vely: " & aball.vely & " velz: " & aball.velz
		'   debug.print "conservation check: " & BallSpeed(aBall)/vel
	End If
End Sub




